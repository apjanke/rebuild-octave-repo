# HG changeset patch
# User jwe
# Date 1185378306 0
#      Wed Jul 25 15:45:06 2007 +0000
# Node ID 59c0c3637633ca416cb9b019381d953057f5dddc
# Parent  acf80f49442707b4a1f06a0357aeb17fbd2dbb68
[project @ 2007-07-25 15:45:04 by jwe]

diff --git a/ChangeLog b/ChangeLog
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,8 +1,14 @@
+2007-07-25  David Bateman  <dbateman@free.fr>
+
+	* octMakefile.in, dlfcn/Makefile.in, emacs/Makefile.in,
+	examples/Makefile.in, test/Makefile.in: Adjust DISTFILES to allow 
+	out of tree "make dist" to work.	
+	
 2007-07-24  Michael Goffioul  <michael.goffioul@swing.be>
 
 	* configure.in (*-*-msdosmsvc): Only add -g to DL_LDFLAGS and
 	SH_LDFLAGS if either CFLAGS or CXXFLAGS contains -g.
 
 2007-07-24  Rafael Laboissiere  <rafael@debian.org>
 
 	* Makeconf.in (RUNTEST): Delete variable substitution.
diff --git a/dlfcn/Makefile.in b/dlfcn/Makefile.in
--- a/dlfcn/Makefile.in
+++ b/dlfcn/Makefile.in
@@ -21,17 +21,17 @@ INSTALL_DATA = @INSTALL_DATA@
 INCLUDES := dlfcn.h
 
 SOURCES := dlfcn.c
 
 OBJECTS := $(SOURCES:.c=.o)
 
 MAKEDEPS := $(SOURCES:.c=.d)
 
-DISTFILES := $(SOURCES) $(INCLUDES) README dl.exp Makefile.in ftp-site
+DISTFILES := $(addprefix $srcdir)/,$(SOURCES) $(INCLUDES) README dl.exp Makefile.in ftp-site)
 
 all: libdlfcn.a
 .PHONY: all
 
 libdlfcn.a: $(OBJECTS)
 	$(AR) $(ARFLAGS) $@ $(OBJECTS)
 	$(RANLIB) $@
 
@@ -66,14 +66,14 @@ maintainer-clean: distclean
 	rm -f tags TAGS
 .PHONY: maintainer-clean
 
 dist:
 	ln $(DISTFILES) ../`cat ../.fname`/dlfcn
 .PHONY: dist
 
 conf-dist:
-	ln octave.cc Makefile.in ../`cat ../.fname`/dlfcn
+	ln $(addprefix $(srcdir)/,octave.cc Makefile.in) ../`cat ../.fname`/dlfcn
 .PHONY: conf-dist
 
 ifndef omit_deps
 -include $(MAKEDEPS)
 endif
diff --git a/doc/ChangeLog b/doc/ChangeLog
--- a/doc/ChangeLog
+++ b/doc/ChangeLog
@@ -1,8 +1,14 @@
+2007-07-25  David Bateman  <dbateman@free.fr>
+
+	* Makefile.in, faq/Makefile.in, interpreter/Makwfile.in, 
+	liboctave/Makefile.in, refcard/Makefile.in:  Adjust DISTFILES 
+	to allow out of tree "make dist" to work.
+
 2007-07-23  David Bateman  <dbateman@free.fr>
 
 	* interpreter/Makefile.in (SUB_SOURCE): remove bit.txi.
 	* interpreter/io.txi: Document rat and rats in new sub-section.
 	* interpreter/plot.txi: New section for test functions. Document
 	peaks and meshc.
 	* interpreter/octave.texi: Add test plotting section.
 	* interpreter/image.txi: Document the functions autumn, bone,
diff --git a/doc/Makefile.in b/doc/Makefile.in
--- a/doc/Makefile.in
+++ b/doc/Makefile.in
@@ -16,17 +16,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES =
 
-DISTFILES = Makefile.in ChangeLog conf.texi.in conf.texi texinfo.tex 
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in ChangeLog conf.texi.in texinfo.tex) conf.texi
 
 SUBDIRS = faq interpreter liboctave refcard
 
 DISTSUBDIRS = $(SUBDIRS)
 
 all: conf.texi $(SUBDIRS)
 .PHONY: all
 
diff --git a/doc/faq/Makefile.in b/doc/faq/Makefile.in
--- a/doc/faq/Makefile.in
+++ b/doc/faq/Makefile.in
@@ -19,17 +19,17 @@ INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES =
 
 TEXINFO := Octave-FAQ.texi
 
 FORMATTED := Octave-FAQ.info Octave-FAQ.dvi Octave-FAQ.ps Octave-FAQ.pdf
 
-DISTFILES := Makefile.in $(TEXINFO) $(FORMATTED)
+DISTFILES := $(addprefix $srcdir)/,Makefile.in $(TEXINFO) $(FORMATTED))
 
 DISTDIRS := HTML
 
 SPELL := $(patsubst %.texi, %.spell, $(ALL_TEXINFO))
 
 %.spell : %.texi
 	rm -f $@
 	$(SED) -e 's/@@/ at /g' -e 's/@[a-zA-Z]*//g' $< | spell > $@.tmp
diff --git a/doc/interpreter/Makefile.in b/doc/interpreter/Makefile.in
--- a/doc/interpreter/Makefile.in
+++ b/doc/interpreter/Makefile.in
@@ -92,18 +92,18 @@ TEXI2PDFCOMMAND = TEXINPUTS="..:$(srcdir
 	  $(UNSETCOMSPEC) $(TEXI2PDF) $(MAIN_TEXINFO) --output $@
 
 FORMATTED = octave.info octave.pdf octave-a4.pdf octave.info-[0-9]*
 
 MAN_BASE := mkoctfile octave octave-bug octave-config
 MAN_SRC := $(addsuffix .1, $(MAN_BASE))
 
 # FIXME -- need to include generated figures here...
-DISTFILES = Makefile.in contributors.in mkcontrib.awk dir \
-  munge-texi.cc $(MAN_SRC) $(SOURCES) $(TEXINFO_SOURCE) $(FORMATTED) $(IMAGES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in contributors.in mkcontrib.awk dir \
+  munge-texi.cc $(MAN_SRC) $(SOURCES) $(TEXINFO_SOURCE)) $(FORMATTED) $(IMAGES)
 
 DISTDIRS = HTML
 
 DISTSUBDIRS :=
 
 SUBDIRS :=
 
 # Look for version.h to get version information.
diff --git a/doc/liboctave/Makefile.in b/doc/liboctave/Makefile.in
--- a/doc/liboctave/Makefile.in
+++ b/doc/liboctave/Makefile.in
@@ -29,17 +29,18 @@ SUB_TEXINFO = \
 	optim.texi preface.texi quad.texi range.texi
 
 TEXINFO_SOURCE = $(MAIN_TEXINFO) $(SUB_TEXINFO)
 
 TEXINFO = $(TEXINFO_SOURCE) ../conf.texi
 
 FORMATTED = liboctave.dvi liboctave.ps liboctave.pdf liboctave.info
 
-DISTFILES = Makefile.in gpl.texi $(TEXINFO_SOURCE) $(FORMATTED)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in gpl.texi $(TEXINFO_SOURCE)) \
+	 $(FORMATTED)
 
 DISTDIRS = HTML
 
 SPELL = $(patsubst %.texi, %.spell, $(TEXINFO))
 
 %.spell : %.texi
 	rm -f $@
 	$(SED) -e 's/@@/ at /g' -e 's/@[a-zA-Z]*//g' $< | spell > $@.tmp
diff --git a/doc/refcard/Makefile.in b/doc/refcard/Makefile.in
--- a/doc/refcard/Makefile.in
+++ b/doc/refcard/Makefile.in
@@ -19,17 +19,17 @@ INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 TEX := refcard.tex refcard-a4.tex refcard-legal.tex refcard-letter.tex 
 
 FORMATTED := refcard-a4.dvi refcard-a4.ps refcard-a4.pdf \
 	refcard-legal.dvi refcard-legal.ps refcard-legal.pdf \
 	refcard-letter.dvi refcard-letter.ps refcard-letter.pdf
 
-DISTFILES := Makefile.in $(TEX) $(FORMATTED)
+DISTFILES := $(addprefix $(srcdir)/,Makefile.in $(TEX)) $(FORMATTED)
 
 all: $(FORMATTED)
 
 refcard-a4.dvi: refcard-a4.tex refcard.tex
 	-TEXINPUTS="$(srcdir):$(TEXINPUTS):" tex $<
 
 refcard-a4.ps: refcard-a4.dvi
 	-dvips -T 297mm,210mm -o $@ $<
diff --git a/emacs/Makefile.in b/emacs/Makefile.in
--- a/emacs/Makefile.in
+++ b/emacs/Makefile.in
@@ -18,17 +18,17 @@ INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_DATA = @INSTALL_DATA@
 
 EL_FILES = octave-hlp.el octave-inf.el octave-mod.el
 
 SOURCES = $(EL_FILES) octave-tags
 
-DISTFILES = Makefile.in $(EL_FILES) octave-tags octave-tags.1 NEWS TODO README
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(EL_FILES) octave-tags octave-tags.1 NEWS TODO README)
 
 all:
 .PHONY: all
 
 install install-strip:
 	$(INSTALL_SCRIPT) octave-tags $(DESTDIR)$(bindir)/octave-tags
 .PHONY: install install-strip
 
diff --git a/examples/Makefile.in b/examples/Makefile.in
--- a/examples/Makefile.in
+++ b/examples/Makefile.in
@@ -52,17 +52,18 @@ SOURCES = \
   paramdemo.cc \
   stringdemo.cc \
   structdemo.cc \
   unwinddemo.cc
 
 IMAGE_FILES = $(srcdir)/octave-sombrero.png
 IMAGE_FILES_NO_DIR = $(notdir $(IMAGE_FILES))
 
-DISTFILES = Makefile.in $(SOURCES) $(SCRIPTS) $(IMAGE_FILES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES) $(SCRIPTS)) \
+	 $(IMAGE_FILES)
 
 SUBDIRS = 
 
 DISTSUBDIRS = 
 
 all: octave.desktop
 .PHONY: all
 
diff --git a/libcruft/ChangeLog b/libcruft/ChangeLog
--- a/libcruft/ChangeLog
+++ b/libcruft/ChangeLog
@@ -1,8 +1,14 @@
+2007-07-25  David Bateman  <dbateman@free.fr>
+
+	* Makefile.in, Makerules.in, fftpack/Makefile.in,
+	randlib/Makefile.in: Adjust DISTFILES to allow out of tree "make dist" 
+	to work.
+
 2007-04-23  John W. Eaton  <jwe@octave.org>
 
 	* ranlib/phrtsd.f (phrtsd): Store result of call to index
 	instrinsic in an INTEGER variable to ensure that the types of the
 	arguments passed to mod really are the same even on 64-bit systems.
 
 2007-04-18  Michael Goffioul  <michael.goffioul@swing.be>
 
diff --git a/libcruft/Makefile.in b/libcruft/Makefile.in
--- a/libcruft/Makefile.in
+++ b/libcruft/Makefile.in
@@ -181,12 +181,12 @@ clean mostlyclean distclean::
 distclean maintainer-clean::
 	rm -f Makefile Makerules so_locations
 
 maintainer-clean::
 	rm -f tags TAGS
 
 dist:
 	for dir in $(DISTSUBDIRS); do mkdir ../`cat ../.fname`/libcruft/$$dir; $(MAKE) -C $$dir $@; done
-	ln $(DISTFILES) ../`cat ../.fname`/libcruft
+	ln $(addprefix $(srcdir)/,$(DISTFILES)) ../`cat ../.fname`/libcruft
 .PHONY: dist
 
 .NOTPARALLEL:
diff --git a/libcruft/Makerules.in b/libcruft/Makerules.in
--- a/libcruft/Makerules.in
+++ b/libcruft/Makerules.in
@@ -32,17 +32,17 @@ CRUFT_CXXOBJ = $(addsuffix .o, $(CRUFT_C
 CRUFT_OBJ = $(CRUFT_FOBJ) $(CRUFT_COBJ) $(CRUFT_CXXOBJ)
 
 CRUFT_FDEFS = $(patsubst %.f, %.def, $(notdir $(CRUFT_FSRC)))
 CRUFT_CDEFS = $(patsubst %.c, %.def, $(notdir $(CRUFT_CSRC)))
 CRUFT_CXXDEFS = $(patsubst %.cc, %.def, $(notdir $(CRUFT_CXXSRC)))
 
 CRUFT_DEFS = $(CRUFT_FDEFS) $(CRUFT_CDEFS) $(CRUFT_CXXDEFS)
 
-DISTFILES = Makefile.in $(CRUFT_SRC) $(SPECIAL)
+DISTFILES = $(CRUFT_SRC) $(addprefix $(srcdir)/,Makefile.in $(SPECIAL))
 
 ifeq ($(SHARED_LIBS), true)
   ifdef FPICFLAG
     CRUFT_FPICOBJ := $(addprefix pic/, $(CRUFT_FOBJ))
   else
     CRUFT_FPICOBJ := $(CRUFT_FOBJ)
   endif
   ifdef CPICFLAG
diff --git a/libcruft/fftpack/Makefile.in b/libcruft/fftpack/Makefile.in
--- a/libcruft/fftpack/Makefile.in
+++ b/libcruft/fftpack/Makefile.in
@@ -7,17 +7,17 @@
 # Department of Chemical Engineering
 
 TOPDIR = ../..
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
 
-EXTERNAL_DISTFILES = $(DISTFILES) fftpack.doc
+EXTERNAL_DISTFILES = $(DISTFILES) $(srcdir)/fftpack.doc
 
 FSRC = cfftb.f cfftb1.f cfftf.f cfftf1.f cffti.f cffti1.f passb.f \
   passb2.f passb3.f passb4.f passb5.f passf.f passf2.f passf3.f \
   passf4.f passf5.f
 
 include $(TOPDIR)/Makeconf
 
 include ../Makerules
diff --git a/libcruft/ranlib/Makefile.in b/libcruft/ranlib/Makefile.in
--- a/libcruft/ranlib/Makefile.in
+++ b/libcruft/ranlib/Makefile.in
@@ -10,17 +10,17 @@ TOPDIR = ../..
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
 
 SPECIAL = HOWTOGET README randlib.chs randlib.fdoc \
 	tstbot.for tstgmn.for tstmid.for
 
-EXTERNAL_DISTFILES = $(DISTFILES) Basegen.doc
+EXTERNAL_DISTFILES = $(DISTFILES) $(srcdir)/Basegen.doc
 
 FSRC = advnst.f genbet.f genchi.f genexp.f genf.f gengam.f \
   genmn.f genmul.f gennch.f gennf.f gennor.f genprm.f genunf.f \
   getcgn.f getsd.f ignbin.f ignlgi.f ignnbn.f ignpoi.f ignuin.f \
   initgn.f inrgcm.f lennob.f mltmod.f phrtsd.f qrgnin.f ranf.f \
   setall.f setant.f setgmn.f setsd.f sexpo.f sgamma.f snorm.f wrap.f
 
 include $(TOPDIR)/Makeconf
diff --git a/liboctave/ChangeLog b/liboctave/ChangeLog
--- a/liboctave/ChangeLog
+++ b/liboctave/ChangeLog
@@ -1,8 +1,13 @@
+2007-07-25  David Bateman  <dbateman@free.fr>
+	
+	* Makefile.in: 	Adjust DISTFILES to allow out of tree "make dist" 
+	to work.
+
 2007-06-04  David Bateman  <dbateman@free.fr>
 
 	* oct-inttypes.h (octave_int<T>& operator <<= (const T2&),
 	octave_int<T>& operator >>= (const T2&)): Make shift operators
 	perform a twos complement arithmetic shift for both signed and
 	unsigned integers regardless of compiler implementations.
 
 2007-06-13  Michael Goffioul  <michael.goffioul@swing.be>
diff --git a/liboctave/Makefile.in b/liboctave/Makefile.in
--- a/liboctave/Makefile.in
+++ b/liboctave/Makefile.in
@@ -25,17 +25,17 @@ LINK_DEPS = \
   -L../libcruft -L. $(RLD_FLAG) \
   $(LIBCRUFT) $(CHOLMOD_LIBS) $(UMFPACK_LIBS)  $(AMD_LIBS) \
   $(CAMD_LIBS) $(COLAMD_LIBS) $(CCOLAMD_LIBS) $(CXSPARSE_LIBS) \
   $(BLAS_LIBS) $(FFTW_LIBS) $(LIBREADLINE) $(LIBGLOB) $(LIBS) $(FLIBS)
 
 MATRIX_INC := Array.h Array2.h Array3.h ArrayN.h DiagArray2.h \
 	Array-util.h ArrayN-idx.h MArray-defs.h \
 	MArray.h MArray2.h MDiagArray2.h Matrix.h MArrayN.h \
-	base-lu.h dim-vector.h mx-base.h mx-op-defs.h mx-ops.h \
+	base-lu.h dim-vector.h mx-base.h mx-op-defs.h \
 	mx-defs.h mx-ext.h CColVector.h CDiagMatrix.h CMatrix.h \
 	CNDArray.h CRowVector.h CmplxAEPBAL.h CmplxCHOL.h \
 	CmplxDET.h CmplxHESS.h CmplxLU.h CmplxQR.h CmplxQRP.h \
 	CmplxSCHUR.h CmplxSVD.h EIG.h boolMatrix.h boolNDArray.h \
 	chMatrix.h chNDArray.h dColVector.h dDiagMatrix.h dMatrix.h \
 	dNDArray.h dRowVector.h dbleAEPBAL.h dbleCHOL.h dbleDET.h \
 	dbleHESS.h dbleLU.h dbleQR.h dbleQRP.h dbleSCHUR.h dbleSVD.h \
 	boolSparse.h CSparse.h dSparse.h MSparse-defs.h MSparse.h \
@@ -66,23 +66,25 @@ INCLUDES := Bounds.h CollocWt.h DAE.h DA
 	base-de.h base-min.h byte-swap.h cmd-edit.h cmd-hist.h \
 	data-conv.h dir-ops.h file-ops.h file-stat.h getopt.h \
 	glob-match.h idx-vector.h kpse-xfns.h \
 	lo-ieee.h lo-mappers.h lo-specfun.h \
 	lo-sysdep.h lo-utils.h mach-info.h md5.h oct-alloc.h oct-cmplx.h \
 	oct-env.h oct-fftw.h oct-getopt.h oct-group.h oct-inttypes.h \
 	oct-md5.h oct-passwd.h oct-rand.h oct-rl-edit.h oct-rl-hist.h \
 	oct-shlib.h oct-sort.h oct-spparms.h oct-syscalls.h \
-	oct-sparse.h oct-time.h oct-types.h oct-uname.h \
+	oct-sparse.h oct-time.h oct-uname.h \
 	pathlen.h pathsearch.h prog-args.h \
 	randgamma.h randmtzig.h randpoisson.h \
 	so-array.h sparse-sort.h statdefs.h str-vec.h \
 	sparse-util.h sun-utils.h sysdir.h systime.h syswait.h \
+	$(MATRIX_INC)
+
+BUILT_INCLUDES := oct-types.h mx-ops.h \
 	$(OPTS_INC) \
-	$(MATRIX_INC) \
 	$(MX_OP_INC) \
 	$(VX_OP_INC) \
 	$(SPARSE_MX_OP_INC)
 
 TEMPLATE_SRC := Array.cc ArrayN.cc DiagArray2.cc \
 	MArray.cc MArray2.cc MArrayN.cc MDiagArray2.cc \
 	base-lu.cc oct-sort.cc sparse-base-lu.cc sparse-base-chol.cc \
 	sparse-dmsolve.cc
@@ -121,28 +123,31 @@ LIBOCTAVE_CXX_SOURCES := Bounds.cc Collo
 	file-ops.cc file-stat.cc glob-match.cc idx-vector.cc \
 	lo-ieee.cc lo-mappers.cc lo-specfun.cc lo-sysdep.cc \
 	lo-utils.cc mach-info.cc oct-alloc.cc oct-env.cc \
 	oct-fftw.cc oct-group.cc oct-md5.cc oct-passwd.cc oct-rand.cc \
 	oct-shlib.cc oct-spparms.cc oct-syscalls.cc oct-time.cc oct-uname.cc \
 	prog-args.cc so-array.cc sparse-sort.cc sparse-util.cc str-vec.cc \
 	$(TEMPLATE_SRC) \
 	$(TI_SRC) \
-	$(MATRIX_SRC) \
+	$(MATRIX_SRC)
+
+BUILT_LIBOCTAVE_CXX_SOURCES := \
 	$(MX_OP_SRC) \
 	$(VX_OP_SRC) \
 	$(SPARSE_MX_OP_SRC)
 
 LIBOCTAVE_C_SOURCES := f2c-main.c filemode.c getopt.c getopt1.c \
 	lo-cieee.c lo-cutils.c md5.c mkdir.c oct-getopt.c \
 	randgamma.c randmtzig.c randpoisson.c rename.c \
 	rmdir.c strftime.c strptime.c strcasecmp.c strncase.c \
 	tempname.c tempnam.c
 
-LIBOCTAVE_SOURCES := $(LIBOCTAVE_CXX_SOURCES) $(LIBOCTAVE_C_SOURCES)
+LIBOCTAVE_SOURCES := $(LIBOCTAVE_CXX_SOURCES) $(BUILT_LIBOCTAVE_CXX_SOURCES) \
+	$(LIBOCTAVE_C_SOURCES)
 
 LIBOCT_READLINE_CXX_SOURCES := cmd-edit.cc cmd-hist.cc
 
 LIBOCT_READLINE_C_SOURCES := oct-rl-edit.c oct-rl-hist.c
 
 LIBOCT_READLINE_SOURCES := $(LIBOCT_READLINE_CXX_SOURCES) $(LIBOCT_READLINE_C_SOURCES)
 
 LIBOCT_PATHSEARCH_CXX_SOURCES := pathsearch.cc
@@ -154,27 +159,33 @@ LIBOCT_PATHSEARCH_SOURCES := \
 
 SOURCES := \
 	$(LIBOCTAVE_SOURCES) \
 	$(LIBOCT_READLINE_SOURCES) \
 	$(LIBOCT_PATHSEARCH_SOURCES)
 
 EXTRAS := mx-inlines.cc kpse.cc intNDArray.cc
 
-INCLUDES_FOR_INSTALL := $(INCLUDES) $(TEMPLATE_SRC) $(EXTRAS)
+INCLUDES_FOR_INSTALL := $(INCLUDES) $(BUILT_INCLUDES) $(TEMPLATE_SRC) $(EXTRAS)
 
-DISTFILES := Makefile.in ChangeLog mk-ops.awk mx-ops vx-ops \
-	sparse-mk-ops.awk sparse-mx-ops oct-types.h.in \
-	$(SOURCES) $(INCLUDES) $(EXTRAS) $(OPTS_INC_DATA)
+DISTFILES := $(addprefix $(srcdir)/, Makefile.in ChangeLog mk-ops.awk \
+	mx-ops vx-ops sparse-mk-ops.awk sparse-mx-ops oct-types.h.in \
+	$(LIBOCTAVE_CXX_SOURCES) \
+	$(LIBOCT_READLINE_SOURCES) \
+	$(LIBOCT_PATHSEARCH_SOURCES) \
+	$(LIBOCTAVE_C_SOURCES) \
+	$(INCLUDES) $(EXTRAS) $(OPTS_INC_DATA)) \
+	$(BUILT_LIBOCTAVE_CXX_SOURCES) $(BUILT_INCLUDES)
 
 MAKEDEPS_1 := $(patsubst %.cc, %.d, $(SOURCES))
 MAKEDEPS := $(patsubst %.c, %.d, $(MAKEDEPS_1))
 
 LIBOCTAVE_OBJECTS := \
 	$(LIBOCTAVE_CXX_SOURCES:.cc=.o) \
+	$(BUILT_LIBOCTAVE_CXX_SOURCES:.cc=.o) \
 	$(LIBOCTAVE_C_SOURCES:.c=.o) \
 	$(LIBOCT_READLINE_CXX_SOURCES:.cc=.o) \
 	$(LIBOCT_READLINE_C_SOURCES:.c=.o) \
 	$(LIBOCT_PATHSEARCH_CXX_SOURCES:.cc=.o) \
 	$(LIBOCT_PATHSEARCH_C_SOURCES:.c=.o)
 
 ifeq ($(SHARED_LIBS), true)
   ifdef CXXPICFLAG
diff --git a/octMakefile.in b/octMakefile.in
--- a/octMakefile.in
+++ b/octMakefile.in
@@ -15,22 +15,26 @@ VPATH = @srcdir@
 
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_DATA = @INSTALL_DATA@
 
-CONF_DISTFILES = Makefile Makefile.in octMakefile.in Makeconf.in \
+BUILT_CONF_DISTFILES = Makefile
+
+CONF_DISTFILES = Makefile.in octMakefile.in Makeconf.in \
 	configure configure.in config.guess config.sub aclocal.m4 \
 	acx_blas.m4 acx_lapack.m4 config.h.in install-sh autogen.sh
 
+BUILT_DISTFILES = $(BUILT_CONF_DISTFILES) BUGS INSTALL.OCTAVE
+
 DISTFILES = $(CONF_DISTFILES) \
-	BUGS COPYING FLEX.patch INSTALL INSTALL.OCTAVE NEWS \
+	BUGS COPYING FLEX.patch INSTALL NEWS \
 	NEWS.[0-9] PROJECTS README README.Linux README.Windows \
 	README.Cygwin README.MSVC \
 	README.MachTen README.kpathsea ROADMAP SENDING-PATCHES \
 	THANKS move-if-change octave-sh octave-bug.in \
 	octave-config.in mk-opts.pl mkinstalldirs \
 	mkoctfile.in run-octave.in gdbinit.in ChangeLog ChangeLog.[0-9]
 
 # Subdirectories in which to run `make all'.
@@ -165,17 +169,18 @@ dist-info-files: INSTALL.OCTAVE BUGS
 # The dist target depends on all because we use Octave to build some
 # figures for the manual.  It's best to create those figures with the
 # version of Octave that we are distributing (it may even be required).
 
 dist: all
 	echo octave-$(version) > .fname
 	rm -rf `cat .fname`
 	mkdir `cat .fname`
-	ln $(DISTFILES) `cat .fname`
+	ln $(addprefix, $(srcdir)/,$(DISTFILES)) `cat .fname`
+	ln $(BUILT_DISTFILES) `cat .fname`
 	for dir in $(DISTSUBDIRS); do \
 	  mkdir `cat .fname`/$$dir; \
 	  $(MAKE) -C $$dir dist; \
 	done
 	tar chf `cat .fname`.tar `cat .fname`
 	rm -rf `cat .fname`
 	tar xf `cat .fname`.tar
 	find `cat .fname` \( \( -name RCS -a -type d \) \
@@ -218,16 +223,17 @@ snapshot: snapshot-version
 
 # Rules for making a dist of just the stuff needed to run configure.
 
 conf-dist:
 	echo config-dist-$(version) > .fname
 	rm -rf `cat .fname`
 	mkdir `cat .fname`
 	ln $(CONF_DISTFILES) `cat .fname`
+	ln $(BUILT_CONF_DISTFILES) `cat .fname`
 	for dir in $(CONF_DISTSUBDIRS); do \
 	  mkdir `cat .fname`/$$dir; \
 	  $(MAKE) -C $$dir conf-dist; \
 	done
 	tar chf `cat .fname`.tar `cat .fname`
 	rm -rf `cat .fname`
 	gzip --best `cat .fname`.tar
 	rm -f .fname
diff --git a/scripts/ChangeLog b/scripts/ChangeLog
--- a/scripts/ChangeLog
+++ b/scripts/ChangeLog
@@ -1,8 +1,27 @@
+2007-07-25  David Bateman  <dbateman@free.fr>
+
+	* Makefile.in, audio/Makefile.in, control/Makefile.in,
+	control/base/Makefile.in, control/hinf/Makefile.in,
+	control/obsolete/Makefile.in, control/system/Makefile.in, 
+	control/util/Makefile.in, deprecated/Makefile.in,
+	elfun/Makefile.in, finance/Makefile.in, general/Makefile.in,
+	image/Makefile.in, io/Makefile.in, linear-algebra/Makefile.in,
+	miscellaneous/Makefile.in, optimizaton/Makefile.in,
+	path/Makefile.in, pkg/Makefile.in, plot/Makefile.in,
+	polynomial/Makefile.in, quaternion/Makefile.in,
+	set/Makefile.in, signal/Makefile.in, sparse/Makefile.in,
+	specfun/Makefile.in, special-matrix/Makefile.in,
+	startup/Makefile.in, statistics/Makefile.in,
+	statistics/base/Makefile.in, statistics/distributions/Makefile.in,
+	statistics/models/Makefile.in, statistics/tests/Makefile.in,
+	strings/Makefile.in, testfun/Makefile.in, time/Makefile.in:
+	Adjust DISTFILES to allow out of tree "make dist" to work.
+
 2007-07-25  John W. Eaton  <jwe@octave.org>
 
 	* plot/__plt2__.m: Return [](0x1) if both X and Y are empty.
 
 2007-07-24  David Bateman  <dbateman@free.fr>
 
 	* image/flag.m: New colormap function.
 	* images/Makefile.in: Include it in SOURCES.
diff --git a/scripts/Makefile.in b/scripts/Makefile.in
--- a/scripts/Makefile.in
+++ b/scripts/Makefile.in
@@ -20,19 +20,19 @@ INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES =
 
 ALL_M_FILES1 := $(shell find $(srcdir) -name '*.m' -print)
 ALL_M_FILES := $(patsubst $(srcdir)/%, %, $(ALL_M_FILES1))
 
-DISTFILES = Makefile.in ChangeLog $(SOURCES) configure.in \
-	configure mkinstalldirs mkdoc mkpkgadd gethelp.cc \
-	skip-autoheader DOCSTRINGS move-if-change
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in ChangeLog $(SOURCES) \
+	configure.in configure mkinstalldirs mkdoc mkpkgadd gethelp.cc \
+	skip-autoheader move-if-change) DOCSTRINGS
 
 SUBDIRS = audio control deprecated elfun finance general image io \
 	linear-algebra miscellaneous optimization path pkg plot polynomial \
 	quaternion set signal sparse specfun special-matrix startup \
 	statistics strings testfun time
 
 DISTSUBDIRS = $(SUBDIRS)
 
diff --git a/scripts/audio/Makefile.in b/scripts/audio/Makefile.in
--- a/scripts/audio/Makefile.in
+++ b/scripts/audio/Makefile.in
@@ -18,17 +18,17 @@ include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = lin2mu.m loadaudio.m mu2lin.m playaudio.m record.m \
   saveaudio.m setaudio.m wavread.m wavwrite.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/control/Makefile.in b/scripts/control/Makefile.in
--- a/scripts/control/Makefile.in
+++ b/scripts/control/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SUBDIRS = base hinf obsolete system util
 
 DISTSUBDIRS = $(SUBDIRS)
 
-DISTFILES = Makefile.in
+DISTFILES = $(srcdir)/Makefile.in
 
 all:
 .PHONY: all
 
 $(SUBDIRS):
 	$(MAKE) -C $@ all
 .PHONY: $(SUBDIRS)
 
diff --git a/scripts/control/base/Makefile.in b/scripts/control/base/Makefile.in
--- a/scripts/control/base/Makefile.in
+++ b/scripts/control/base/Makefile.in
@@ -23,17 +23,17 @@ INSTALL_DATA = @INSTALL_DATA@
 SOURCES = DEMOcontrol.m __bodquist__.m __freqresp__.m \
   __stepimp__.m analdemo.m are.m bddemo.m bode.m bode_bounds.m \
   controldemo.m ctrb.m damp.m dare.m dcgain.m dgram.m dkalman.m \
   dlqe.m dlqr.m dlyap.m dre.m frdemo.m freqchkw.m gram.m \
   impulse.m lqe.m lqg.m lqr.m lsim.m ltifr.m lyap.m nichols.m \
   nyquist.m obsv.m place.m pzmap.m rldemo.m rlocus.m step.m \
   tzero.m tzero2.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/control/hinf/Makefile.in b/scripts/control/hinf/Makefile.in
--- a/scripts/control/hinf/Makefile.in
+++ b/scripts/control/hinf/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = dgkfdemo.m dhinfdemo.m h2norm.m h2syn.m hinf_ctr.m \
   hinfdemo.m hinfnorm.m hinfsyn.m hinfsyn_chk.m hinfsyn_ric.m \
   is_dgkf.m wgt1o.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/control/obsolete/Makefile.in b/scripts/control/obsolete/Makefile.in
--- a/scripts/control/obsolete/Makefile.in
+++ b/scripts/control/obsolete/Makefile.in
@@ -18,17 +18,17 @@ include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = dezero.m dlqg.m minfo.m packsys.m qzval.m rotg.m \
   series.m swapcols.m swaprows.m syschnames.m unpacksys.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/control/system/Makefile.in b/scripts/control/system/Makefile.in
--- a/scripts/control/system/Makefile.in
+++ b/scripts/control/system/Makefile.in
@@ -31,17 +31,17 @@ SOURCES = __abcddims__.m __syschnamesl__
   starp.m sys2fir.m sys2ss.m sys2tf.m sys2zp.m sysadd.m \
   sysappend.m syschtsam.m sysconnect.m syscont.m sysdimensions.m \
   sysdisc.m sysdup.m sysgetsignals.m sysgettsam.m sysgettype.m \
   sysgroup.m sysidx.m sysmin.m sysmult.m sysout.m sysprune.m \
   sysreorder.m sysrepdemo.m sysscale.m syssetsignals.m syssub.m \
   sysupdate.m tf.m tf2ss.m tf2sys.m tf2zp.m tfout.m ugain.m zp.m \
   zp2ss.m zp2sys.m zp2tf.m zpout.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/control/util/Makefile.in b/scripts/control/util/Makefile.in
--- a/scripts/control/util/Makefile.in
+++ b/scripts/control/util/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = __outlist__.m __zgpbal__.m axis2dlim.m prompt.m \
   run_cmd.m sortcom.m strappend.m swap.m zgfmul.m zgfslv.m \
   zginit.m zgreduce.m zgrownorm.m zgscal.m zgsgiv.m zgshsr.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/deprecated/Makefile.in b/scripts/deprecated/Makefile.in
--- a/scripts/deprecated/Makefile.in
+++ b/scripts/deprecated/Makefile.in
@@ -35,17 +35,17 @@ SOURCES = beta_cdf.m beta_inv.m beta_pdf
   normal_inv.m normal_pdf.m normal_rnd.m pascal_cdf.m \
   pascal_inv.m pascal_pdf.m pascal_rnd.m poisson_cdf.m \
   poisson_inv.m poisson_pdf.m poisson_rnd.m setstr.m \
   struct_contains.m struct_elements.m t_cdf.m t_inv.m t_pdf.m \
   t_rnd.m uniform_cdf.m uniform_inv.m uniform_pdf.m uniform_rnd.m \
   weibcdf.m weibinv.m weibpdf.m weibrnd.m weibull_cdf.m \
   weibull_inv.m weibull_pdf.m weibull_rnd.m wiener_rnd.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/elfun/Makefile.in b/scripts/elfun/Makefile.in
--- a/scripts/elfun/Makefile.in
+++ b/scripts/elfun/Makefile.in
@@ -20,17 +20,17 @@ INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = acosd.m acot.m acotd.m acoth.m acsc.m acscd.m \
   acsch.m asec.m asecd.m asech.m asind.m atand.m cosd.m \
   cot.m cotd.m coth.m csc.m cscd.m csch.m lcm.m sec.m secd.m \
   sech.m sind.m tand.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/finance/Makefile.in b/scripts/finance/Makefile.in
--- a/scripts/finance/Makefile.in
+++ b/scripts/finance/Makefile.in
@@ -17,17 +17,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = fv.m fvl.m irr.m nper.m npv.m pmt.m pv.m pvl.m rate.m vol.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/io/Makefile.in b/scripts/io/Makefile.in
--- a/scripts/io/Makefile.in
+++ b/scripts/io/Makefile.in
@@ -17,17 +17,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = beep.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/linear-algebra/Makefile.in b/scripts/linear-algebra/Makefile.in
--- a/scripts/linear-algebra/Makefile.in
+++ b/scripts/linear-algebra/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = commutation_matrix.m cond.m cross.m dmult.m dot.m \
   duplication_matrix.m housh.m krylov.m krylovb.m logm.m norm.m \
   null.m orth.m qzhess.m rank.m rref.m trace.m vec.m vech.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/miscellaneous/Makefile.in b/scripts/miscellaneous/Makefile.in
--- a/scripts/miscellaneous/Makefile.in
+++ b/scripts/miscellaneous/Makefile.in
@@ -26,17 +26,17 @@ SOURCES = ans.m bincoeff.m bug_report.m 
   fileattrib.m fileparts.m flops.m fullfile.m getfield.m gunzip.m \
   inputname.m ispc.m isunix.m license.m list_primes.m ls.m \
   ls_command.m menu.m mex.m mexext.m mkoctfile.m movefile.m \
   news.m orderfields.m pack.m paren.m parseparams.m \
   semicolon.m setfield.m single.m substruct.m tar.m \
   tempdir.m tempname.m texas_lotto.m unix.m unpack.m untar.m \
   unzip.m ver.m version.m warning_ids.m xor.m zip.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/optimization/Makefile.in b/scripts/optimization/Makefile.in
--- a/scripts/optimization/Makefile.in
+++ b/scripts/optimization/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = __fsolve_defopts__.m glpk.m glpkmex.m optimset.m qp.m sqp.m
 
 EXTRAS = glpktest1 glpktest2
 
-DISTFILES = Makefile.in $(SOURCES) $(EXTRAS)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/path/Makefile.in b/scripts/path/Makefile.in
--- a/scripts/path/Makefile.in
+++ b/scripts/path/Makefile.in
@@ -17,17 +17,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = savepath.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/pkg/Makefile.in b/scripts/pkg/Makefile.in
--- a/scripts/pkg/Makefile.in
+++ b/scripts/pkg/Makefile.in
@@ -17,17 +17,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = pkg.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/polynomial/Makefile.in b/scripts/polynomial/Makefile.in
--- a/scripts/polynomial/Makefile.in
+++ b/scripts/polynomial/Makefile.in
@@ -20,17 +20,17 @@ INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = compan.m conv.m deconv.m mkpp.m pchip.m poly.m \
   polyder.m polyderiv.m polyfit.m polygcd.m polyinteg.m \
   polyout.m polyreduce.m polyval.m polyvalm.m ppval.m residue.m \
   roots.m spline.m unmkpp.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/quaternion/Makefile.in b/scripts/quaternion/Makefile.in
--- a/scripts/quaternion/Makefile.in
+++ b/scripts/quaternion/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = demoquat.m qconj.m qcoordinate_plot.m qderiv.m \
   qderivmat.m qinv.m qmult.m qtrans.m qtransv.m qtransvmat.m \
   quaternion.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/set/Makefile.in b/scripts/set/Makefile.in
--- a/scripts/set/Makefile.in
+++ b/scripts/set/Makefile.in
@@ -18,17 +18,17 @@ include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = complement.m create_set.m intersect.m ismember.m \
   setdiff.m setxor.m union.m unique.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/signal/Makefile.in b/scripts/signal/Makefile.in
--- a/scripts/signal/Makefile.in
+++ b/scripts/signal/Makefile.in
@@ -24,17 +24,17 @@ SOURCES = arch_fit.m arch_rnd.m arch_tes
   autocov.m autoreg_matrix.m bartlett.m blackman.m detrend.m \
   diffpara.m durbinlevinson.m fftconv.m fftfilt.m fftshift.m \
   filter2.m fractdiff.m freqz.m freqz_plot.m hamming.m hanning.m \
   hurst.m ifftshift.m periodogram.m rectangle_lw.m rectangle_sw.m \
   sinc.m sinetone.m sinewave.m spectral_adf.m spectral_xdf.m \
   spencer.m stft.m synthesis.m triangle_lw.m triangle_sw.m \
   unwrap.m yulewalker.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/sparse/Makefile.in b/scripts/sparse/Makefile.in
--- a/scripts/sparse/Makefile.in
+++ b/scripts/sparse/Makefile.in
@@ -20,17 +20,17 @@ INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = colperm.m etreeplot.m gplot.m nonzeros.m normest.m \
   pcg.m pcr.m spalloc.m spconvert.m spdiags.m speye.m spfun.m \
   sphcat.m spones.m sprand.m sprandn.m sprandsym.m spstats.m \
   spvcat.m spy.m treeplot.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/specfun/Makefile.in b/scripts/specfun/Makefile.in
--- a/scripts/specfun/Makefile.in
+++ b/scripts/specfun/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = bessel.m beta.m betai.m betaln.m erfinv.m factor.m \
   factorial.m gammai.m isprime.m legendre.m log2.m nchoosek.m \
   perms.m pow2.m primes.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/special-matrix/Makefile.in b/scripts/special-matrix/Makefile.in
--- a/scripts/special-matrix/Makefile.in
+++ b/scripts/special-matrix/Makefile.in
@@ -18,17 +18,17 @@ include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = hadamard.m hankel.m hilb.m invhilb.m magic.m pascal.m \
   rosser.m sylvester_matrix.m toeplitz.m vander.m wilkinson.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/startup/Makefile.in b/scripts/startup/Makefile.in
--- a/scripts/startup/Makefile.in
+++ b/scripts/startup/Makefile.in
@@ -17,17 +17,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = main-rcfile local-rcfile inputrc
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES =
 FCN_FILES_NO_DIR =
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/statistics/Makefile.in b/scripts/statistics/Makefile.in
--- a/scripts/statistics/Makefile.in
+++ b/scripts/statistics/Makefile.in
@@ -15,17 +15,17 @@ top_srcdir = @top_srcdir@
 VPATH = @srcdir@
 
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
-DISTFILES = Makefile.in
+DISTFILES = $(srcdir)/Makefile.in
 
 SUBDIRS = base distributions models tests
 
 DISTSUBDIRS = $(SUBDIRS)
 
 all: $(SUBDIRS)
 .PHONY: all
 
diff --git a/scripts/statistics/base/Makefile.in b/scripts/statistics/base/Makefile.in
--- a/scripts/statistics/base/Makefile.in
+++ b/scripts/statistics/base/Makefile.in
@@ -21,17 +21,17 @@ INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = center.m cloglog.m cor.m corrcoef.m cov.m cut.m gls.m \
   iqr.m kendall.m kurtosis.m logit.m mahalanobis.m mean.m meansq.m \
   median.m moment.m ols.m ppplot.m probit.m qqplot.m range.m \
   ranks.m run_count.m skewness.m spearman.m statistics.m std.m \
   studentize.m table.m values.m var.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/statistics/distributions/Makefile.in b/scripts/statistics/distributions/Makefile.in
--- a/scripts/statistics/distributions/Makefile.in
+++ b/scripts/statistics/distributions/Makefile.in
@@ -33,17 +33,17 @@ SOURCES = betacdf.m betainv.m betapdf.m 
   logistic_inv.m logistic_pdf.m logistic_rnd.m logncdf.m \
   logninv.m lognpdf.m lognrnd.m nbincdf.m nbininv.m nbinpdf.m \
   nbinrnd.m normcdf.m norminv.m normpdf.m normrnd.m \
   poisscdf.m poissinv.m poisspdf.m poissrnd.m stdnormal_cdf.m \
   stdnormal_inv.m stdnormal_pdf.m stdnormal_rnd.m tcdf.m tinv.m \
   tpdf.m trnd.m unidrnd.m unifcdf.m unifinv.m unifpdf.m unifrnd.m \
   wblcdf.m wblinv.m wblpdf.m wblrnd.m wienrnd.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/statistics/models/Makefile.in b/scripts/statistics/models/Makefile.in
--- a/scripts/statistics/models/Makefile.in
+++ b/scripts/statistics/models/Makefile.in
@@ -18,17 +18,17 @@ include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = logistic_regression.m logistic_regression_derivatives.m \
   logistic_regression_likelihood.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/statistics/tests/Makefile.in b/scripts/statistics/tests/Makefile.in
--- a/scripts/statistics/tests/Makefile.in
+++ b/scripts/statistics/tests/Makefile.in
@@ -23,17 +23,17 @@ INSTALL_DATA = @INSTALL_DATA@
 SOURCES = anova.m bartlett_test.m chisquare_test_homogeneity.m \
   chisquare_test_independence.m cor_test.m f_test_regression.m \
   hotelling_test.m hotelling_test_2.m kolmogorov_smirnov_test.m \
   kolmogorov_smirnov_test_2.m kruskal_wallis_test.m manova.m \
   mcnemar_test.m prop_test_2.m run_test.m sign_test.m t_test.m \
   t_test_2.m t_test_regression.m u_test.m var_test.m welch_test.m \
   wilcoxon_test.m z_test.m z_test_2.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/strings/Makefile.in b/scripts/strings/Makefile.in
--- a/scripts/strings/Makefile.in
+++ b/scripts/strings/Makefile.in
@@ -21,17 +21,17 @@ INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = base2dec.m bin2dec.m blanks.m deblank.m dec2base.m \
   dec2bin.m dec2hex.m findstr.m hex2dec.m index.m isletter.m \
   lower.m mat2str.m rindex.m split.m str2double.m str2mat.m \
   str2num.m strcat.m strcmpi.m strfind.m strjust.m strmatch.m \
   strncmpi.m strrep.m strtok.m strtrunc.m strvcat.m substr.m upper.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/testfun/Makefile.in b/scripts/testfun/Makefile.in
--- a/scripts/testfun/Makefile.in
+++ b/scripts/testfun/Makefile.in
@@ -17,17 +17,17 @@ VPATH = @srcdir@
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = assert.m demo.m example.m fail.m speed.m test.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/scripts/time/Makefile.in b/scripts/time/Makefile.in
--- a/scripts/time/Makefile.in
+++ b/scripts/time/Makefile.in
@@ -19,17 +19,17 @@ include $(TOPDIR)/Makeconf
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
 SOURCES = asctime.m calendar.m clock.m ctime.m date.m datenum.m \
   datestr.m datevec.m eomday.m etime.m is_leap_year.m now.m \
   tic.m toc.m weekday.m
 
-DISTFILES = Makefile.in $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,Makefile.in $(SOURCES))
 
 FCN_FILES = $(addprefix $(srcdir)/, $(SOURCES))
 FCN_FILES_NO_DIR = $(notdir $(FCN_FILES))
 
 all: PKG_ADD
 .PHONY: all
 
 install install-strip:
diff --git a/src/ChangeLog b/src/ChangeLog
--- a/src/ChangeLog
+++ b/src/ChangeLog
@@ -1,8 +1,13 @@
+2007-07-25  David Bateman  <dbateman@free.fr>
+	
+	* Makefile.in: 	Adjust DISTFILES to allow out of tree "make dist" 
+	to work.
+
 2007-07-24  Shai Ayal  <shaiay@users.sourceforge.net>
 
 	* graphics.cc (color_property::operator = (const octave_value&)):
 	New method.
 	* graphics.h: Provide decl.
 
 2007-07-24  Rafael Laboissiere  <rafael@debian.org>
 
diff --git a/src/Makefile.in b/src/Makefile.in
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -181,21 +181,23 @@ DIST_SRC := Cell.cc bitfcns.cc c-file-pt
 	siglist.c sparse-xdiv.cc sparse-xpow.cc strfns.cc \
 	symtab.cc syscalls.cc sysdep.cc token.cc toplev.cc \
 	unwind-prot.cc utils.cc variables.cc xdiv.cc xpow.cc \
 	$(OV_SRC) \
 	$(PT_SRC)
 
 SOURCES := $(DIST_SRC) $(OP_SRC) $(TI_SRC)
 
-EXTRAS := ov-base-int.cc ov-base-mat.cc ov-base-scalar.cc mxarray.h
+BUILT_EXTRAS := mxarray.h
+
+EXTRAS := ov-base-int.cc ov-base-mat.cc ov-base-scalar.cc
 
 EXTRA_OBJECTS := oct-errno.o octave.o builtins.o ops.o
 
-INCLUDES_FOR_INSTALL := $(INCLUDES) $(EXTRAS)
+INCLUDES_FOR_INSTALL := $(INCLUDES) $(EXTRAS) $(BUILT_EXTRAS)
 
 OBJECTS_4 := $(notdir $(SOURCES))
 OBJECTS_3 := $(patsubst %.l, %.o, $(OBJECTS_4))
 OBJECTS_2 := $(patsubst %.y, %.o, $(OBJECTS_3))
 OBJECTS_1 := $(patsubst %.c, %.o, $(OBJECTS_2))
 OBJECTS := $(patsubst %.cc, %.o, $(OBJECTS_1)) $(EXTRA_OBJECTS)
 
 ifeq ($(SHARED_LIBS), true)
@@ -249,21 +251,24 @@ OCTINTERP_LINK_DEPS = \
   -L../liboctave $(LIBOCTAVE) -L../libcruft $(LIBCRUFT) $(LIBS) $(FLIBS)
 
 OCT_LINK_DEPS = \
   -L../libcruft $(LIBCRUFT) -L../liboctave $(LIBOCTAVE) \
   -L. $(LIBOCTINTERP) $(CHOLMOD_LIBS) $(UMFPACK_LIBS) $(AMD_LIBS) \
    $(CAMD_LIBS) $(COLAMD_LIBS) $(CCOLAMD_LIBS) $(CXSPARSE_LIBS) $(BLAS_LIBS) \
    $(FFTW_LIBS) $(LIBS) $(FLIBS)
 
+BUILT_DISTFILES = DOCSTRINGS oct-gperf.h parse.cc lex.cc y.tab.h \
+	__gnuplot_raw__.cc \
+	$(OPT_HANDLERS) $(BUILT_EXTRAS)
+
 DISTFILES = Makefile.in ChangeLog mkdefs mkops mkgendoc \
-	DOCSTRINGS mkbuiltins mk-errno-list mk-pkg-add \
+	mkbuiltins mk-errno-list mk-pkg-add \
 	defaults.h.in mxarray.h.in oct-conf.h.in oct-errno.cc.in octave.gperf \
-	oct-gperf.h parse.cc lex.cc y.tab.h __gnuplot_raw__.cc \
-	$(INCLUDES) $(DIST_SRC) $(OPT_HANDLERS) $(EXTRAS)
+	$(INCLUDES) $(DIST_SRC) $(EXTRAS)
 
 all: octave$(EXEEXT) $(OCT_FILES) PKG_ADD DOCSTRINGS
 .PHONY: all
 
 objects: $(OBJECTS)
 
 lex.o parse.o __gnuplot_raw__.o pic/lex.o pic/parse.o pic/__gnuplot_raw__.o: \
 	ALL_CXXFLAGS := $(filter-out -Wold-style-cast, $(ALL_CXXFLAGS))
@@ -507,34 +512,35 @@ distclean: clean
 .PHONY: distclean
 
 maintainer-clean: distclean
 	rm -f tags TAGS y.tab.c y.tab.h y.output yy.lex.c lex.cc parse.cc
 	rm -f oct-gperf.h __gnuplot_raw__.cc $(OPT_HANDLERS)
 .PHONY: maintainer-clean
 
 dist: parse.cc lex.cc oct-gperf.h
-	ln $(DISTFILES) ../`cat ../.fname`/src
+	ln $(addprefix $(srcdir)/,$(DISTFILES)) ../`cat ../.fname`/src
+	ln $(BUILT_DISTFILES) ../`cat ../.fname`/src
 	for f in DLD-FUNCTIONS OPERATORS TEMPLATE-INST; do \
 	  if [ -d ../`cat ../.fname`/src/$$f ]; then \
 	    true; \
 	  else \
 	    mkdir ../`cat ../.fname`/src/$$f; \
 	  fi; \
 	done
-	ln $(DLD_SRC) ../`cat ../.fname`/src/DLD-FUNCTIONS
-	ln $(OP_SRC) ../`cat ../.fname`/src/OPERATORS
-	ln $(OP_INCLUDES) ../`cat ../.fname`/src/OPERATORS
-	ln $(TI_SRC) ../`cat ../.fname`/src/TEMPLATE-INST
+	ln $(addprefix $(srcdir)/,$(DLD_SRC)) ../`cat ../.fname`/src/DLD-FUNCTIONS
+	ln $(addprefix $(srcdir)/,$(OP_SRC)) ../`cat ../.fname`/src/OPERATORS
+	ln $(addprefix $(srcdir)/,$(OP_INCLUDES)) ../`cat ../.fname`/src/OPERATORS
+	ln $(addprefix $(srcdir)/,$(TI_SRC)) ../`cat ../.fname`/src/TEMPLATE-INST
 	rm -f parse.cc lex.cc y.tab.h y.output yy.lex.c
 	rm -f oct-gperf.h defaults.h oct-conf.h *.d *.df builtins.cc
 .PHONY: dist
 
 conf-dist:
-	ln octave.cc Makefile.in ../`cat ../.fname`/src
+	ln $(addprefix $(srcdir)/,octave.cc Makefile.in) ../`cat ../.fname`/src
 .PHONY: conf-dist
 
 # Special rules -- these files need special things to be defined.
 
 $(OPT_HANDLERS) : %.cc : $(top_srcdir)/liboctave/%.in $(top_srcdir)/mk-opts.pl
 	@echo making $@ from $<
 	@$(PERL) $(top_srcdir)/mk-opts.pl --opt-handler-fcns $< > $@-t
 	@$(simple-move-if-change-rule)
diff --git a/test/Makefile.in b/test/Makefile.in
--- a/test/Makefile.in
+++ b/test/Makefile.in
@@ -11,17 +11,18 @@ TOPDIR = ..
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
 
 include $(TOPDIR)/Makeconf
 
 SOURCES = $(wildcard $(srcdir)/test_*.m)
 
-DISTFILES = ChangeLog Makefile.in build_sparse_tests.sh fntests.m $(SOURCES)
+DISTFILES = $(addprefix $(srcdir)/,ChangeLog Makefile.in \
+	build_sparse_tests.sh fntests.m) $(SOURCES)
 
 OCTAVE_BINARY = ../src/octave
 
 ifeq ($(SHARED_LIBS), true)
   OCTAVE_LD_LIBRARY_PATH = `pwd`/../src:`pwd`/../liboctave:`pwd`/../libcruft
   ifeq ($(@library_path_var@),)
     XLD_LIBRARY_PATH = $(OCTAVE_LD_LIBRARY_PATH)
   else
