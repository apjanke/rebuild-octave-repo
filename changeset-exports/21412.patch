# HG changeset patch
# User John W. Eaton <jwe@octave.org>
# Date 1457395645 18000
#      Mon Mar 07 19:07:25 2016 -0500
# Node ID 9773a1c2b55fe732c640d299ce64f69ba9060ecf
# Parent  9f7282acc30f546e7f1f23b21bb45412bfbe957f
eliminate link-deps.mk files

* libgui/link-deps.mk, libinterp/link-deps.mk, liboctave/link-deps.mk:
Delete.  Move contents to configure.ac and common.mk.

* Makefile.am: Don't include libgui/link-deps.mk,
libinterp/link-deps.mk, or liboctave/link-deps.mk.

* configure.ac (FFTW_XCPPFLAGS, FFTW_XLDFLAGS, FFTW_XLIBS,
SPARSE_XCPPFLAGS, SPARSE_XLDFLAGS, SPARSE_XLIBS, GNULIB_LINK_DEPS,
LIBOCTAVE_LINK_DEPS, LIBOCTAVE_LINK_OPTS, LIBOCTINTERP_LINK_DEPS,
LIBOCTINTERP_LINK_OPTS, OCTAVE_LINK_DEPS, OCTAVE_LINK_OPTS,
OCT_LINK_DEPS, OCT_LINK_OPTS, LIBOCTGUI_LINK_DEPS,
LIBOCTGUI_LINK_OPTS, OCTAVE_GUI_LINK_DEPS, OCTAVE_GUI_LINK_OPTS):
Define here and substitute instead of defining in common.mk and
link-deps.mk files.

diff --git a/Makefile.am b/Makefile.am
--- a/Makefile.am
+++ b/Makefile.am
@@ -127,21 +127,18 @@ SUBDIRS = libgnu
 # This is only a partial solution which works when 'make all' is used.
 # See bug #45578.
 BUILT_SOURCES += libgnu/libgnu.la
 
 libgnu/libgnu.la:
 	cd libgnu; $(MAKE) all
 
 include liboctave/module.mk
-include liboctave/link-deps.mk
 include libinterp/module.mk
-include libinterp/link-deps.mk
 include libgui/module.mk
-include libgui/link-deps.mk
 include src/module.mk
 include scripts/module.mk
 include doc/module.mk
 include doc/interpreter/images.mk
 include etc/module.mk
 include examples/module.mk
 include m4/module.mk
 include test/module.mk
diff --git a/build-aux/common.mk b/build-aux/common.mk
--- a/build-aux/common.mk
+++ b/build-aux/common.mk
@@ -27,35 +27,43 @@ AM_CFLAGS = ${XTRA_CFLAGS}
 # ifeq (${INCLUDE_DEPS},no)
 #   omit_deps = true;
 # endif
 
 # C++ compiler flags.
 
 AM_CXXFLAGS = ${XTRA_CXXFLAGS}
 
-FFTW_XCPPFLAGS = ${FFTW3_CPPFLAGS} ${FFTW3F_CPPFLAGS}
-FFTW_XLDFLAGS = ${FFTW3_LDFLAGS} ${FFTW3F_LDFLAGS}
-FFTW_XLIBS = ${FFTW3_LIBS} ${FFTW3F_LIBS}
+FFTW_XCPPFLAGS = @FFTW_XCPPFLAGS@
+FFTW_XLDFLAGS = @FFTW_XLDFLAGS@
+FFTW_XLIBS = @FFTW_XLIBS@
 
-SPARSE_XCPPFLAGS = \
-  ${CHOLMOD_CPPFLAGS} ${UMFPACK_CPPFLAGS} \
-  ${AMD_CPPFLAGS} ${CAMD_CPPFLAGS} ${COLAMD_CPPFLAGS} \
-  ${CCOLAMD_CPPFLAGS} ${CXSPARSE_CPPFLAGS}
+SPARSE_XCPPFLAGS = @SPARSE_XCPPFLAGS@
+SPARSE_XLDFLAGS = @SPARSE_XLDFLAGS@
+SPARSE_XLIBS = @SPARSE_XLIBS@
+
+GNULIB_LINK_DEPS = @GNULIB_LINK_DEPS@
+
+LIBOCTAVE_LINK_DEPS = @LIBOCTAVE_LINK_DEPS@
+LIBOCTAVE_LINK_OPTS = @LIBOCTAVE_LINK_OPTS@
 
-SPARSE_XLDFLAGS = \
-  ${CHOLMOD_LDFLAGS} ${UMFPACK_LDFLAGS} \
-  ${AMD_LDFLAGS} ${CAMD_LDFLAGS} ${COLAMD_LDFLAGS} \
-  ${CCOLAMD_LDFLAGS} ${CXSPARSE_LDFLAGS}
+LIBOCTINTERP_LINK_DEPS = @LIBOCTINTERP_LINK_DEPS@
+LIBOCTINTERP_LINK_OPTS = @LIBOCTINTERP_LINK_OPTS@
+
+OCTAVE_LINK_DEPS = @OCTAVE_LINK_DEPS@
+OCTAVE_LINK_OPTS = @OCTAVE_LINK_OPTS@
 
-## Order matters, at least on some systems (Cygwin, for example).
-SPARSE_XLIBS = \
-  ${CHOLMOD_LIBS} ${UMFPACK_LIBS} \
-  ${AMD_LIBS} ${CAMD_LIBS} ${COLAMD_LIBS} \
-  ${CCOLAMD_LIBS} ${CXSPARSE_LIBS}
+OCT_LINK_DEPS = @OCT_LINK_DEPS@
+OCT_LINK_OPTS = @OCT_LINK_OPTS@
+
+LIBOCTGUI_LINK_DEPS = @LIBOCTGUI_LINK_DEPS@
+LIBOCTGUI_LINK_OPTS = @LIBOCTGUI_LINK_OPTS@
+
+OCTAVE_GUI_LINK_DEPS = @OCTAVE_GUI_LINK_DEPS@
+OCTAVE_GUI_LINK_OPTS = @OCTAVE_GUI_LINK_OPTS@
 
 # The arguments passed to configure.
 
 CONFIG_SUBDIRS = @subdirs@
 
 null =
 ldpreloadsep = ${null}@ldpreloadsep@${null}
 
diff --git a/configure.ac b/configure.ac
--- a/configure.ac
+++ b/configure.ac
@@ -3164,16 +3164,120 @@ AM_CONDITIONAL([AMCOND_HAVE_JAVA], [test
 AC_SUBST(JAVA)
 AC_SUBST(JAVAC)
 AC_SUBST(JAR)
 AC_SUBST(JAVA_CPPFLAGS)
 AC_SUBST(JAVA_LIBS)
 AC_DEFINE_UNQUOTED([JAVA_HOME], ["$JAVA_HOME"], [Java home (top-level installation dir)])
 AC_DEFINE_UNQUOTED([JAVA_LDPATH], ["$JAVA_LDPATH"], [Java library path (libjvm)])
 
+## Collections of flags.  These are here instead of just in the
+## Makefile.am file because we substitute some of them into other
+## source files like mkoctfile.
+
+## Order matters, at least on some systems (Cygwin, for example).
+
+FFTW_XCPPFLAGS="$FFTW3_CPPFLAGS $FFTW3F_CPPFLAGS"
+
+FFTW_XLDFLAGS="$FFTW3_LDFLAGS $FFTW3F_LDFLAGS"
+
+FFTW_XLIBS="$FFTW3_LIBS $FFTW3F_LIBS"
+
+SPARSE_XCPPFLAGS="$CHOLMOD_CPPFLAGS $UMFPACK_CPPFLAGS $AMD_CPPFLAGS $CAMD_CPPFLAGS $COLAMD_CPPFLAGS $CCOLAMD_CPPFLAGS $CXSPARSE_CPPFLAGS"
+
+SPARSE_XLDFLAGS="$CHOLMOD_LDFLAGS $UMFPACK_LDFLAGS $AMD_LDFLAGS $CAMD_LDFLAGS $COLAMD_LDFLAGS  $CCOLAMD_LDFLAGS $CXSPARSE_LDFLAGS"
+
+SPARSE_XLIBS="$CHOLMOD_LIBS $UMFPACK_LIBS $AMD_LIBS $CAMD_LIBS $COLAMD_LIBS $CCOLAMD_LIBS $CXSPARSE_LIBS"
+
+AC_SUBST(FFTW_XCPPFLAGS)
+AC_SUBST(FFTW_XLDFLAGS)
+AC_SUBST(FFTW_XLIBS)
+
+AC_SUBST(SPARSE_XCPPFLAGS)
+AC_SUBST(SPARSE_XLDFLAGS)
+AC_SUBST(SPARSE_XLIBS)
+
+GNULIB_LINK_DEPS="$COPYSIGNF_LIBM $COPYSIGN_LIBM $FLOORF_LIBM $FLOOR_LIBM $GETHOSTNAME_LIB $LIBSOCKET $LIB_NANOSLEEP $LIB_SELECT $LTLIBINTL $ROUNDF_LIBM $ROUND_LIBM $TRUNCF_LIBM $TRUNC_LIBM"
+
+AC_SUBST(GNULIB_LINK_DEPS)
+
+LIBOCTAVE_LINK_DEPS="$GNULIB_LINK_DEPS $CURL_LIBS $SPARSE_XLIBS $ARPACK_LIBS $QRUPDATE_LIBS $FFTW_XLIBS $LAPACK_LIBS $BLAS_LIBS $READLINE_LIBS $TERM_LIBS $LIBGLOB $PCRE_LIBS $DL_LIBS $PTHREAD_LIBS $FLIBS $LIBS"
+
+LIBOCTAVE_LINK_OPTS="$CURL_LDFLAGS $SPARSE_XLDFLAGS $ARPACK_LDFLAGS $QRUPDATE_LDFLAGS $FFTW_XLDFLAGS"
+
+AC_SUBST(LIBOCTAVE_LINK_DEPS)
+AC_SUBST(LIBOCTAVE_LINK_OPTS)
+
+if test $ENABLE_DYNAMIC_LINKING = yes; then
+  LIBOCTINTERP_LINK_DEPS=""
+else
+  LIBOCTINTERP_LINK_DEPS="$DLDFCN_LIBS"
+fi
+
+LIBOCTINTERP_LINK_DEPS="$LIBOCTINTERP_LINK_DEPS $FT2_LIBS $HDF5_LIBS $Z_LIBS $FFTW_XLIBS $OPENGL_LIBS $FONTCONFIG_LIBS $FREETYPE_LIBS $X11_LIBS $CARBON_LIBS $GL2PS_LIBS $LLVM_LIBS $JAVA_LIBS $LAPACK_LIBS"
+
+LIBOCTINTERP_LINK_OPTS="$FT2_LDFLAGS $HDF5_LDFLAGS $Z_LDFLAGS $FFTW_XLDFLAGS $LLVM_LDFLAGS"
+
+OCTAVE_LINK_DEPS=""
+OCTAVE_LINK_OPTS=""
+
+OCT_LINK_DEPS=""
+OCT_LINK_OPTS="$LDFLAGS"
+
+if test $link_all_deps = yes || test -n "$QT_LDFLAGS"; then
+  LIBOCTINTERP_LINK_DEPS="$LIBOCTINTERP_LINK_DEPS $LIBOCTAVE_LINK_DEPS"
+  LIBOCTINTERP_LINK_OPTS="$LIBOCTINTERP_LINK_OPTS $LIBOCTAVE_LINK_OPTS"
+
+  OCTAVE_LINK_DEPS="$LIBOCTINTERP_LINK_DEPS"
+  OCTAVE_LINK_OPTS="$LIBOCTINTERP_LINK_OPTS"
+
+  OCT_LINK_DEPS="$OCT_LINK_DEPS $LIBOCTINTERP_LINK_DEPS"
+  OCT_LINK_OPTS="$OCT_LINK_OPTS $LIBOCTINTERP_LINK_OPTS"
+fi
+
+AC_SUBST(LIBOCTINTERP_LINK_DEPS)
+AC_SUBST(LIBOCTINTERP_LINK_OPTS)
+
+AC_SUBST(OCTAVE_LINK_DEPS)
+AC_SUBST(OCTAVE_LINK_OPTS)
+
+AC_SUBST(OCT_LINK_DEPS)
+AC_SUBST(OCT_LINK_OPTS)
+
+LIBOCTGUI_LINK_DEPS=""
+LIBOCTGUI_LINK_OPTS=""
+
+OCTAVE_GUI_LINK_DEPS=""
+OCTAVE_GUI_LINK_OPTS=""
+
+if test $build_qt_gui = yes; then
+  if test $ENABLE_DYNAMIC_LINKING = yes; then
+    LIBOCTGUI_LINK_DEPS=""
+  else
+    LIBOCTGUI_LINK_DEPS="$DLDFCN_LIBS"
+  fi
+
+  LIBOCTGUI_LINK_DEPS="$LIBOCTGUI_LINK_DEPS $QT_LIBS $OPENGL_LIBS"
+  LIBOCTGUI_LINK_OPTS="$QT_LDFLAGS"
+
+  if test $link_all_deps = yes || test -n "$QT_LDFLAGS"; then
+    LIBOCTGUI_LINK_DEPS="$LIBOCTGUI_LINK_DEPS $LIBOCTINTERP_LINK_DEPS"
+    LIBOCTGUI_LINK_OPTS="$LIBOCTGUI_LINK_OPTS $LIBOCTINTERP_LINK_OPTS"
+
+    OCTAVE_GUI_LINK_DEPS="$OCTAVE_GUI_LINK_DEPS $LIBOCTGUI_LINK_DEPS"
+    OCTAVE_GUI_LINK_OPTS="$OCTAVE_GUI_LINK_OPTS $LIBOCTGUI_LINK_OPTS"
+  fi
+fi
+
+AC_SUBST(LIBOCTGUI_LINK_DEPS)
+AC_SUBST(LIBOCTGUI_LINK_OPTS)
+
+AC_SUBST(OCTAVE_GUI_LINK_DEPS)
+AC_SUBST(OCTAVE_GUI_LINK_OPTS)
+
 ### Do we want to create cross-mkoctfile etc ?
 
 cross_tools=no
 AC_ARG_ENABLE([cross-tools],
   [AS_HELP_STRING([--enable-cross-tools],
     [build cross tools (mkoctfile, octave-config) if cross compiling])],
   [if test "$enableval" = yes; then cross_tools=yes; fi])
 
diff --git a/libgui/link-deps.mk b/libgui/link-deps.mk
deleted file mode 100644
--- a/libgui/link-deps.mk
+++ /dev/null
@@ -1,24 +0,0 @@
-if AMCOND_BUILD_QT_GUI
-
-if AMCOND_ENABLE_DYNAMIC_LINKING
-  LIBOCTGUI_LINK_DEPS =
-else
-  LIBOCTGUI_LINK_DEPS = $(DLDFCN_LIBS)
-endif
-
-LIBOCTGUI_LINK_DEPS += \
-  $(QT_LIBS) \
-  $(OPENGL_LIBS)
-
-LIBOCTGUI_LINK_OPTS = \
-  $(QT_LDFLAGS)
-
-if AMCOND_LINK_ALL_DEPS
-  LIBOCTGUI_LINK_DEPS += $(LIBOCTINTERP_LINK_DEPS)
-  LIBOCTGUI_LINK_OPTS += $(LIBOCTINTERP_LINK_OPTS)
-
-  OCTAVE_GUI_LINK_DEPS = $(LIBOCTGUI_LINK_DEPS)
-  OCTAVE_GUI_LINK_OPTS = $(LIBOCTGUI_LINK_OPTS)
-endif
-
-endif
diff --git a/libinterp/link-deps.mk b/libinterp/link-deps.mk
deleted file mode 100644
--- a/libinterp/link-deps.mk
+++ /dev/null
@@ -1,42 +0,0 @@
-if AMCOND_ENABLE_DYNAMIC_LINKING
-  LIBOCTINTERP_LINK_DEPS =
-else
-  LIBOCTINTERP_LINK_DEPS = $(DLDFCN_LIBS)
-endif
-
-LIBOCTINTERP_LINK_DEPS += \
-  $(FT2_LIBS) \
-  $(HDF5_LIBS) \
-  $(Z_LIBS) \
-  $(FFTW_XLIBS) \
-  $(OPENGL_LIBS) \
-  $(FONTCONFIG_LIBS) \
-  $(FREETYPE_LIBS) \
-  $(X11_LIBS) \
-  $(CARBON_LIBS) \
-  $(GL2PS_LIBS) \
-  $(LLVM_LIBS) \
-  $(JAVA_LIBS) \
-  $(LAPACK_LIBS)
-
-LIBOCTINTERP_LINK_OPTS = \
-  $(FT2_LDFLAGS) \
-  $(HDF5_LDFLAGS) \
-  $(Z_LDFLAGS) \
-  $(FFTW_XLDFLAGS) \
-  $(LLVM_LDFLAGS)
-
-OCT_LINK_DEPS =
-
-OCT_LINK_OPTS = $(LDFLAGS)
-
-if AMCOND_LINK_ALL_DEPS
-  LIBOCTINTERP_LINK_DEPS += $(LIBOCTAVE_LINK_DEPS)
-  LIBOCTINTERP_LINK_OPTS += $(LIBOCTAVE_LINK_OPTS)
-
-  OCTAVE_LINK_DEPS = $(LIBOCTINTERP_LINK_DEPS)
-  OCTAVE_LINK_OPTS = $(LIBOCTINTERP_LINK_OPTS)
-
-  OCT_LINK_DEPS += $(LIBOCTINTERP_LINK_DEPS)
-  OCT_LINK_OPTS += $(LIBOCTINTERP_LINK_OPTS)
-endif
diff --git a/liboctave/link-deps.mk b/liboctave/link-deps.mk
deleted file mode 100644
--- a/liboctave/link-deps.mk
+++ /dev/null
@@ -1,39 +0,0 @@
-GNULIB_LINK_DEPS = \
-  $(COPYSIGNF_LIBM)\
-  $(COPYSIGN_LIBM)\
-  $(FLOORF_LIBM)\
-  $(FLOOR_LIBM)\
-  $(GETHOSTNAME_LIB)\
-  $(LIBSOCKET)\
-  $(LIB_NANOSLEEP)\
-  $(LIB_SELECT)\
-  $(LTLIBINTL)\
-  $(ROUNDF_LIBM)\
-  $(ROUND_LIBM)\
-  $(TRUNCF_LIBM)\
-  $(TRUNC_LIBM)
-
-LIBOCTAVE_LINK_DEPS = \
-  $(GNULIB_LINK_DEPS) \
-  $(CURL_LIBS) \
-  $(SPARSE_XLIBS) \
-  $(ARPACK_LIBS) \
-  $(QRUPDATE_LIBS) \
-  $(FFTW_XLIBS) \
-  $(LAPACK_LIBS) \
-  $(BLAS_LIBS) \
-  $(READLINE_LIBS) \
-  $(TERM_LIBS) \
-  $(LIBGLOB) \
-  $(PCRE_LIBS) \
-  $(DL_LIBS) \
-  $(PTHREAD_LIBS) \
-  $(FLIBS) \
-  $(LIBS)
-
-LIBOCTAVE_LINK_OPTS = \
-  $(CURL_LDFLAGS) \
-  $(SPARSE_XLDFLAGS) \
-  $(ARPACK_LDFLAGS) \
-  $(QRUPDATE_LDFLAGS) \
-  $(FFTW_XLDFLAGS)
