# HG changeset patch
# User jwe
# Date 887960872 0
#      Fri Feb 20 07:47:52 1998 +0000
# Node ID a494f93e60ff68065e6b11b0c707a12d64ccf4ad
# Parent  1016520a9d386db9974e5c2e1dd44fbc60567b1b
[project @ 1998-02-20 07:47:48 by jwe]

diff --git a/ChangeLog b/ChangeLog
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,8 +1,23 @@
+Fri Feb 20 00:38:31 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* configure.in, Makeconf.in: Try to set things up to use the
+	system glob and fnmatch headers and functions if they exist.
+	Better handling of include and lib flags.
+
+Thu Feb 19 01:21:19 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* configure.in: Don't check for gamma or lgamma
+	* acconfig.h: Delete undef for HAVE_GAMMA and HAVE_LGAMMA.
+
+Wed Feb 18 15:05:54 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* configure.in: Don't check for vfork.
+
 Wed Feb 11 19:41:22 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* Makeconf.in (mk-libdir-link): Don't create link if a directory
 	named $(libdir)/octave already exists.
 
 Mon Feb  9 14:47:42 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* octMakefile.in (INSTALL_SUBDIRS): Delete @INFO_DIR@.
diff --git a/Makeconf.in b/Makeconf.in
--- a/Makeconf.in
+++ b/Makeconf.in
@@ -78,24 +78,24 @@ DLFCN_INCFLAGS = @DLFCN_INCFLAGS@
 # directory.
 ifeq ($(srcdir),.)
   TMP_IF_1 = -I.
 else
   TMP_IF_1 = -I. -I$(srcdir)
 endif
 ifeq ($(TOPDIR),$(top_srcdir))
   TMP_IF_2 = -I$(TOPDIR) -I$(TOPDIR)/liboctave -I$(TOPDIR)/src \
-	-I$(TOPDIR)/glob -I$(TOPDIR)/libcruft/misc
+	-I$(TOPDIR)/libcruft/misc
 else
   TMP_IF_2 = -I$(TOPDIR) -I$(TOPDIR)/liboctave -I$(TOPDIR)/src \
-	-I$(TOPDIR)/glob -I$(TOPDIR)/libcruft/misc -I$(top_srcdir) \
+	-I$(TOPDIR)/libcruft/misc -I$(top_srcdir) \
 	-I$(top_srcdir)/liboctave -I$(top_srcdir)/src \
-	-I$(top_srcdir)/glob -I$(top_srcdir)/libcruft/misc
+	-I$(top_srcdir)/libcruft/misc
 endif
-INCFLAGS = $(TMP_IF_1) $(TMP_IF_2) $(DLFCN_INCFLAGS)
+INCFLAGS = $(TMP_IF_1) $(TMP_IF_2) $(DLFCN_INCFLAGS) $(GLOB_INCFLAGS)
 
 LIBFLAGS = -L$(TOPDIR)
 
 DEFS = @DEFS@
 
 UGLY_DEFS = @UGLY_DEFS@
 
 CC = @CC@
@@ -131,16 +131,20 @@ SONAME_FLAGS = @SONAME_FLAGS@
 RLD_FLAG = @RLD_FLAG@
 
 FLIBS = @FLIBS@
 
 TERMLIBS = @TERMLIBS@
 LIBDLFCN = @LIBDLFCN@
 LIBPLPLOT = @LIBPLPLOT@
 LIBREADLINE = @LIBREADLINE@
+LIBKPATHSEA = @LIBKPATHSEA@
+LIBOCTINTERP = @LIBOCTINTERP@
+LIBOCTAVE = @LIBOCTAVE@
+LIBCRUFT = @LIBCRUFT@
 SPECIAL_MATH_LIB = @SPECIAL_MATH_LIB@
 
 # The arguments passed to configure.
 config_opts = @config_opts@
 
 # ==================== Where To Install Things ====================
 
 # The default location for installation.  Everything is placed in
diff --git a/acconfig.h b/acconfig.h
--- a/acconfig.h
+++ b/acconfig.h
@@ -31,23 +31,16 @@
 #undef GNUPLOT_HAS_FRAMES
 
 /* Define if your gnuplot has mutliplot. */
 #undef GNUPLOT_HAS_MULTIPLOT
 
 /* Define if your system's struct group has a gr_passwd field. */
 #undef HAVE_GR_PASSWD
 
-#if 0
-/* These are just here to keep autoheader from thinking that they are
-   missing even though they really aren't. */
-#undef HAVE_GAMMA
-#undef HAVE_LGAMMA
-#endif
-
 /* Define if you have isinf(). */
 #undef HAVE_ISINF
 
 /* Define if you have isnan(). */
 #undef HAVE_ISNAN
 
 /* Define if you have BSD style signals. */
 #undef HAVE_BSD_SIGNALS
diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -16,17 +16,17 @@ dnl Copyright (C) 1996, 1997 John W. Eat
 ### FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 ### for more details.
 ### 
 ### You should have received a copy of the GNU General Public License
 ### along with Octave; see the file COPYING.  If not, write to the Free
 ### Software Foundation, 59 Temple Place - Suite 330, Boston, MA
 ### 02111-1307, USA. 
 
-AC_REVISION($Revision: 1.297 $)
+AC_REVISION($Revision: 1.298 $)
 AC_PREREQ(2.9)
 AC_INIT(src/octave.cc)
 AC_CONFIG_HEADER(config.h)
 
 AC_DEFINE(OCTAVE_SOURCE, 1)
 
 OCTAVE_HOST_TYPE
 
@@ -120,17 +120,17 @@ AC_ARG_ENABLE(info,
 if $USE_GNU_INFO; then
   AC_DEFINE(USE_GNU_INFO, 1)
 fi
 
 dnl ### Allow the user disable support for plplot.
 dnl 
 dnl # USE_PLPLOT=true
 dnl # PLPLOT_DIR=plplot
-dnl # LIBPLPLOT=../plplot/libplplot.a
+dnl # LIBPLPLOT='$(TOPDIR)/plplot/libplplot.$(LIBEXT)
 USE_PLPLOT=false
 PLPLOT_DIR=""
 LIBPLPLOT=""
 dnl AC_ARG_ENABLE(plplot,
 dnl   [  --enable-plplot         use plplot for plotting (default is yes)],
 dnl   [if test "$enableval" = no; then
 dnl      USE_PLPLOT=false;
 dnl      LIBPLPLOT="";
@@ -142,30 +142,33 @@ dnl fi
 AC_SUBST(LIBPLPLOT)
 AC_SUBST(PLPLOT_DIR)
 
 ### Allow the user disable support for command line editing using GNU
 ### readline.
 
 READLINE_DIR=readline
 USE_READLINE=true
-LIBREADLINE=../readline/libreadline.a
+LIBREADLINE='$(TOPDIR)/readline/libreadline.$(LIBEXT)'
 AC_ARG_ENABLE(readline,
   [  --enable-readline       use readline library (default is yes)],
   [if test "$enableval" = no; then
      USE_READLINE=false;
      LIBREADLINE="";
      READLINE_DIR="";
    fi], [])
 if $USE_READLINE; then
   AC_DEFINE(USE_READLINE, 1)
 fi
 AC_SUBST(LIBREADLINE)
 AC_SUBST(READLINE_DIR)
 
+LIBKPATHSEA='$(TOPDIR)/kpathsea/libkpathsea.$(LIBEXT)'
+AC_SUBST(LIBKPATHSEA)
+
 ### Make it possible to have Octave's array and matrix classes do bounds
 ### checking on element references.  This slows some operations down a
 ### bit, so it is turned off by default.
 
 BOUNDS_CHECKING=false
 AC_ARG_ENABLE(bounds-check,
   [  --enable-bounds-check   for internal array classes (default is no)],
   [if test "$enableval" = yes; then BOUNDS_CHECKING=true; fi], [])
@@ -512,16 +515,29 @@ AC_ARG_ENABLE(shared,
 AC_SUBST(SHARED_LIBS)
 
 if $STATIC_LIBS || $SHARED_LIBS; then
   true
 else
   AC_MSG_ERROR([You can't disable building static AND shared libraries!])
 fi
 
+if $SHARED_LIBS; then
+  LIBOCTINTERP=-loctinterp
+  LIBOCTAVE=-loctave
+  LIBCRUFT=-lcruft
+else
+  LIBOCTINTERP='$(TOPDIR)/src/liboctinterp.$(LIBEXT)'
+  LIBOCTAVE='$(TOPDIR)/liboctave/liboctave.$(LIBEXT)'
+  LIBCRUFT='$(TOPDIR)/libcruft/libcruft.$(LIBEXT)'
+fi
+AC_SUBST(LIBOCTINTERP)
+AC_SUBST(LIBOCTAVE)
+AC_SUBST(LIBCRUFT)
+
 use_rpath=true
 AC_ARG_ENABLE(rpath,
   [  --enable-rpath          add -rpath to link command for shared libraries],
   [if test "$enableval" = no; then use_rpath=false; fi], [])
 
 DLFCN_DIR=
 CPICFLAG=-fPIC
 CXXPICFLAG=-fPIC
@@ -667,38 +683,57 @@ OCTAVE_STRING_NPOS
 ### Checks for header files.
 
 AC_HEADER_STDC
 AC_HEADER_DIRENT
 AC_HEADER_TIME
 AC_HEADER_SYS_WAIT
 
 AC_CHECK_HEADERS(assert.h curses.h fcntl.h float.h floatingpoint.h \
-  grp.h ieeefp.h limits.h memory.h nan.h ncurses.h pwd.h sgtty.h \
-  stdlib.h string.h sys/param.h sys/resource.h sys/select.h sys/stat.h \
-  sys/time.h sys/times.h sys/types.h sys/utsname.h termcap.h termio.h \
-  termios.h unistd.h varargs.h)
+  fnmatch.h glob.h grp.h ieeefp.h limits.h memory.h nan.h ncurses.h \
+  pwd.h sgtty.h stdlib.h string.h sys/param.h sys/resource.h \
+  sys/select.h sys/stat.h sys/time.h sys/times.h sys/types.h \
+  sys/utsname.h termcap.h termio.h termios.h unistd.h varargs.h)
 
 if test "$ac_cv_header_termios_h" = yes \
     || test "$ac_cv_header_termio_h" = yes \
     || test "$ac_cv_header_sgtty_h" = yes; then
   true
 else
   AC_MSG_ERROR([I couldn't find termios.h, termio.h, or sgtty.h!])
 fi
 
+GLOB_DIR=glob
+LIBGLOB='$(TOPDIR)/glob/libglob.$(LIBEXT)'
+GLOB_INCFLAGS='-I$(top_srcdir)/glob -I$(TOPDIR)/glob'
+if test "$ac_cv_header_fnmatch.h" = yes \
+  && test "$ac_cv_header_glob.h" = yes; then
+  GLOB_DIR=
+  AC_CHECK_LIB(glob, glob)
+  AC_CHECK_FUNCS(fnmatch glob)
+  if test "$ac_cv_func_fnmatch" = yes \
+    && test "$ac_cv_func_glob" = yes; then
+    GLOB_DIR=
+    LIBGLOB=
+    GLOB_INCFLAGS=
+  fi
+fi
+AC_SUBST(GLOB_DIR)
+AC_SUBST(LIBGLOB)
+AC_SUBST(GLOB_INCFLAGS)
+
 ### Checks for functions and variables.
 
 AC_CHECK_FUNCS(atexit bcopy bzero dup2 endgrent endpwent execvp fcntl \
   fork getcwd getegid geteuid getgid getgrent getgrgid getgrnam \
   gethostname getpgrp getpid getppid getpwent getpwnam getpwuid \
   gettimeofday getuid getwd lstat memmove mkdir mkfifo on_exit pipe \
   putenv rename rindex rmdir setgrent setpwent setvbuf sigaction \
   sigpending sigprocmask sigsuspend stat strcasecmp strdup strerror \
-  stricmp strncasecmp strnicmp tempnam umask unlink usleep vfork \
+  stricmp strncasecmp strnicmp tempnam umask unlink usleep \
   vfprintf vsprintf waitpid)
 
 OCTAVE_SMART_PUTENV
 
 LIBDLFCN=
 DLFCN_INCFLAGS=
 if test "$WITH_DL" = yes || test "$WITH_DL" = maybe; then
   case "$canonical_host_type" in
@@ -851,28 +886,16 @@ case "$canonical_host_type" in
     AC_CHECK_FUNCS(finite isnan isinf infinity quiet_nan)
   ;;
 esac
 
 ### Check for nonstandard but common math functions that we need.
 
 AC_CHECK_FUNCS(acosh asinh atanh erf erfc)
 
-case "$canonical_host_type" in
-  *-*-cygwin32)
-    AC_MSG_RESULT(assuming gamma works)
-    AC_DEFINE(HAVE_GAMMA, 1)
-    AC_MSG_RESULT(assuming lgamma works)
-    AC_DEFINE(HAVE_LGAMMA, 1)
-  ;;
-  *)
-    AC_CHECK_FUNCS(gamma lgamma)
-  ;;
-esac
-
 ### Checks for OS specific cruft.
 
 AC_STRUCT_ST_BLKSIZE
 AC_STRUCT_ST_BLOCKS
 AC_STRUCT_ST_RDEV
 AC_STRUCT_TM
 AC_STRUCT_TIMEZONE
 AC_FUNC_CLOSEDIR_VOID
@@ -1081,17 +1104,17 @@ AC_ARG_ENABLE(picky-flags,
    fi], [])
 
 ### Run configure in subdirectories.
 
 export CC
 export CXX
 export F77
 
-AC_CONFIG_SUBDIRS(glob kpathsea scripts $PLPLOT_DIR $READLINE_DIR)
+AC_CONFIG_SUBDIRS($(GLOB_DIR) kpathsea scripts $PLPLOT_DIR $READLINE_DIR)
 
 ### Do the substitutions in all the Makefiles.
 
 AC_OUTPUT(Makefile octMakefile Makeconf test/Makefile dlfcn/Makefile
   doc/Makefile doc/faq/Makefile doc/interpreter/Makefile
   doc/liboctave/Makefile doc/refcard/Makefile emacs/Makefile
   examples/Makefile liboctave/Makefile src/Makefile
   libcruft/Makefile libcruft/Makerules
diff --git a/doc/interpreter/arith.texi b/doc/interpreter/arith.texi
--- a/doc/interpreter/arith.texi
+++ b/doc/interpreter/arith.texi
@@ -769,16 +769,20 @@ Not a number.  This is the result of an 
 @tex
 $0/0$, or $\infty - \infty$,
 @end tex
 @end iftex
 @ifinfo
 0/0, or @samp{Inf - Inf},
 @end ifinfo
 or any operation with a NaN.
+
+Note that NaN always compares not equal to NaN.  This behavior is
+specified by the IEEE standard for floating point arithmetic.  To
+find NaN values, you must use the @code{isnan} function.
 @end defvr
 
 @defvr {Built-in Variable} pi
 The ratio of the circumference of a circle to its diameter.
 Internally, @code{pi} is computed as @samp{4.0 * atan (1.0)}.
 @end defvr
 
 @defvr {Built-in Variable} e
diff --git a/doc/interpreter/basics.texi b/doc/interpreter/basics.texi
--- a/doc/interpreter/basics.texi
+++ b/doc/interpreter/basics.texi
@@ -631,17 +631,17 @@ Move to the first line in the history.
 Move to the end of the input history, i.e., the line you are entering!
 
 @item C-r
 Search backward starting at the current line and moving `up' through
 the history as necessary.  This is an incremental search.
 
 @item C-s
 Search forward starting at the current line and moving `down' through
-the the history as necessary.
+the history as necessary.
 @end table
 
 On most terminals, you can also use the arrow keys in place of @kbd{C-p}
 and @kbd{C-n} to move through the history list.
 
 In addition to the keyboard commands for moving through the history
 list, Octave provides three functions for viewing, editing, and
 re-running chunks of commands from the history list.
diff --git a/doc/interpreter/bugs.texi b/doc/interpreter/bugs.texi
--- a/doc/interpreter/bugs.texi
+++ b/doc/interpreter/bugs.texi
@@ -461,15 +461,15 @@ the change, send us the header line.
 @appendixsec How To Get Help with Octave
 @cindex help, where to find
 
 The mailing list @email{help-octave@@bevo.che.wisc.edu} exists for the
 discussion of matters related to using and installing Octave.  If would
 like to join the discussion, please send a short note to
 @email{help-octave@strong{-request}@@bevo.che.wisc.edu}.
 
-@strong{Please do not} send requests to be added or removed from the the
+@strong{Please do not} send requests to be added or removed from the
 mailing list, or other administrative trivia to the list itself.
 
 If you think you have found a bug in the installation procedure,
 however, you should send a complete bug report for the problem to
 @email{bug-octave@@bevo.che.wisc.edu}.  @xref{Bug Reporting} for
 information that will help you to submit a useful report.
diff --git a/doc/interpreter/errors.texi b/doc/interpreter/errors.texi
--- a/doc/interpreter/errors.texi
+++ b/doc/interpreter/errors.texi
@@ -60,17 +60,17 @@ a single message:
 function h () nargin == 1 || error ("nargin != 1\n"); end
 f ()
 error: nargin != 1
 @end group
 @end example
 @end deftypefn
 
 @defvr {Built-in Variable} error_text
-This variable contains the the text of error messages that would have
+This variable contains the text of error messages that would have
 been printed in the body of the most recent @code{unwind_protect} or
 @code{try} statement or the @var{try} part of the most recent call to
 the @code{eval} function.  Outside of the @code{unwind_protect} and
 @code{try} statements or the @code{eval} function, or if no error has
 occurred within them, the value of @code{error_text} is guaranteed to be
 the empty string.
 
 Note that the message does not include the first @samp{error: } prefix,
diff --git a/doc/interpreter/expr.texi b/doc/interpreter/expr.texi
--- a/doc/interpreter/expr.texi
+++ b/doc/interpreter/expr.texi
@@ -134,17 +134,17 @@ the matrix @code{[ 1, 1, 1, 1 ]}.
 In the first case, Octave is selecting each element corresponding to a
 @samp{1} in the index vector.  In the second, Octave is selecting the
 first element multiple times.
 
 The default value for @code{prefer_zero_one_indexing} is 0.
 @end defvr
 
 Finally, indexing a scalar with a vector of ones can be used to create a
-vector the same size as the the index vector, with each element equal to
+vector the same size as the index vector, with each element equal to
 the value of the original scalar.  For example, the following statements
 
 @example
 @group
 a = 13;
 a ([1, 1, 1, 1])
 @end group
 @end example
diff --git a/doc/interpreter/matrix.texi b/doc/interpreter/matrix.texi
--- a/doc/interpreter/matrix.texi
+++ b/doc/interpreter/matrix.texi
@@ -172,17 +172,17 @@ indices of nonzero elements of a matrix.
 @group
 [i, j] = find (2 * eye (2))
      @result{} i = [ 1; 2 ]
      @result{} j = [ 1; 2 ]
 @end group
 @end example
 
 If three outputs are requested, @code{find} also returns a vector
-containing the the nonzero values.  For example,
+containing the nonzero values.  For example,
 
 @example
 @group
 [i, j, v] = find (3 * eye (2))
      @result{} i = [ 1; 2 ]
      @result{} j = [ 1; 2 ]
      @result{} v = [ 3; 3 ]
 @end group
diff --git a/doc/interpreter/strings.texi b/doc/interpreter/strings.texi
--- a/doc/interpreter/strings.texi
+++ b/doc/interpreter/strings.texi
@@ -281,27 +281,27 @@ This function is patterned after AWK.  Y
 @code{@var{s} (@var{beg} : (@var{beg} + @var{len} - 1))}.  
 @end quotation
 @end deftypefn
 
 @node String Conversions, Character Class Functions, Searching and Replacing, Strings
 @section String Conversions
 
 @deftypefn {Function File} {} bin2dec (@var{s})
-Return a decimal number corresponding to the the binary number
+Return a decimal number corresponding to the binary number
 represented as a string of zeros and ones.  For example,
 
 @example
 bin2dec ("1110")
      @result{} 14
 @end example
 @end deftypefn
 
 @deftypefn {Function File} {} dec2bin (@var{n})
-Return a binary number corresponding the the nonnegative decimal number
+Return a binary number corresponding the nonnegative decimal number
 @var{n}, as a string of ones and zeros.  For example,
 
 @example
 dec2bin (14)
      @result{} "1110"
 @end example
 @end deftypefn
 
diff --git a/doc/interpreter/system.texi b/doc/interpreter/system.texi
--- a/doc/interpreter/system.texi
+++ b/doc/interpreter/system.texi
@@ -778,17 +778,17 @@ fclose (out);
 @end group
 @end example
 @end deftypefn
 
 @defvr {Built-in Variable} EXEC_PATH
 The variable @code{EXEC_PATH} is a colon separated list of directories
 to search when executing subprograms.  Its initial value is taken from
 the environment variable @code{OCTAVE_EXEC_PATH} (if it exists) or
-@code{PATH}, but that value can be overridden by the the command line
+@code{PATH}, but that value can be overridden by the command line
 argument @code{--exec-path PATH}, or by setting the value of
 @code{EXEC_PATH} in a startup script.  If the value of @code{EXEC_PATH}
 begins (ends) with a colon, the directories
 
 @example
 @group
 @var{octave-home}/libexec/octave/site/exec/@var{arch}
 @var{octave-home}/libexec/octave/@var{version}/exec/@var{arch}
diff --git a/libcruft/ChangeLog b/libcruft/ChangeLog
--- a/libcruft/ChangeLog
+++ b/libcruft/ChangeLog
@@ -1,8 +1,13 @@
+Thu Feb 19 21:00:00 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* specfun/ribesl.f, specfun/rjbesl.f: Compute NSIG correctly.
+	Add missing comma in declaration statement.
+
 Sun Feb  1 12:39:10 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* Makefile.in (install, uninstall): Use $(octlibdir), not $(libdir).
 	Use $(mk-libdir-link).
 
 	* quadpack/dqagi.f, quadpack/dqagie.f, quadpack/dqagp.f,
 	quadpack/dqagpe.f, quadpack/dqk15i.f, quadpack/dqk21.f:
 	Make user-supplied code a subroutine instead of a function.
diff --git a/libcruft/specfun/ribesl.f b/libcruft/specfun/ribesl.f
--- a/libcruft/specfun/ribesl.f
+++ b/libcruft/specfun/ribesl.f
@@ -164,17 +164,17 @@ C
 C  Modified by: W. J. Cody and L. Stoltz
 C               Applied Mathematics Division
 C               Argonne National Laboratory
 C               Argonne, IL  60439
 C
 C-------------------------------------------------------------------
       LOGICAL FIRST
       INTEGER IZE,K,L,MAGX,N,NB,NBMX,NCALC,NEND,NSIG,NSTART
-      DOUBLE PRECISION DGAMMA, D1MACH
+      DOUBLE PRECISION DGAMMA, D1MACH,
      1 ALPHA,B,CONST,CONV,EM,EMPAL,EMP2AL,EN,ENMTEN,ENSIG,
      2 ENTEN,EXPARG,FUNC,HALF,HALFX,ONE,P,PLAST,POLD,PSAVE,PSAVEL,
      3 RTNSIG,SUM,TEMPA,TEMPB,TEMPC,TEST,TOVER,TWO,X,XLARGE,ZERO
       DIMENSION B(NB)
 C-------------------------------------------------------------------
 C  Mathematical constants
 C-------------------------------------------------------------------
       PARAMETER (ONE = 1.0D0, TWO = 2.0D0, ZERO = 0.0D0)
@@ -187,17 +187,17 @@ C---------------------------------------
 C  Statement functions for conversion
 C-------------------------------------------------------------------
       CONV(N) = DBLE(N)
       FUNC(X) = DGAMMA(X)
 C-------------------------------------------------------------------
 C  Machine-dependent parameters
 C-------------------------------------------------------------------
       IF (FIRST) THEN
-        NSIG = NINT (-LOG (D1MACH (1)))
+        NSIG = NINT (-LOG (D1MACH (4)))
         ENTEN = 1.0D1 ** (INT (LOG10 (D1MACH (2))))
         ENSIG = 1.0D1 ** NSIG
         RTNSIG = 1.0D1 ** (-NINT (NSIG / 4.0))
         ENMTEN = 4.0D0 * D1MACH (1)
         EXPARG = LOG (D1MACH (2))
         XLARGE = 1.0D4
         FIRST = .FALSE.
       ENDIF
diff --git a/libcruft/specfun/rjbesl.f b/libcruft/specfun/rjbesl.f
--- a/libcruft/specfun/rjbesl.f
+++ b/libcruft/specfun/rjbesl.f
@@ -134,17 +134,17 @@ C
 C  Author: W. J. Cody
 C          Applied Mathematics Division
 C          Argonne National Laboratory
 C          Argonne, IL  60439
 C
 C---------------------------------------------------------------------
       LOGICAL FIRST
       INTEGER I,J,K,L,M,MAGX,N,NB,NBMX,NCALC,NEND,NSIG,NSTART
-      DOUBLE PRECISION  DGAMMA, D1MACH
+      DOUBLE PRECISION  DGAMMA, D1MACH,
      1 ALPHA,ALPEM,ALP2EM,B,CAPP,CAPQ,CONV,EIGHTH,EM,EN,ENMTEN,ENSIG,
      2 ENTEN,FACT,FOUR,FUNC,GNU,HALF,HALFX,ONE,ONE30,P,PI2,PLAST,
      3 POLD,PSAVE,PSAVEL,RTNSIG,S,SUM,T,T1,TEMPA,TEMPB,TEMPC,TEST,
      4 THREE,THREE5,TOVER,TWO,TWOFIV,TWOPI1,TWOPI2,X,XC,XIN,XK,XLARGE,
      5 XM,VCOS,VSIN,Z,ZERO
       DIMENSION B(NB), FACT(25)
 C---------------------------------------------------------------------
 C  Mathematical constants
@@ -178,17 +178,17 @@ C---------------------------------------
 C Statement functions for conversion and the gamma function.
 C---------------------------------------------------------------------
       CONV(I) = DBLE(I)
       FUNC(X) = DGAMMA(X)
 C---------------------------------------------------------------------
 C  Machine-dependent parameters
 C---------------------------------------------------------------------
       IF (FIRST) THEN
-        NSIG = NINT (-LOG (D1MACH (1)))
+        NSIG = NINT (-LOG (D1MACH (4)))
         ENTEN = 1.0D1 ** (INT (LOG10 (D1MACH (2))))
         ENSIG = 1.0D1 ** NSIG
         RTNSIG = 1.0D1 ** (-NINT (NSIG / 4.0))
         ENMTEN = 4.0D0 * D1MACH (1)
         XLARGE = 1.0D4
         FIRST = .FALSE.
       ENDIF
 C---------------------------------------------------------------------
diff --git a/liboctave/ChangeLog b/liboctave/ChangeLog
--- a/liboctave/ChangeLog
+++ b/liboctave/ChangeLog
@@ -1,8 +1,18 @@
+Thu Feb 19 01:16:38 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* lo-specfun.cc (xgamma, xlgamma): Define here.
+	* lo-mappers.cc: Not here.
+
+	* lo-specfun.h: Declare xgamma and xlgamma here.
+	* lo-mappers.h: Not here.
+
+	* lo-specfun.h: Never declare gamma or lgamma.
+
 Tue Feb 10 16:14:36 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* Array-idx.h (assign): Allow A([]) = X to succeed if X is an
 	empty matrix of any dimension.
 
 Thu Feb  5 02:12:38 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* oct-syscalls.cc (octave_syscalls::vfork): New function.
diff --git a/liboctave/lo-mappers.cc b/liboctave/lo-mappers.cc
--- a/liboctave/lo-mappers.cc
+++ b/liboctave/lo-mappers.cc
@@ -36,35 +36,24 @@ Software Foundation, 59 Temple Place - S
 
 #include "f77-fcn.h"
 
 #if defined (_AIX) && defined (__GNUG__)
 #undef finite
 #define finite(x) ((x) < DBL_MAX && (x) > -DBL_MAX)
 #endif
 
-extern "C"
-{
-  int F77_FCN (xdgamma, XDGAMMA) (const double&, double&);
-
-  int F77_FCN (dlgams, DLGAMS) (const double&, double&, double&);
-}
-
 #ifndef M_LOG10E
 #define M_LOG10E 0.43429448190325182765
 #endif
 
 #ifndef M_PI
 #define M_PI 3.14159265358979323846
 #endif
 
-#if defined (HAVE_LGAMMA) && ! defined (SIGNGAM_DECLARED)
-extern int signgam;
-#endif
-
 // Double -> double mappers.
 
 double
 arg (double x)
 {
   if (x < 0.0)
     return M_PI;
   else
@@ -165,48 +154,27 @@ xfinite (double x)
 #elif defined (HAVE_ISINF) && defined (HAVE_ISNAN)
   return (! isinf (x) && ! isnan (x));
 #else
   return 1;
 #endif
 }
 
 double
-xgamma (double x)
-{
-  double result;
-
-  F77_XFCN (xdgamma, XDGAMMA, (x, result));
-
-  return result;
-}
-
-double
 xisinf (double x)
 {
 #if defined (HAVE_ISINF)
   return isinf (x);
 #elif defined (HAVE_FINITE) && defined (HAVE_ISNAN)
   return (! (finite (x) || isnan (x)));
 #else
   return 0;
 #endif
 }
 
-double
-xlgamma (double x)
-{
-  double result;
-  double sgngam;
-
-  F77_XFCN (dlgams, DLGAMS, (x, result, sgngam));
-
-  return result;
-}
-
 // Complex -> double mappers.
 
 double
 xisnan (const Complex& x)
 {
 #if defined (HAVE_ISNAN)
   return (isnan (real (x)) || isnan (imag (x)));
 #else
diff --git a/liboctave/lo-mappers.h b/liboctave/lo-mappers.h
--- a/liboctave/lo-mappers.h
+++ b/liboctave/lo-mappers.h
@@ -31,19 +31,17 @@ extern double fix (double x);
 extern double imag (double x);
 extern double real (double x);
 extern double round (double x);
 extern double signum (double x);
 extern double xerf (double x);
 extern double xerfc (double x);
 extern double xisnan (double x);
 extern double xfinite (double x);
-extern double xgamma (double x);
 extern double xisinf (double x);
-extern double xlgamma (double x);
 
 extern double xisnan (const Complex& x);
 extern double xfinite (const Complex& x);
 extern double xisinf (const Complex& x);
 
 extern Complex acos (const Complex& x);
 extern Complex acosh (const Complex& x);
 extern Complex asin (const Complex& x);
diff --git a/liboctave/lo-specfun.cc b/liboctave/lo-specfun.cc
--- a/liboctave/lo-specfun.cc
+++ b/liboctave/lo-specfun.cc
@@ -110,45 +110,32 @@ double
 erfc (double x)
 {
   double retval;
   F77_XFCN (derfc, DERFC, (x, retval));
   return retval;
 }
 #endif
 
-#if !defined (HAVE_GAMMA)
 double
-gamma (double x)
+xgamma (double x)
 {
-  double retval;
-  F77_XFCN (xdgamma, XDGAMMA, (x, retval));
-  return retval;
+  double result;
+  F77_XFCN (xdgamma, XDGAMMA, (x, result));
+  return result;
 }
-#endif
-
-#if !defined (HAVE_LGAMMA)
-// If the system doesn't have lgamma, assume that it doesn't have
-// signgam either.
-
-int signgam;
 
 double
-lgamma (double x)
+xlgamma (double x)
 {
-  double retval;
+  double result;
   double sgngam;
-
-  F77_XFCN (dlgams, DLGAMS, (x, retval, sgngam));
-
-  signgam = (int) sgngam;
-
-  return retval;
+  F77_XFCN (dlgams, DLGAMS, (x, result, sgngam));
+  return result;
 }
-#endif
 
 int
 F77_FCN (ribesl, RIBESL) (const double& x, const double& alpha,
 			  const int& nb, double *result, int& ncalc)
 {
   int retval = 0;
   F77_FCN (ribesl, RIBESL) (x, alpha, nb, 1, result, ncalc);
   return retval;
diff --git a/liboctave/lo-specfun.h b/liboctave/lo-specfun.h
--- a/liboctave/lo-specfun.h
+++ b/liboctave/lo-specfun.h
@@ -42,23 +42,18 @@ extern double atanh (double);
 #if !defined (HAVE_ERF)
 extern double erf (double);
 #endif
 
 #if !defined (HAVE_ERFC)
 extern double erfc (double);
 #endif
 
-#if !defined (HAVE_GAMMA)
-extern double gamma (double);
-#endif
-
-#if !defined (HAVE_LGAMMA)
-extern double lgamma (double);
-#endif
+extern double xgamma (double x);
+extern double xlgamma (double x);
 
 extern Matrix besselj (double alpha, const Matrix& x);
 extern Matrix bessely (double alpha, const Matrix& x);
 extern Matrix besseli (double alpha, const Matrix& x);
 extern Matrix besselk (double alpha, const Matrix& x);
 
 extern Matrix besselj (const Range& alpha, const ColumnVector& x);
 extern Matrix bessely (const Range& alpha, const ColumnVector& x);
diff --git a/octMakefile.in b/octMakefile.in
--- a/octMakefile.in
+++ b/octMakefile.in
@@ -29,17 +29,17 @@ DISTFILES = $(CONF_DISTFILES) \
 	THANKS move-if-change octave-sh octave-bug.in \
 	install-octave mkinstalldirs mkoctfile.in texi2dvi \
 	ChangeLog ChangeLog.[0-9]
 
 # Complete directory trees to distribute.
 DISTDIRS = glob kpathsea readline # plplot
 
 # Subdirectories in which to run `make all'.
-SUBDIRS = @PLPLOT_DIR@ @READLINE_DIR@ @DLFCN_DIR@ glob \
+SUBDIRS = @PLPLOT_DIR@ @READLINE_DIR@ @DLFCN_DIR@ @GLOB_DIR@ \
 	kpathsea libcruft liboctave src scripts doc examples
 
 
 # Subdirectories in which to run `make all'.
 INSTALL_SUBDIRS = libcruft liboctave src scripts doc examples
 
 # Subdirectories in which to run `make conf-dist'.
 CONF_DISTSUBDIRS = src
@@ -55,17 +55,17 @@ XBINDISTFILES = BUGS COPYING INSTALL INS
 
 BINDISTFILES = $(addprefix $(srcdir)/, $(XBINDISTFILES)) \
 	octave-bug config.status config.h VERSION ARCH
 
 # Subdirectories in which to run `make bin-dist'.
 BINDISTSUBDIRS = libcruft liboctave src scripts doc emacs examples
 
 # Subdirectories in which to run clean targets.
-CLEANSUBDIRS = $(DISTSUBDIRS) glob kpathsea
+CLEANSUBDIRS = $(DISTSUBDIRS) @READLINE_DIR@ @GLOB_DIR@ kpathsea
 
 DIRS_TO_MAKE = $(bindir) $(libdir) $(octincludedir) $(fcnfiledir) \
   $(octfiledir) $(archlibdir) $(localarchlibdir) \
   `echo $(localfcnfilepath) | awk -F: '{for (i=1; i<=NF; i++) print $i}'` \
   `echo $(localoctfilepath) | awk -F: '{for (i=1; i<=NF; i++) print $i}'`
 
 all: octave-bug mkoctfile $(SUBDIRS)
 .PHONY: all
diff --git a/scripts/ChangeLog b/scripts/ChangeLog
--- a/scripts/ChangeLog
+++ b/scripts/ChangeLog
@@ -1,11 +1,12 @@
-Fri Feb  6 00:29:50 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+Fri Feb 20 01:31:32 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
-	* miscellaneous/popen2.m: Use vfork instead of fork.
+	* plot/mplot.m, plot/subplot.m, plot/oneplot.m, plot/multiplot.m,
+	plot/subwindow.m: Call clearplot after setting up multiplot mode.
 
 Tue Feb  3 00:18:40 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* special-matrix/sylvester_matrix.m: Rename from hadamard.m
 
 	* miscellaneous/bug_report.m: Don't try to get smart with
 	OCTAVE_HOME.  Assume octave-bug can be found in EXEC_PATH.
 
diff --git a/scripts/miscellaneous/popen2.m b/scripts/miscellaneous/popen2.m
--- a/scripts/miscellaneous/popen2.m
+++ b/scripts/miscellaneous/popen2.m
@@ -54,17 +54,17 @@ function [in, out, pid] = popen2 (comman
 
     if (isstr (command))
 
       [stdin_pipe, stdin_status] = pipe ();
       [stdout_pipe, stdout_status] = pipe ();
 
       if (stdin_status == 0 && stdout_status == 0)
 
-	pid = vfork ();
+	pid = fork ();
 
 	if (pid == 0)
 
 	  fclose (stdin_pipe (2));
 	  fclose (stdout_pipe (1));
 
 	  dup2 (stdin_pipe (1), stdin);
 	  fclose (stdin_pipe (1));
diff --git a/scripts/plot/mplot.m b/scripts/plot/mplot.m
--- a/scripts/plot/mplot.m
+++ b/scripts/plot/mplot.m
@@ -69,11 +69,13 @@ function mplot (...)
       endif
     endif
 
     xo = (__multiplot_xi__ - 1.0) * __multiplot_xsize__;
     yo = (__multiplot_yn__ - __multiplot_yi) * __multiplot_ysize__;
 
     eval (sprintf ("gset origin %g, %g", xo, yo));
 
+    clearplot;
+
   endif
 
 endfunction
diff --git a/scripts/plot/multiplot.m b/scripts/plot/multiplot.m
--- a/scripts/plot/multiplot.m
+++ b/scripts/plot/multiplot.m
@@ -93,11 +93,13 @@ function multiplot (xn, yn)
     __multiplot_mode__ = 1;
     __multiplot_xsize__ = xsize;
     __multiplot_ysize__ = ysize;
     __multiplot_xn__ = xn;
     __multiplot_yn__ = yn;
     __multiplot_xi__ = 1;
     __multiplot_yi__ = 1;
 
+    clearplot;
+
   endif
 
 endfunction
diff --git a/scripts/plot/oneplot.m b/scripts/plot/oneplot.m
--- a/scripts/plot/oneplot.m
+++ b/scripts/plot/oneplot.m
@@ -35,13 +35,14 @@ function oneplot ()
 
     global __multiplot_mode__ = 0;
 
     if (__multiplot_mode__)
       gset nomultiplot;
       gset size 1, 1;
       gset origin 0, 0;
       __multiplot_mode__ = 0;
+      clearplot;
     endif
 
   endif
 
 endfunction
diff --git a/scripts/plot/subplot.m b/scripts/plot/subplot.m
--- a/scripts/plot/subplot.m
+++ b/scripts/plot/subplot.m
@@ -145,11 +145,13 @@ function subplot (rows, columns, index)
 
     ## set the origin
 
     xo = (xp - 1.0) * __multiplot_xsize__;
     yo = (rows - yp) * __multiplot_ysize__;
 
     eval (sprintf ("gset origin %g, %g", xo, yo));
 
+    clearplot;
+
   endif
 
 endfunction
diff --git a/scripts/plot/subwindow.m b/scripts/plot/subwindow.m
--- a/scripts/plot/subwindow.m
+++ b/scripts/plot/subwindow.m
@@ -73,9 +73,11 @@ function subwindow (xn, yn)
     error ("subwindow: incorrect xn and yn");
   endif
 
   xo = (xn - 1.0) * __multiplot_xsize__;
   yo = (__multiplot_yn__ - yn) * __multiplot_ysize__;
 
   eval (sprintf ("gset origin %g, %g", xo, yo));
 
+  clearplot;
+
 endfunction
diff --git a/src/ChangeLog b/src/ChangeLog
--- a/src/ChangeLog
+++ b/src/ChangeLog
@@ -1,8 +1,47 @@
+Fri Feb 20 00:41:06 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* pt-plot.cc (GPLOT_CMD_REPLOT): Clear before replot.
+
+	* Makefile.in: Better handling of lib flags for linking.
+
+Thu Feb 19 21:14:30 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* pt-decl.cc (Vinitialize_global_values): New static variable.
+	(initialize_global_variables): New function.
+	(symbols_of_pt_decl): New function.
+	DEFVAR Vinitialize_global_values and initialize_global_variables.
+	(tree_global_command::do_init): If initialize_global_variables is
+	not true and the variable doesn't have an explicit initializer, don't
+	initialize it.  If we are giving it a default value, use the value
+	of the variable defualt_global_variable_value.
+	* octave.cc (maximum_braindamage): Set default_global_variable_value
+	and initialize_global_variables to Matlab-compatible values.
+
+Wed Feb 18 04:35:31 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* DLD-FUNCTIONS/besselj.cc: Rename from bessel.cc.
+	* Makefile.in (DLD_XSRC): Likewise.
+
+	* syscalls.cc (Fvfork): Delete.
+
+	* oct-procbuf.cc: Just use fork.
+
+	* parse.y (feval): Provide version that takes function name
+	separate from other args.
+	* parse.h: Declare it.
+
+	* oct-procbuf.cc (octave_procbuf::open): Move declaration of
+	child_std_end outside of child scope and declare volatile.
+
+Mon Feb 16 15:04:28 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* parse.y: Include cstdio, for SEEK_SET.
+
 Thu Feb 12 22:07:00 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* system.c: New file.
 	* Makefile.in (SOURCES): Add it to the list.
 
 Fri Feb  6 01:23:18 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* oct-stream.cc (octave_base_stream::file_number): Rename from fileno.
diff --git a/src/Makefile.in b/src/Makefile.in
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -34,17 +34,17 @@ ifeq ($(OCTAVE_LITE), true)
     %.oct : pic/%.o
 	  $(SH_LD) $(SH_LDFLAGS) -o $@ $<
   else
     %.oct : %.o
 	  $(SH_LD) $(SH_LDFLAGS) -o $@ $<
   endif
 endif
 
-DLD_XSRC := balance.cc bessel.cc betainc.cc chol.cc colloc.cc dassl.cc \
+DLD_XSRC := balance.cc besselj.cc betainc.cc chol.cc colloc.cc dassl.cc \
 	det.cc eig.cc expm.cc fft.cc fft2.cc filter.cc find.cc \
 	fsolve.cc gammainc.cc getgrent.cc getpwent.cc getrusage.cc \
 	givens.cc hess.cc ifft.cc ifft2.cc inv.cc log.cc lpsolve.cc \
 	lsode.cc lu.cc minmax.cc pinv.cc qr.cc quad.cc qzval.cc rand.cc \
 	schur.cc sort.cc svd.cc syl.cc time.cc
 
 DLD_SRC := $(addprefix DLD-FUNCTIONS/, $(DLD_XSRC))
 
@@ -162,21 +162,21 @@ DEF_FILES := $(patsubst %.cc, %.df, $(DE
 
 VAR_5 := $(SOURCES) $(DLD_SRC)
 VAR_4 := $(addprefix $(srcdir)/, $(VAR_5))
 VAR_3 := $(notdir $(shell egrep -l "^[\t ]*DEF(VAR|CONST)" $(VAR_4)))
 VAR_2 := $(patsubst %.y, %, $(VAR_3))
 VAR_1 := $(patsubst %.l, %, $(VAR_2))
 VAR_FILES := $(patsubst %.cc, %, $(VAR_1))
 
-OCTAVE_LFLAGS = -L../liboctave -L../libcruft -L../glob \
-	-L../dlfcn -L. $(RLD_FLAG)
+OCTAVE_LFLAGS = -L$(TOPDIR)/liboctave -L$(TOPDIR)/libcruft \
+  -L$(TOPDIR)/src $(RLD_FLAG)
 
-OCTAVE_LIBS = -loctinterp -loctave $(SPECIAL_MATH_LIB) -lcruft $(LIBPLPLOT) \
-	$(LIBREADLINE) ../kpathsea/libkpathsea.$(LIBEXT) -lglob $(LIBDLFCN)
+OCTAVE_LIBS = $(LIBOCTINTERP) $(LIBOCTAVE) $(SPECIAL_MATH_LIB) $(LIBCRUFT) \
+  $(LIBPLPLOT) $(LIBREADLINE) $(LIBKPATHSEA) $(LIBGLOB) $(LIBDLFCN)
 
 LIBS = @LIBS@
 
 DISTFILES = Makefile.in ChangeLog mkdefs mkops mkbuiltins mk-oct-links \
 	defaults.h.in oct-conf.h.in octave.gperf oct-gperf.h \
 	octave.cc parse.cc lex.cc y.tab.h \
 	$(INCLUDES) $(DIST_SRC)
 
diff --git a/src/mappers.cc b/src/mappers.cc
--- a/src/mappers.cc
+++ b/src/mappers.cc
@@ -22,16 +22,17 @@ Software Foundation, 59 Temple Place - S
 
 #ifdef HAVE_CONFIG_H
 #include <config.h>
 #endif
 
 #include <cctype>
 #include <cfloat>
 
+#include "lo-specfun.h"
 #include "lo-mappers.h"
 
 #include "defun.h"
 #include "error.h"
 #include "ov-mapper.h"
 #include "variables.h"
 
 // XXX FIXME XXX -- perhaps this could be avoided by determining
diff --git a/src/oct-procbuf.cc b/src/oct-procbuf.cc
--- a/src/oct-procbuf.cc
+++ b/src/oct-procbuf.cc
@@ -50,16 +50,18 @@ static octave_procbuf *octave_procbuf_li
 
 octave_procbuf *
 octave_procbuf::open (const char *command, int mode)
 {
 #if defined (HAVE_SYS_WAIT_H)
 
   int pipe_fds[2];
 
+  volatile int child_std_end = (mode & ios::in) ? 1 : 0;
+
   volatile int parent_end, child_end;
 
   if (is_open ())
     return 0;
 
   if (pipe (pipe_fds) < 0)
     return 0;
 
@@ -69,31 +71,25 @@ octave_procbuf::open (const char *comman
       child_end = pipe_fds[1];
     }
   else
     {
       parent_end = pipe_fds[1];
       child_end = pipe_fds[0];
     }
 
-#if defined HAVE_VFORK
-  proc_pid = vfork ();
-#else
-  proc_pid = fork ();
-#endif
+  proc_pid = ::fork ();
 
   if (proc_pid == 0)
     {
-      int child_std_end = (mode & ios::in) ? 1 : 0;
-
       ::close (parent_end);
 
       if (child_end != child_std_end)
 	{
-	  dup2 (child_end, child_std_end);
+	  ::dup2 (child_end, child_std_end);
 	  ::close (child_end);
 	}
 
       while (octave_procbuf_list)
 	{
 	  ::close (octave_procbuf_list->fd ());
 	  octave_procbuf_list = octave_procbuf_list->next;
 	}
@@ -148,17 +144,17 @@ octave_procbuf::sys_close (void)
 	}
     }
 
   if (status < 0 || ::close (fd ()) < 0)
     return -1;
 
   do
     {
-      wait_pid = waitpid (proc_pid, &wstatus, 0);
+      wait_pid = ::waitpid (proc_pid, &wstatus, 0);
     }
   while (wait_pid == -1 && errno == EINTR);
 
   if (wait_pid == -1)
     return -1;
 
   return wstatus;
 
diff --git a/src/octave.cc b/src/octave.cc
--- a/src/octave.cc
+++ b/src/octave.cc
@@ -317,23 +317,25 @@ initialize_error_handlers ()
 
 static void
 maximum_braindamage (void)
 {
   bind_builtin_variable ("PS1", ">> ");
   bind_builtin_variable ("PS2", "");
   bind_builtin_variable ("beep_on_error", 1.0);
   bind_builtin_variable ("default_eval_print_flag", 0.0);
+  bind_builtin_variable ("default_global_variable_value", Matrix ());
   bind_builtin_variable ("default_save_format", "mat-binary");
   bind_builtin_variable ("define_all_return_values", 1.0);
   bind_builtin_variable ("do_fortran_indexing", 1.0);
   bind_builtin_variable ("empty_list_elements_ok", 1.0);
   bind_builtin_variable ("fixed_point_format", 1.0);
   bind_builtin_variable ("implicit_num_to_str_ok", 1.0);
   bind_builtin_variable ("implicit_str_to_num_ok", 1.0);
+  bind_builtin_variable ("initialize_global_variables", 1.0);
   bind_builtin_variable ("ok_to_lose_imaginary_part", 1.0);
   bind_builtin_variable ("page_screen_output", 0.0);
   bind_builtin_variable ("prefer_column_vectors", 0.0);
   bind_builtin_variable ("print_empty_dimensions", 0.0);
   bind_builtin_variable ("treat_neg_dim_as_zero", 1.0);
   bind_builtin_variable ("warn_function_name_clash", 0.0);
   bind_builtin_variable ("whitespace_in_literal_matrix", "traditional");
 }
diff --git a/src/ov-usr-fcn.cc b/src/ov-usr-fcn.cc
--- a/src/ov-usr-fcn.cc
+++ b/src/ov-usr-fcn.cc
@@ -551,17 +551,17 @@ return_last_computed_value (void)
 }
 
 void
 symbols_of_ov_usr_fcn (void)
 {
   DEFVAR (default_return_value, Matrix (), 0, 0,
     "the default for value for unitialized variables returned from\n\
 functions.  Only used if the variable initialize_return_values is\n\
-set to \"true\".");
+nonzero.");
 
   DEFVAR (define_all_return_values, 0.0, 0, define_all_return_values,
     "control whether values returned from functions should have a\n\
 value even if one has not been explicitly assigned.  See also\n\
 default_return_value");
 
   DEFVAR (max_recursion_depth, 256.0, 0, max_recursion_depth,
     "maximum nesting level for functions called recursively.\n\
diff --git a/src/parse.h b/src/parse.h
--- a/src/parse.h
+++ b/src/parse.h
@@ -77,16 +77,19 @@ parse_and_execute (const string& s, bool
 		   const char *warn_for = 0);
 
 extern string get_help_from_file (const string& f);
 
 extern bool
 load_fcn_from_file (symbol_record *sym_rec, bool exec_script);
 
 extern octave_value_list
+feval (const string& name, const octave_value_list& args, int nargout);
+
+extern octave_value_list
 feval (const octave_value_list& args, int nargout);
 
 extern octave_value_list
 eval_string (const string&, bool silent, int& parse_status, int hargout);
 
 extern octave_value
 eval_string (const string&, bool silent, int& parse_status);
 
diff --git a/src/parse.y b/src/parse.y
--- a/src/parse.y
+++ b/src/parse.y
@@ -26,16 +26,18 @@ Software Foundation, 59 Temple Place - S
 
 %{
 #define YYDEBUG 1
 
 #ifdef HAVE_CONFIG_H
 #include <config.h>
 #endif
 
+#include <cstdio>
+
 #ifdef YYBYACC
 #include <cstdlib>
 #endif
 
 #include <strstream.h>
 
 #include "Matrix.h"
 #include "cmd-edit.h"
@@ -2908,41 +2910,57 @@ script file but without requiring the fi
     }
   else
     print_usage ("source");
 
   return retval;
 }
 
 octave_value_list
+feval (const string& name, const octave_value_list& args, int nargout)
+{
+  octave_value_list retval;
+
+  octave_function *fcn = is_valid_function (name, "feval", 1);
+
+  if (fcn)
+    retval = fcn->do_index_op (nargout, args);
+
+  return retval;
+}
+
+octave_value_list
 feval (const octave_value_list& args, int nargout)
 {
   octave_value_list retval;
 
-  octave_function *fcn = is_valid_function (args(0), "feval", 1);
-
-  if (fcn)
+  if (args.length () > 0)
     {
-      string_vector arg_names = args.name_tags ();
-
-      int tmp_nargin = args.length () - 1;
-
-      octave_value_list tmp_args (tmp_nargin, octave_value ());
-
-      string_vector tmp_arg_names (tmp_nargin);
-
-      for (int i = 0; i < tmp_nargin; i++)
+      string name = args(0).string_value ();
+
+      if (! error_state)
 	{
-	  tmp_args(i) = args(i+1);
-	  tmp_arg_names(i) = arg_names(i+1);
+	  string_vector arg_names = args.name_tags ();
+
+	  int tmp_nargin = args.length () - 1;
+
+	  octave_value_list tmp_args (tmp_nargin, octave_value ());
+
+	  string_vector tmp_arg_names (tmp_nargin);
+
+	  for (int i = 0; i < tmp_nargin; i++)
+	    {
+	      tmp_args(i) = args(i+1);
+	      tmp_arg_names(i) = arg_names(i+1);
+	    }
+
+	  tmp_args.stash_name_tags (tmp_arg_names);
+
+	  retval = feval (name, tmp_args, nargout);
 	}
-
-      tmp_args.stash_name_tags (tmp_arg_names);
-
-      retval = fcn->do_index_op (nargout, tmp_args);
     }
 
   return retval;
 }
 
 DEFUN (feval, args, nargout,
   "feval (NAME, ARGS, ...)\n\
 \n\
diff --git a/src/pt-decl.cc b/src/pt-decl.cc
--- a/src/pt-decl.cc
+++ b/src/pt-decl.cc
@@ -23,24 +23,31 @@ Software Foundation, 59 Temple Place - S
 #if defined (__GNUG__)
 #pragma implementation
 #endif
 
 #ifdef HAVE_CONFIG_H
 #include <config.h>
 #endif
 
+#include "defun.h"
 #include "error.h"
 #include "pt-cmd.h"
 #include "ov.h"
 #include "oct-lvalue.h"
 #include "pt-decl.h"
 #include "pt-exp.h"
 #include "pt-id.h"
 #include "pt-walk.h"
+#include "utils.h"
+#include "variables.h"
+
+// Control whether otherwise uninitialized global variables are
+// given a default value.
+static int Vinitialize_global_variables;
 
 // Declarations (global, static, etc.).
 
 tree_decl_elt::~tree_decl_elt (void)
 {
   delete id;
   delete expr;
 }
@@ -92,22 +99,23 @@ tree_global_command::do_init (tree_decl_
   tree_identifier *id = elt.ident ();
 
   if (id)
     {
       id->link_to_global ();
 
       octave_lvalue ult = id->lvalue ();
 
-      if (ult.is_undefined ())
+      if (ult.is_undefined () && Vinitialize_global_variables)
 	{
 	  tree_expression *expr = elt.expression ();
 
 	  octave_value init_val = expr
-	    ? expr->rvalue () : octave_value (Matrix ());
+	    ? expr->rvalue ()
+	    : builtin_any_variable ("default_global_variable_value");
 
 	  ult.assign (octave_value::asn_eq, init_val);
 	}
     }
 }
 
 void
 tree_global_command::eval (void)
@@ -160,13 +168,34 @@ tree_static_command::eval (void)
       initialized = true;
 
       if (error_state > 0)
 	::error ("evaluating static command near line %d, column %d",
 		 line (), column ());
     }
 }
 
+static int
+initialize_global_variables (void)
+{
+  Vinitialize_global_variables
+    = check_preference ("initialize_global_variables");
+
+  return 0;
+}
+
+void
+symbols_of_pt_decl (void)
+{
+  DEFVAR (default_global_variable_value, , 0, 0,
+    "the default for value for otherwise uninitialized global variables.\n\
+Only used if the variable initialize_global_variables is nonzero.");
+
+  DEFVAR (initialize_global_variables, 0.0, 0, initialize_global_variables,
+    "control whether otherwise uninitialized global variables are\n\
+given a default value.  See also default_global_variable_value");
+}
+
 /*
 ;;; Local Variables: ***
 ;;; mode: C++ ***
 ;;; End: ***
 */
diff --git a/src/pt-plot.cc b/src/pt-plot.cc
--- a/src/pt-plot.cc
+++ b/src/pt-plot.cc
@@ -104,17 +104,17 @@ static pid_t plot_stream_pid = 0;
 // Use shortest possible abbreviations to minimize trouble caused by
 // gnuplot's fixed-length command line buffer.
 
 #ifndef GPLOT_CMD_PLOT  
 #define GPLOT_CMD_PLOT   "pl"
 #endif
 
 #ifndef GPLOT_CMD_REPLOT 
-#define GPLOT_CMD_REPLOT "rep"
+#define GPLOT_CMD_REPLOT "cle;rep"
 #endif
 
 #ifndef GPLOT_CMD_SPLOT 
 #define GPLOT_CMD_SPLOT  "sp"
 #endif
 
 #ifndef GPLOT_CMD_USING
 #define GPLOT_CMD_USING  "u"
diff --git a/src/syscalls.cc b/src/syscalls.cc
--- a/src/syscalls.cc
+++ b/src/syscalls.cc
@@ -280,47 +280,16 @@ has occured, and MSG contains a system-d
       retval(1) = msg;
     }
   else
     print_usage ("fork");
 
   return retval;
 }
 
-DEFUN (vfork, args, ,
- "[PID, MSG] = vfork ()\n\
-\n\
-Create a copy of the current process.\n\
-\n\
-If successful, PID is either the process ID and you are in the parent,\n\
-or 0, and you are in the child.  If PID is less than zero, an error\n\
-has occured, and MSG contains a system-dependent error message.")
-{
-  octave_value_list retval;
-
-  retval(1) = string ();
-  retval(0) = -1.0;
-
-  int nargin = args.length ();
-
-  if (nargin == 0)
-    {
-      string msg;
-
-      pid_t pid = octave_syscalls::vfork (msg);
-
-      retval(0) = static_cast<double> (pid);
-      retval(1) = msg;
-    }
-  else
-    print_usage ("vfork");
-
-  return retval;
-}
-
 DEFUN (getpgrp, args, ,
   "pgid = getpgrp (): return the process group id of the current process")
 {
   octave_value_list retval;
 
   retval(1) = string ();
   retval(0) = -1.0;
 
