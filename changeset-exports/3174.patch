# HG changeset patch
# User jwe
# Date 894299786 0
#      Mon May 04 16:36:26 1998 +0000
# Node ID 390d5e39668205dad06ce4670b0412c7bd30abc8
# Parent  eec9be0f7f5c05dafd48c91bbb39cd14133fe14b
[project @ 1998-05-04 16:36:17 by jwe]

diff --git a/ChangeLog b/ChangeLog
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,8 +1,20 @@
+Tue Apr 28 14:28:14 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* aclocal.m4 (OCTAVE_FLIBS): Really do skip -lkernel32.
+
+Thu Apr 23 23:26:19 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* kpathsea: Update to version 3.2.
+
+Mon Apr 20 21:58:39 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* configure.in (dlfcn.h): Add check.
+
 Sat Apr 18 20:15:37 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* configure.in (USE_GNU_INFO): Delete everything related to this.
 	* acconfig.h (USE_GNU_INFO): Delete undef.
 
 Tue Apr 14 15:33:20 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* install-octave.in: Improve error messages if version number or
diff --git a/NEWS b/NEWS
--- a/NEWS
+++ b/NEWS
@@ -1,14 +1,21 @@
 Summary of changes for version 2.1.x:
 ------------------------------------
 
+  * Running `make check' should work now before you run `make install', 
+    even if you build a copy of Octave that depends on shared versions
+    of the Octave libraries.
+
   * For matrices, x(:) now works no matter what the value of
     do_fortran_indexing is.
 
+  * New keywords __FILE__ and __LINE__ expand to the name of the file
+    that is being read and the current input line number, respectively.
+
   * Octave's expression parser is more general and consistent.  It is
     now possible to access structure elements and index arbitrary
     values.  For example, expressions like
 
       my_home_dir = getpwuid (getuid ()) . dir;
 
     and
 
@@ -172,17 +179,17 @@ Summary of changes for version 2.1.x:
     The default value is 0 unless you use --traditional.
 
   * The function sumsq now computes sum (x .* conj (x)) for complex values.
 
   * The new built-in variable max_recursion_depth allows you to
     prevent Octave from attempting infinite recursion.  The default
     value is 256.
 
-  * Octave now uses readline version 2.1 and kpathsea 3.0.
+  * Octave now uses kpathsea 3.2.
 
   * New configure option, --enable-readline.
 
   * New configure option, --enable-static.
 
 Summary of changes for version 2.0.7:
 ------------------------------------
 
@@ -199,16 +206,25 @@ Summary of changes for version 2.0.6:
     not end with semicolons.  The default is 1.
 
   * The new built-in constant OCTAVE_HOME specifies the top-level
     directory where Octave is installed.
 
   * Octave no longer includes functions to work with NPSOL or QPSOL,
     because they are not free software.
 
+  * The new built-in variable called kluge_procbuf_delay specifies the
+    number of microseconds to delay in the parent process after
+    forking.  By default on gnu-win32 systems, it's set to 500000 (1/2
+    second).  On other systems, the default value is 0.  Delaying for
+    a short time in the parent after forking seems to avoid problems
+    in which communicating with subprocesses via pipes would sometimes
+    cause Octave to hang.  I doubt that the delay is really the right
+    solution.  If anyone has a better idea, I'd love to hear it.
+
 Summary of changes for version 2.0.5:
 ------------------------------------
 
   * A `switch' statement is now available.  See the Statements chapter
     in the manual for details.
 
   * Commands like ls, save, and cd may now also be used as formal
     parameters for functions.
diff --git a/PROJECTS b/PROJECTS
--- a/PROJECTS
+++ b/PROJECTS
@@ -11,16 +11,19 @@ could help you; we'd also like to send y
 This list is not exclusive -- there are many other things that might
 be good projects, but it might instead be something we already have,
 so check with bug-octave@bevo.che.wisc.edu before you start.
 
 ---------
 Numerical:
 ---------
 
+  * Allow sum, prod, cumsum, and cumprod to take a second argument
+    that specifies the dimension over which to operate.
+
   * Merge control stuff.
 
   * Improve logm, and sqrtm.
 
   * Improve complex mapper functions.
 
   * Make functions like gamma() return the right IEEE Inf or NaN
     values for extreme args or other undefined cases.
@@ -271,19 +274,16 @@ Interpreter:
     function is parsed.
 
   * Fix the parser so that
 
       if (expr) 'this is a string' end
 
     is parsed as IF expr STRING END.
 
-  * Consider making x(:) work no matter what the value of
-    do_fortran_indexing.
-
   * For indexing operations, allow `$' to indicate the last element.
     For example, b = a (3:$, 1:$-1).  This means b is a, except for
     its first 2 rows and last column.  Note that `$' must be able to
     appear in arbitrarily complex expressions, so copying the the
     current implementation of `:' won't work. 
 
   * If foo.oct and foo.m both exist in the LOADPATH, Octave will
     always find foo.oct, even if foo.m appears earlier in the list of
@@ -313,28 +313,22 @@ Interpreter:
     string that can currently be added with `document'.
 
   * Allow more command line options to be accessible as built-in
     variables (--echo-commands, etc.).
 
   * Allow `octave -c STRING' to execute commands from STRING then
     exit.
 
-  * Handle DOS style CRLFs in M files.  This should probably be
-    optional.
-
   * Make the interpreter run faster.
 
   * Make it possible to disable or enable all warnings on an
     individual basis from the command line or via some built-in
     structure variable.
 
-  * Warn about complex comparisons?  Could just use double_value() or
-    matrix_value() instead of explicit conversions to real types.
-
   * Make warnings also give some indication about the location of the
     code that triggers the warning.
 
   * Warn about complex comparisons?  Could just use double_value() or
     matrix_value() instead of explicit conversions to real types.  For
     this to really be useful, some additional information must be
     available to point to the location of the code that triggers the
     warning.
@@ -453,25 +447,22 @@ Interpreter:
 
   * Add a command that works like bash's `builtin' command.
 
   * Handle comments in parse trees for use with the type command.
 
   * Make the type command handle script files too, by just reading and
     printing them.
 
-  * The wich and type commands should distinguish between dynamically
+  * The which and type commands should distinguish between dynamically
     linked functions and built-in functions.  For dynamically linked
     functions, the location of the .oct file should be displayed.
 
   * Clean up eye, eval, feval, keyboard, input, ones, zeros.
 
-  * Turn off printing when evaluating expressions in an eval()
-    statement, for compatibility with Matlab.
-
   * It would be nice to have an interactive debugger.
 
   * Make whos report total memory used by variables (and functions?).
 
   * Rewrite whos and the symbol_record_info class.  Write a built-in
     function that gives all the basic information, then write who and
     whos as M-files.
 
@@ -516,44 +507,38 @@ History:
 
   * Fix history problems -- core dump if multiple processes are
     writing to the same history file?
 
 ------------------------------
 Configuration and Installation:
 ------------------------------
 
-  * Handle USE_READLINE so that --enable-readline will work.
-
   * Make Octave as independent of the particular readline version as
     possible.
 
   * Add an --enable-pathsearch option to configure to make it possible
     to configure and run without kpathsea. 
 
   * Make configure take more defaults from the environment.  It should
     definitely pay attention to CFLAGS, CXXFLAGS, FFLAGS, etc.
 
   * Should --enable-lite-kernel imply --enable-shared?
 
   * Should --enable-dl imply --enable-shared?
 
-  * Make it possible to configure without readline.
-
   * Makefile changes:
       -- eliminate for loops
       -- define shell commands or eliminate them
       -- verify distclean
       -- consolidate targets
 
   * Make it possible to configure so that installed binaries and
     shared libraries are stripped.
 
-  * Make installation of the static libraries optional.
-
   * Create a docs-only distribution?
 
 ------------------------------
 Documentation and On-Line Help:
 ------------------------------
 
   * Document new features.
       -- history-search-{back,for}ward.
diff --git a/aclocal.m4 b/aclocal.m4
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -202,16 +202,17 @@ dnl
 	  done
 	  if $exists; then
 	    arg=
 	  else
 	    case "$arg" in
 	      -lkernel32)
 		case "$canonical_host_type" in
 		  *-*-cygwin32)
+		    arg=
 		  ;;
 		  *)
 		    lflags="$lflags $arg"
 		  ;;
 		esac
 	      ;;
 	      -lm)
 	      ;;
diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -16,17 +16,17 @@ dnl Copyright (C) 1996, 1997 John W. Eat
 ### FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 ### for more details.
 ### 
 ### You should have received a copy of the GNU General Public License
 ### along with Octave; see the file COPYING.  If not, write to the Free
 ### Software Foundation, 59 Temple Place - Suite 330, Boston, MA
 ### 02111-1307, USA. 
 
-AC_REVISION($Revision: 1.303 $)
+AC_REVISION($Revision: 1.304 $)
 AC_PREREQ(2.9)
 AC_INIT(src/octave.cc)
 AC_CONFIG_HEADER(config.h)
 
 AC_DEFINE(OCTAVE_SOURCE, 1)
 
 OCTAVE_HOST_TYPE
 
@@ -670,17 +670,17 @@ OCTAVE_STRING_NPOS
 
 ### Checks for header files.
 
 AC_HEADER_STDC
 AC_HEADER_DIRENT
 AC_HEADER_TIME
 AC_HEADER_SYS_WAIT
 
-AC_CHECK_HEADERS(assert.h curses.h fcntl.h float.h floatingpoint.h \
+AC_CHECK_HEADERS(assert.h curses.h dlfcn.h fcntl.h float.h floatingpoint.h \
   fnmatch.h glob.h grp.h ieeefp.h limits.h memory.h nan.h ncurses.h \
   pwd.h sgtty.h stdlib.h string.h sys/param.h sys/resource.h \
   sys/select.h sys/stat.h sys/time.h sys/times.h sys/types.h \
   sys/utsname.h termcap.h termio.h termios.h unistd.h varargs.h)
 
 if test "$ac_cv_header_termios_h" = yes \
     || test "$ac_cv_header_termio_h" = yes \
     || test "$ac_cv_header_sgtty_h" = yes; then
diff --git a/kpathsea/ChangeLog b/kpathsea/ChangeLog
--- a/kpathsea/ChangeLog
+++ b/kpathsea/ChangeLog
@@ -1,10 +1,13 @@
 Thu Apr 23 15:08:40 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
+	* withenable.ac (texmfmain): Don't print warning if main temf
+	directory tree can't be found.
+
 	* version.c (kpse_bug_address): Change address as requested.
 
 	* Makefile.in: Do acincludes by hand.
 	* common.ac: Require autoconf 2.12, not 2.12.1.
 	Include acklibtool.m4, not ../akclibtool.m4.
 	Include withenable.ac, not ../kpathsea/withenable.ac.
 	* acklibtool.m4, config.guess, config.sub, install-sh, klibtool,
 	klibtool.config: Files for `standalone' distribution'.
diff --git a/kpathsea/Makefile.in b/kpathsea/Makefile.in
--- a/kpathsea/Makefile.in
+++ b/kpathsea/Makefile.in
@@ -337,18 +337,20 @@ stamp-paths: texmf.cnf
 
 # Need an extra definition for this. Dependencies included below.
 tex-file.o:
 	$(KPATHSEA_CC) -DDEFAULT_FONT_SIZES='\"$(default_texsizes)\"' $(srcdir)/tex-file.c
 
 check: kpsewhich
 	./kpsewhich -expand-var '$$TEXMF'
 
-install: install-exec install-data
-uninstall: uninstall-exec uninstall-data
+#install: install-exec install-data
+#uninstall: uninstall-exec uninstall-data
+
+install uninstall:
 
 install-exec: kpsewhich
 	$(SHELL) $(top_srcdir)/../mkinstalldirs $(bindir) $(scriptdir) \
 	  $(libdir) $(web2cdir)
 	if grep 'original mktexpk --' $(scriptdir)/mktexpk >/dev/null 2>&1\
 	   || test ! -r $(scriptdir)/mktexpk; then \
 	  $(INSTALL_SCRIPT) $(srcdir)/mktexpk $(scriptdir)/mktexpk; \
 	else true; fi
diff --git a/kpathsea/acklibtool.m4 b/kpathsea/acklibtool.m4
--- a/kpathsea/acklibtool.m4
+++ b/kpathsea/acklibtool.m4
@@ -1,10 +1,10 @@
 dnl Autoconf support for Klibtool.
-dnl $Id: acklibtool.m4,v 1.3 1998-04-24 04:24:35 jwe Exp $
+dnl $Id: acklibtool.m4,v 1.4 1998-05-04 16:36:19 jwe Exp $
 dnl
 dnl
 dnl Find the script, check for subprogs, etc.
 AC_DEFUN(kb_AC_PROG_LIBTOOL,
 [AC_REQUIRE([AC_PROG_RANLIB])
 AC_REQUIRE([AC_CANONICAL_HOST])
 #
 AC_MSG_CHECKING([for libtool object types])
@@ -38,17 +38,17 @@ AC_ARG_ENABLE(static,
 test "$enable_static" = yes && LIBTOOL_OBJTYPES=STATIC:$LIBTOOL_OBJTYPES
 (test "$enable_shared" = yes \
  || test "$enable_static" = no) \
 && LIBTOOL_OBJTYPES=SHARED:$LIBTOOL_OBJTYPES
 # Don't bother to remove the trailing :, it'll be ignored.
 #
 ## Finally: Run the klibtool configure command.
 LIBTOOL_OBJTYPES=$LIBTOOL_OBJTYPES RANLIB=$RANLIB \
-  $LIBTOOL --source-dir $ac_aux_dir --config-dir .. configure "$host"
+  $LIBTOOL --source-dir $ac_aux_dir --config-dir . configure "$host"
 AC_MSG_RESULT($LIBTOOL_OBJTYPES)
 ])dnl
 dnl
 dnl
 dnl Like AC_REPLACE_FUNCS, but add to LTLIBOBJS instead of LIBOBJS.
 AC_DEFUN(kb_AC_KLIBTOOL_REPLACE_FUNCS,
 [ dnl cannot require this function, since it doesn't have a provide call.
 AC_CHECK_FUNCS($1,, LTLIBOBJS="$LTLIBOBJS $ac_func.lo")
diff --git a/kpathsea/config.guess b/kpathsea/config.guess
--- a/kpathsea/config.guess
+++ b/kpathsea/config.guess
@@ -1,11 +1,11 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
-#   Copyright (C) 1992, 93, 94, 95, 96, 1997 Free Software Foundation, Inc.
+#   Copyright (C) 1992, 93, 94, 95, 96, 97, 1998 Free Software Foundation, Inc.
 #
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
 # (at your option) any later version.
 #
 # This program is distributed in the hope that it will be useful, but
 # WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -473,44 +473,51 @@ EOF
 	exit 0 ;;
     *:NetBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-netbsd`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
 	exit 0 ;;
     *:OpenBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-openbsd`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
 	exit 0 ;;
     i*:CYGWIN*:*)
-	echo i386-pc-cygwin32
+	echo ${UNAME_MACHINE}-pc-cygwin32
 	exit 0 ;;
     i*:MINGW*:*)
-	echo i386-pc-mingw32
+	echo ${UNAME_MACHINE}-pc-mingw32
 	exit 0 ;;
     p*:CYGWIN*:*)
 	echo powerpcle-unknown-cygwin32
 	exit 0 ;;
     prep*:SunOS:5.*:*)
 	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit 0 ;;
     *:GNU:*:*)
 	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
 	exit 0 ;;
     *:Linux:*:*)
+	# uname on the ARM produces all sorts of strangeness, and we need to
+	# filter it out.
+	case "$UNAME_MACHINE" in
+	  arm* | sa110*)	      UNAME_MACHINE="arm" ;;
+	esac
+
 	# The BFD linker knows what the default object file format is, so
 	# first see if it will tell us.
 	ld_help_string=`ld --help 2>&1`
 	ld_supported_emulations=`echo $ld_help_string \
 			 | sed -ne '/supported emulations:/!d
 				    s/[ 	][ 	]*/ /g
 				    s/.*supported emulations: *//
 				    s/ .*//
 				    p'`
         case "$ld_supported_emulations" in
 	  i?86linux)  echo "${UNAME_MACHINE}-pc-linux-gnuaout"      ; exit 0 ;;
 	  i?86coff)   echo "${UNAME_MACHINE}-pc-linux-gnucoff"      ; exit 0 ;;
 	  sparclinux) echo "${UNAME_MACHINE}-unknown-linux-gnuaout" ; exit 0 ;;
+	  armlinux)   echo "${UNAME_MACHINE}-unknown-linux-gnuaout" ; exit 0 ;;
 	  m68klinux)  echo "${UNAME_MACHINE}-unknown-linux-gnuaout" ; exit 0 ;;
 	  elf32ppc)   echo "powerpc-unknown-linux-gnu"              ; exit 0 ;;
 	esac
 
 	if test "${UNAME_MACHINE}" = "alpha" ; then
 		sed 's/^	//'  <<EOF >dummy.s
 		.globl main
 		.ent main
diff --git a/kpathsea/config.sub b/kpathsea/config.sub
--- a/kpathsea/config.sub
+++ b/kpathsea/config.sub
@@ -1,11 +1,11 @@
 #! /bin/sh
 # Configuration validation subroutine script, version 1.1.
-#   Copyright (C) 1991, 92, 93, 94, 95, 96, 1997 Free Software Foundation, Inc.
+#   Copyright (C) 1991, 92-97, 1998 Free Software Foundation, Inc.
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
 # can handle that machine.  It does not imply ALL GNU software can.
 #
 # This file is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
 # (at your option) any later version.
@@ -157,26 +157,26 @@ case $basic_machine in
 		| mips64 | mipsel | mips64el | mips64orion | mips64orionel \
 		| mipstx39 | mipstx39el \
 		| sparc | sparclet | sparclite | sparc64 | v850)
 		basic_machine=$basic_machine-unknown
 		;;
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
 	# (2) the word "unknown" tends to confuse beginning users.
-	i[3456]86)
+	i[34567]86)
 	  basic_machine=$basic_machine-pc
 	  ;;
 	# Object if more than one company name word.
 	*-*-*)
 		echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1>&2
 		exit 1
 		;;
 	# Recognize the basic CPU types with company name.
-	vax-* | tahoe-* | i[3456]86-* | i860-* | m32r-* | m68k-* | m68000-* \
+	vax-* | tahoe-* | i[34567]86-* | i860-* | m32r-* | m68k-* | m68000-* \
 	      | m88k-* | sparc-* | ns32k-* | fx80-* | arc-* | arm-* | c[123]* \
 	      | mips-* | pyramid-* | tron-* | a29k-* | romp-* | rs6000-* \
 	      | power-* | none-* | 580-* | cray2-* | h8300-* | i960-* \
 	      | xmp-* | ymp-* | hppa-* | hppa1.0-* | hppa1.1-* \
 	      | alpha-* | alphaev5-* | alphaev56-* | we32k-* | cydra-* \
 	      | ns16k-* | pn-* | np1-* | xps100-* | clipper-* | orion-* \
 	      | sparclite-* | pdp11-* | sh-* | powerpc-* | powerpcle-* \
 	      | sparc64-* | mips64-* | mipsel-* \
@@ -345,29 +345,29 @@ case $basic_machine in
 	hppa-next)
 		os=-nextstep3
 		;;
 	i370-ibm* | ibm*)
 		basic_machine=i370-ibm
 		os=-mvs
 		;;
 # I'm not sure what "Sysv32" means.  Should this be sysv3.2?
-	i[3456]86v32)
+	i[34567]86v32)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv32
 		;;
-	i[3456]86v4*)
+	i[34567]86v4*)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv4
 		;;
-	i[3456]86v)
+	i[34567]86v)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv
 		;;
-	i[3456]86sol2)
+	i[34567]86sol2)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-solaris2
 		;;
 	iris | iris4d)
 		basic_machine=mips-sgi
 		case $os in
 		    -irix*)
 			;;
@@ -464,35 +464,33 @@ case $basic_machine in
 		basic_machine=sparc-tti
 		;;
 	pbb)
 		basic_machine=m68k-tti
 		;;
         pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
-	pentium | p5)
-		basic_machine=i586-intel
+	pentium | p5 | k5 | nexen)
+		basic_machine=i586-pc
 		;;
-	pentiumpro | p6)
-		basic_machine=i686-intel
+	pentiumpro | p6 | k6 | 6x86)
+		basic_machine=i686-pc
 		;;
-	pentium-* | p5-*)
+	pentiumii | pentium2)
+		basic_machine=i786-pc
+		;;
+	pentium-* | p5-* | k5-* | nexen-*)
 		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	pentiumpro-* | p6-*)
+	pentiumpro-* | p6-* | k6-* | 6x86-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	k5)
-		# We don't have specific support for AMD's K5 yet, so just call it a Pentium
-		basic_machine=i586-amd
-		;;
-	nexen)
-		# We don't have specific support for Nexgen yet, so just call it a Pentium
-		basic_machine=i586-nexgen
+	pentiumii-* | pentium2-*)
+		basic_machine=i786-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	pn)
 		basic_machine=pn-gould
 		;;
 	power)	basic_machine=rs6000-ibm
 		;;
 	ppc)	basic_machine=powerpc-unknown
 	        ;;
diff --git a/kpathsea/withenable.ac b/kpathsea/withenable.ac
--- a/kpathsea/withenable.ac
+++ b/kpathsea/withenable.ac
@@ -66,16 +66,18 @@ else
     fi
   done
 fi
 texmfmain=`echo "$texmfmain" | sed 's,//*,/,g'`
 if test -n "$texmfmain"; then
   AC_MSG_RESULT("$texmfmain")
 else
   AC_MSG_RESULT([not found])
-  AC_MSG_WARN([The main texmf tree was not found.
-  Specify the location of its parent directory with the --datadir option.
-  If you do not have the files, you can retrieve a minimal set from
-  ftp://ftp.tug.org/tex/texmflib.tar.gz, which is mirrored on CTAN hosts
-  in systems/web2c.  Winging it by using the default location.])
-  texmfmain="$datadir/texmf"
+dnl Octave doesn't need this, so don't worry users if it can't be found.
+dnl
+dnl  AC_MSG_WARN([The main texmf tree was not found.
+dnl  Specify the location of its parent directory with the --datadir option.
+dnl  If you do not have the files, you can retrieve a minimal set from
+dnl  ftp://ftp.tug.org/tex/texmflib.tar.gz, which is mirrored on CTAN hosts
+dnl  in systems/web2c.  Winging it by using the default location.])
+dnl  texmfmain="$datadir/texmf"
 fi
 AC_SUBST(texmfmain)
diff --git a/liboctave/ChangeLog b/liboctave/ChangeLog
--- a/liboctave/ChangeLog
+++ b/liboctave/ChangeLog
@@ -1,8 +1,15 @@
+Thu Apr 23 16:15:37 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* pathsearch.h (dir_path::p_orig): New field.
+	* pathsearch.cc (dir_path::init): Perform variable and tilde
+	expansion on the original path here.
+	(dir_path::find_all): Don't do anything if not initialized.
+
 Tue Apr 14 14:41:30 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* Array2-idx.h (index): Allow x(:) even when do_fortran_indexing
 	is not set.
 	(index): Allow x = zeros (2, 0); x(1,:) to work.
 
 	* lo-specfun.cc (gammainc): Use dgamit to compute
 	(\int_0^x exp(-t) t^(a-1) dt)/gamma(a), not just
diff --git a/liboctave/pathsearch.cc b/liboctave/pathsearch.cc
--- a/liboctave/pathsearch.cc
+++ b/liboctave/pathsearch.cc
@@ -42,17 +42,17 @@ extern "C"
 #include <kpathsea/pathsearch.h>
 #include <kpathsea/progname.h>
 
 extern unsigned int kpathsea_debug;
 
 #undef string
 }
 
-bool dir_path::kpathsea_debug_initialized = false;
+static bool octave_kpathsea_initialized = false;
 
 string_vector
 dir_path::elements (void)
 {
   return initialized ? pv : string_vector ();
 }
 
 string_vector
@@ -114,53 +114,65 @@ dir_path::find_first (const string& nm)
   return retval;
 }
 
 string_vector
 dir_path::find_all (const string& nm)
 {
   string_vector retval;
 
-  kpse_string *tmp = kpse_all_path_search (p.c_str (), nm.c_str ());
-
-  if (tmp)
+  if (initialized)
     {
-      int count = 0;
-      kpse_string *ptr = tmp;
-      while (*ptr++)
-	count++;
+      kpse_string *tmp = kpse_all_path_search (p.c_str (), nm.c_str ());
 
-      retval.resize (count);
+      if (tmp)
+	{
+	  int count = 0;
+	  kpse_string *ptr = tmp;
+	  while (*ptr++)
+	    count++;
 
-      for (int i = 0; i < count; i++)
-	retval[i] = tmp[i];
+	  retval.resize (count);
+
+	  for (int i = 0; i < count; i++)
+	    retval[i] = tmp[i];
+	}
     }
 
   return retval;
 }
 
 void
-dir_path::set_program_name (const char *nm)
+dir_path::set_program_name (const string& nm)
 {
-  kpse_set_progname (nm);
+  kpse_set_progname (nm.c_str ());
 }
 
 void
 dir_path::init (void)
 {
-  initialized = false;
-
-  if (! kpathsea_debug_initialized)
+  if (! octave_kpathsea_initialized)
     {
       char *s = getenv ("KPATHSEA_DEBUG");
 
       if (s)
 	kpathsea_debug |= atoi (s);
+
+      octave_kpathsea_initialized = true;
     }
 
+  char *tmp = kpse_path_expand (p_orig.c_str ());
+  if (tmp)
+    {
+      p = tmp;
+      free (tmp);
+    }
+  else
+    p = string ();
+
   int count = 0;
   char *path_elt = kpse_path_element (p.c_str ());
   while (path_elt)
     {
       path_elt = kpse_path_element (0);
       count++;
     }
 
diff --git a/liboctave/pathsearch.h b/liboctave/pathsearch.h
--- a/liboctave/pathsearch.h
+++ b/liboctave/pathsearch.h
@@ -27,66 +27,70 @@ Software Foundation, 59 Temple Place - S
 
 #include "str-vec.h"
 
 class
 dir_path
 {
 public:
 
-  dir_path (const string& s = string ()) : p (s), initialized (false)
+  dir_path (const string& s = string ())
+    : p_orig (s), initialized (false)
     {
-      if (! p.empty ())
+      if (! p_orig.empty ())
 	init ();
     }
 
   dir_path (const dir_path& dp)
-    : p (dp.p), initialized (dp.initialized), pv (dp.pv) { }
+    : p_orig (dp.p_orig), initialized (dp.initialized), p (dp.p), pv (dp.pv)
+  { }
 
   dir_path& operator = (const dir_path& dp)
     {
+      p_orig = dp.p_orig;
+      initialized = dp.initialized;
       p = dp.p;
-      initialized = dp.initialized;
       pv = dp.pv;
       return *this;
     }
 
   ~dir_path (void) { }
 
   void set (const string& s)
     {
       initialized = false;
-      p = s;
+      p_orig = s;
       init ();
     }
 
   string_vector elements (void);
   string_vector all_directories (void);
 
   string find_first (const string&);
   string find (const string& nm) { return find_first (nm); }
 
   string_vector find_all (const string&);
 
-  static void set_program_name (const char *);
+  static void set_program_name (const string&);
 
 private:
 
-  // The colon separated list.
-  string p;
+  // The colon separated list that we were given.
+  string p_orig;
 
   // TRUE means we've unpacked p.
   bool initialized;
 
+  // A version of the colon separate list on which we have performed
+  // tilde and variable expansion.
+  string p;
+
   // The elements of the list.
   string_vector pv;
 
-  // TRUE means we've set the global value of kpathsea_debug.
-  static bool kpathsea_debug_initialized;
-
   void init (void);
 };
 
 #endif
 
 /*
 ;;; Local Variables: ***
 ;;; mode: C++ ***
diff --git a/scripts/ChangeLog b/scripts/ChangeLog
--- a/scripts/ChangeLog
+++ b/scripts/ChangeLog
@@ -1,8 +1,21 @@
+Wed Apr 22 12:11:27 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* miscellaneous/flops.m: Allow a single argument too.
+
+Tue Apr 21 10:18:20 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* strings/str2mat.m: Also handle case when there are no empty
+	strings correctly.
+
+Mon Apr 20 22:14:15 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* strings/isletter.m: New function, for Matlab compatibility.
+
 Fri Apr 17 10:53:39 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* strings/str2mat.m: Handle string matrices too.
 
 Wed Apr 15 11:16:01 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* audio/loadaudio.m: Accept "pcm" as another file extension for
 	linear encoding.
diff --git a/scripts/miscellaneous/flops.m b/scripts/miscellaneous/flops.m
--- a/scripts/miscellaneous/flops.m
+++ b/scripts/miscellaneous/flops.m
@@ -20,17 +20,17 @@
 ## usage: flops
 ##
 ## Count floating point operations.
 
 ## Author: jwe
 
 function retval = flops ()
 
-  if (nargin > 0)
-    usage ("flops ()");
+  if (nargin > 1)
+    usage ("flops () or flops (n)");
   endif
 
   warning ("flops is a flop, always returning zero");
 
   retval = 0;
 
 endfunction
diff --git a/scripts/strings/str2mat.m b/scripts/strings/str2mat.m
--- a/scripts/strings/str2mat.m
+++ b/scripts/strings/str2mat.m
@@ -42,17 +42,22 @@ function retval = str2mat (...)
     s = va_arg ();
     if (isstr (s))
       [nr(k), nc(k)] = size (s);
     else
       error ("str2mat: all arguments must be strings");
     endif
   endfor
 
-  nr(find (nr == 0)) = 1;
+  tmp = find (nr == 0);
+
+  if (! isempty (tmp))
+    nr(tmp) = 1;
+  endif
+
   retval_nr = sum (nr);
   retval_nc = max (nc);
 
   retval = setstr (ones (retval_nr, retval_nc) * toascii (" "));
 
   va_start ();
 
   row_offset = 0;
diff --git a/src/ChangeLog b/src/ChangeLog
--- a/src/ChangeLog
+++ b/src/ChangeLog
@@ -1,8 +1,47 @@
+Sun May  3 19:54:38 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* lex.l (reset_parser): Also call yyrestart if forced_interactive
+	is true, but not if input_from_startup_file is true.
+
+Tue Apr 28 14:06:20 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* oct-procbuf.cc (Vkluge_procbuf_delay): New static variable.
+	(kluge_procbuf_delay): New function.
+	(symbols_of_oct_procbuf): New function.
+	(octave_procbuf::open): Delay Vkluge_procbuf_delay microseconds
+	after forking.
+
+Thu Apr 23 15:41:08 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* defaults.cc (Vload_path_dir_path): New variable.
+	* utils.cc (file_in_path): Use it.
+
+	* utils.cc (search_path_for_file): Undo previous change.
+	(file_in_path): Undo previous change.
+	* defaults.cc (loadpath): Undo previous change.  Tilde expansion
+	is once again handled correctly by the code in
+	liboctave/pathsearch.cc.
+
+Mon Apr 20 21:50:34 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* data.cc (get_dimensions): Allow zeros ([], 3) to work, for
+	compatibility with Matlab.
+
+	* dynamic-ld.cc [WITH_DL && ! HAVE_DLFCN_H]: Add declarations for
+	dlopen, dlerror, dlsym, and dlclose.
+
+	* octave.gperf: Handle __FILE__ and __LINE__.
+	* lex.l (is_keyword): Likewise.
+	* Makefile.in (oct-gperf.h): Pass -D option to gperf.
+	Postprocess output of gperf to convert name of static variable
+	from lookup to gperf_lookup, to avoid conflict with our	function
+	of the same name defined in variables.cc.
+
 Sat Apr 18 20:17:10 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* help.cc (USE_GNU_INFO): Delete uses of this macro.
 
 Thu Apr 16 01:00:12 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* dynamic-ld.cc: Only include dlfcn.h if HAVE_DLFCN_H.
 
diff --git a/src/Makefile.in b/src/Makefile.in
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -412,18 +412,18 @@ lex.cc : lex.l
 defaults.h: defaults.h.in ../Makeconf Makefile
 	@$(do-subst-default-vals)
 
 oct-conf.h: oct-conf.h.in ../Makeconf Makefile
 	@$(do-subst-config-vals)
 
 oct-gperf.h: octave.gperf
 	@echo "making $@ from $<"
-	@gperf -a -C -E -G -H octave_kw_hash -g -N octave_kw_lookup -p -t \
-	  $< > $@.t
+	@gperf -a -C -D -E -G -H octave_kw_hash -g -N octave_kw_lookup -p -t \
+	  $< | sed 's,lookup\[,gperf_lookup[,' > $@.t
 	@$(top_srcdir)/move-if-change $@.t $@
 
 check: all
 .PHONY: check
 
 # If missing, GNU make attempts to create them in the reverse of the
 # order in which they are listed here.  We rely on that fact to ensure
 # that defaults.h is created before trying to create the .d files.
diff --git a/src/data.cc b/src/data.cc
--- a/src/data.cc
+++ b/src/data.cc
@@ -859,18 +859,18 @@ get_dimensions (const octave_value& a, c
 
   check_dimensions (nr, nc, warn_for); // May set error_state.
 }
 
 static void
 get_dimensions (const octave_value& a, const octave_value& b,
 		const char *warn_for, int& nr, int& nc)
 {
-  nr = NINT (a.double_value ());
-  nc = NINT (b.double_value ());
+  nr = (a.is_empty ()) ? 0 : NINT (a.double_value ());
+  nc = (b.is_empty ()) ? 0 : NINT (b.double_value ());
 
   if (error_state)
     error ("%s: expecting two scalar arguments", warn_for);
   else
     check_dimensions (nr, nc, warn_for); // May set error_state.
 }
 
 static octave_value
diff --git a/src/defaults.cc b/src/defaults.cc
--- a/src/defaults.cc
+++ b/src/defaults.cc
@@ -33,16 +33,17 @@ Software Foundation, 59 Temple Place - S
 #ifdef HAVE_UNISTD_H
 #ifdef HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
 #include <unistd.h>
 #endif
 
 #include "oct-env.h"
+#include "pathsearch.h"
 
 #include <defaults.h>
 #include "defun.h"
 #include "error.h"
 #include "file-ops.h"
 #include "gripes.h"
 #include "help.h"
 #include "ov.h"
@@ -63,16 +64,19 @@ string Vfcn_file_dir;
 // The path that will be searched for programs that we execute.
 // (--exec-path path)
 string Vexec_path;
 
 // Load path specified on command line.
 // (--path path; -p path)
 string Vload_path;
 
+// And the cached directory path corresponding to Vload_path.
+dir_path Vload_path_dir_path;
+
 // Name of the editor to be invoked by the edit_history command.
 string Veditor;
 
 string Vimagepath;
 
 string Vlocal_site_defaults_file;
 string Vsite_defaults_file;
 
@@ -176,16 +180,18 @@ set_default_exec_path (void)
 static void
 set_default_path (void)
 {
   string std_path = subst_octave_home (OCTAVE_FCNFILEPATH);
 
   string oct_path = octave_env::getenv ("OCTAVE_PATH");
 
   Vload_path = oct_path.empty () ? std_path : oct_path;
+
+  Vload_path_dir_path = dir_path (Vload_path);
 }
 
 static void
 set_default_info_file (void)
 {
   string std_info_file = subst_octave_home (OCTAVE_INFOFILE);
 
   string oct_info_file = octave_env::getenv ("OCTAVE_INFO_FILE");
@@ -385,17 +391,21 @@ loadpath (void)
   string s = builtin_string_variable ("LOADPATH");
 
   if (s.empty ())
     {
       gripe_invalid_value_specified ("LOADPATH");
       status = -1;
     }
   else
-    Vload_path = file_ops::tilde_expand (maybe_add_default_load_path (s));
+    {
+      Vload_path = maybe_add_default_load_path (s);
+
+      Vload_path_dir_path = dir_path (Vload_path);
+    }
 
   return status;
 }
 
 void
 symbols_of_defaults (void)
 {
   DEFVAR (EDITOR, Veditor, 0, editor,
diff --git a/src/defaults.h.in b/src/defaults.h.in
--- a/src/defaults.h.in
+++ b/src/defaults.h.in
@@ -21,16 +21,18 @@ Software Foundation, 59 Temple Place - S
 
 */
 
 #if !defined (octave_defaults_h)
 #define octave_defaults_h 1
 
 #include <string>
 
+#include "pathsearch.h"
+
 #ifndef DEFAULT_PAGER
 #define DEFAULT_PAGER %DEFAULT_PAGER%
 #endif
 
 #ifndef OCTAVE_PREFIX
 #define OCTAVE_PREFIX %OCTAVE_PREFIX%
 #endif
 
@@ -127,16 +129,19 @@ extern string Vfcn_file_dir;
 // The path that will be searched for programs that we execute.
 // (--exec-path path)
 extern string Vexec_path;
 
 // Load path specified on command line.
 // (--path path; -p path)
 extern string Vload_path;
 
+// And the cached directory path corresponding to Vload_path.
+extern dir_path Vload_path_dir_path;
+
 // Name of the editor to be invoked by the edit_history command.
 extern string Veditor;
 
 extern string Vimagepath;
 
 extern string Vlocal_site_defaults_file;
 extern string Vsite_defaults_file;
 
diff --git a/src/dynamic-ld.cc b/src/dynamic-ld.cc
--- a/src/dynamic-ld.cc
+++ b/src/dynamic-ld.cc
@@ -31,16 +31,21 @@ Software Foundation, 59 Temple Place - S
 
 #include <strstream.h>
 
 extern "C"
 {
 #if defined (WITH_DL)
 #if defined (HAVE_DLFCN_H)
 #include <dlfcn.h>
+#else
+extern void *dlopen (const char *, int);
+extern const char *dlerror (void);
+extern void *dlsym (void *, const char *);
+extern int dlclose (void *);
 #endif
 #ifndef RTLD_LAZY
 #define RTLD_LAZY 1
 #endif
 #elif defined (WITH_SHL)
 #include <dl.h>
 #endif
 }
diff --git a/src/lex.l b/src/lex.l
--- a/src/lex.l
+++ b/src/lex.l
@@ -699,17 +699,19 @@ reset_parser (void)
   if (! (reading_script_file || reading_fcn_file))
     {
       current_input_column = 1;
       input_line_number = command_editor::current_command_number () - 1;
     }
 
   // Only ask for input from stdin if we are expecting interactive
   // input.
-  if (interactive && ! (reading_fcn_file || get_input_from_eval_string))
+  if ((interactive || forced_interactive)
+      && ! (reading_fcn_file || get_input_from_eval_string
+	    || input_from_startup_file))
     yyrestart (stdin);
 
   // Clear the buffer for help text.
   help_buf.resize (0);
 
   // Reset other flags.
   lexer_flags.init ();
 }
@@ -1052,16 +1054,30 @@ is_keyword (const string& s)
 	      lexer_flags.parsed_function_name = false;
 	      lexer_flags.beginning_of_function = true;
 
 	      if (! (reading_fcn_file || reading_script_file))
 		input_line_number = 1;
 	    }
 	  break;
 
+        case magic_file_kw:
+	  {
+	    if ((reading_fcn_file || reading_script_file)
+		&& ! curr_fcn_file_full_name.empty ())
+	      yylval.tok_val = new token (curr_fcn_file_full_name, l, c);
+	    else
+	      yylval.tok_val = new token ("stdin", l, c);
+	  }
+	  break;
+
+        case magic_line_kw:
+	  yylval.tok_val = new token (static_cast<double> (l), "", l, c);
+	  break;
+
 	default:
 	  panic_impossible ();
 	}
 
       if (! yylval.tok_val)
 	yylval.tok_val = new token (l, c);
 
       token_stack.push (yylval.tok_val);
diff --git a/src/oct-procbuf.cc b/src/oct-procbuf.cc
--- a/src/oct-procbuf.cc
+++ b/src/oct-procbuf.cc
@@ -30,19 +30,31 @@ Software Foundation, 59 Temple Place - S
 
 #ifdef HAVE_UNISTD_H
 #ifdef HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
 #include <unistd.h>
 #endif
 
+#include "lo-mappers.h"
+#include "lo-utils.h"
 #include "oct-procbuf.h"
 #include "syswait.h"
 
+#include "defun.h"
+#include "gripes.h"
+
+// Number of microseconds to delay in the parent after forking.
+#if defined (__CYGWIN32__)
+static int Vkluge_procbuf_delay = 500000;
+#else
+static int Vkluge_procbuf_delay = 0;
+#endif
+
 // This class is based on the procbuf class from libg++, written by
 // Per Bothner, Copyright (C) 1993 Free Software Foundation.
 //
 // It should work with the filebuf class from libg++, but it might not
 // work with others since it depends on being able to get at the
 // underlying file descriptor with filebuf::fd(), which is not
 // standard.
 
@@ -94,16 +106,24 @@ octave_procbuf::open (const char *comman
 	  octave_procbuf_list = octave_procbuf_list->next;
 	}
 
       execl ("/bin/sh", "sh", "-c", command, NULL);
 
       exit (127);
     }
 
+#if defined (HAVE_USLEEP)
+  if (Vkluge_procbuf_delay > 0)
+    usleep (Vkluge_procbuf_delay);
+#else
+  if (Vkluge_procbuf_delay > 499999)
+    sleep ((Vkluge_procbuf_delay + 500000) / 1000000);
+#endif
+
   ::close (child_end);
 
   if (proc_pid < 0)
     {
       ::close (parent_end);
       return 0;
     }
 
@@ -160,13 +180,38 @@ octave_procbuf::sys_close (void)
 
 #else
 
   return -1;
 
 #endif
 }
 
+static int
+kluge_procbuf_delay (void)
+{
+  double val;
+  if (builtin_real_scalar_variable ("kluge_procbuf_delay", val)
+      && ! xisnan (val))
+    {
+      int ival = NINT (val);
+      if (ival >= 0 && (double) ival == val)
+	{
+	  Vkluge_procbuf_delay = ival;
+	  return 0;
+	}
+    }
+  gripe_invalid_value_specified ("kluge_procbuf_delay");
+  return -1;
+}
+
+static void
+symbols_of_oct_procbuf (void)
+{
+  DEFVAR (kluge_procbuf_delay, Vkluge_procbuf_delay, 0, kluge_procbuf_delay,
+    "number of microseconds to delay in the parent after forking");
+}
+
 /*
 ;;; Local Variables: ***
 ;;; mode: C++ ***
 ;;; End: ***
 */
diff --git a/src/oct-procbuf.h b/src/oct-procbuf.h
--- a/src/oct-procbuf.h
+++ b/src/oct-procbuf.h
@@ -56,15 +56,17 @@ public:
 
 protected:
 
   pid_t proc_pid;
 
   octave_procbuf *next;
 };
 
+extern void symbols_of_oct_procbuf (void);
+
 #endif
 
 /*
 ;;; Local Variables: ***
 ;;; mode: C++ ***
 ;;; End: ***
 */
diff --git a/src/octave.gperf b/src/octave.gperf
--- a/src/octave.gperf
+++ b/src/octave.gperf
@@ -18,16 +18,18 @@ enum octave_kw_id
   endswitch_kw,
   endwhile_kw,
   for_kw,
   function_kw,
   global_kw,
   gplot_kw,
   gsplot_kw,
   if_kw,
+  magic_file_kw,
+  magic_line_kw,
   otherwise_kw,
   replot_kw,
   return_kw,
   static_kw,
   switch_kw,
   try_kw,
   unwind_protect_kw,
   unwind_protect_cleanup_kw,
@@ -62,8 +64,10 @@ otherwise, OTHERWISE, otherwise_kw
 replot, PLOT, replot_kw
 return, FUNC_RET, return_kw
 static, STATIC, static_kw
 switch, SWITCH, switch_kw
 try, TRY, try_kw
 unwind_protect, UNWIND, unwind_protect_kw
 unwind_protect_cleanup, CLEANUP, unwind_protect_cleanup_kw
 while, WHILE, while_kw
+__FILE__, TEXT, magic_file_kw
+__LINE__, NUM, magic_line_kw
diff --git a/src/sighandlers.cc b/src/sighandlers.cc
--- a/src/sighandlers.cc
+++ b/src/sighandlers.cc
@@ -386,16 +386,19 @@ install_signal_handlers (void)
 #ifdef SIGBUS
   octave_set_signal_handler (SIGBUS, generic_sig_handler);
 #endif
 
 #ifdef SIGCHLD
   octave_set_signal_handler (SIGCHLD, sigchld_handler);
 #endif
 
+  // SIGCLD
+  // SIGCONT
+
 #ifdef SIGEMT
   octave_set_signal_handler (SIGEMT, generic_sig_handler);
 #endif
 
 #ifdef SIGFPE
 #if defined (__alpha__)
   octave_set_signal_handler (SIGFPE, sigfpe_handler);
 #else
@@ -406,16 +409,19 @@ install_signal_handlers (void)
 #ifdef SIGHUP
   octave_set_signal_handler (SIGHUP, generic_sig_handler);
 #endif
 
 #ifdef SIGILL
   octave_set_signal_handler (SIGILL, generic_sig_handler);
 #endif
 
+  // SIGINFO
+  // SIGINT
+
 #ifdef SIGIOT
   octave_set_signal_handler (SIGIOT, generic_sig_handler);
 #endif
 
 #ifdef SIGLOST
   octave_set_signal_handler (SIGLOST, generic_sig_handler);
 #endif
 
@@ -426,52 +432,63 @@ install_signal_handlers (void)
 #ifdef SIGPOLL
   octave_set_signal_handler (SIGPOLL, SIG_IGN);
 #endif
 
 #ifdef SIGPROF
   octave_set_signal_handler (SIGPROF, generic_sig_handler);
 #endif
 
+  // SIGPWR
+
 #ifdef SIGQUIT
   octave_set_signal_handler (SIGQUIT, generic_sig_handler);
 #endif
 
 #ifdef SIGSEGV
   octave_set_signal_handler (SIGSEGV, generic_sig_handler);
 #endif
 
+  // SIGSTOP
+
 #ifdef SIGSYS
   octave_set_signal_handler (SIGSYS, generic_sig_handler);
 #endif
 
 #ifdef SIGTERM
   octave_set_signal_handler (SIGTERM, generic_sig_handler);
 #endif
 
 #ifdef SIGTRAP
   octave_set_signal_handler (SIGTRAP, generic_sig_handler);
 #endif
 
+  // SIGTSTP
+  // SIGTTIN
+  // SIGTTOU
+  // SIGURG
+
 #ifdef SIGUSR1
   octave_set_signal_handler (SIGUSR1, generic_sig_handler);
 #endif
 
 #ifdef SIGUSR2
   octave_set_signal_handler (SIGUSR2, generic_sig_handler);
 #endif
 
 #ifdef SIGVTALRM
   octave_set_signal_handler (SIGVTALRM, generic_sig_handler);
 #endif
 
 #ifdef SIGIO
   octave_set_signal_handler (SIGIO, SIG_IGN);
 #endif
 
+  // SIGWINCH
+
 #ifdef SIGXCPU
   octave_set_signal_handler (SIGXCPU, generic_sig_handler);
 #endif
 
 #ifdef SIGXFSZ
   octave_set_signal_handler (SIGXFSZ, generic_sig_handler);
 #endif
 }
diff --git a/src/utils.cc b/src/utils.cc
--- a/src/utils.cc
+++ b/src/utils.cc
@@ -223,22 +223,19 @@ empty_arg (const char *name, int nr, int
     }
 
   return is_empty;
 }
 
 // See if the given file is in the path.
 
 string
-search_path_for_file (const string& path, const string& name,
-		      bool do_tilde_expansion)
+search_path_for_file (const string& path, const string& name)
 {
-  string tmp_path = do_tilde_expansion ? file_ops::tilde_expand (path) : path;
-
-  dir_path p (tmp_path);
+  dir_path p (path);
 
   return octave_env::make_absolute (p.find (name), octave_env::getcwd ());
 }
 
 DEFUN (file_in_path, args, ,
   "file_in_path (PATH, NAME)")
 {
   octave_value_list retval;
@@ -270,17 +267,18 @@ DEFUN (file_in_path, args, ,
 string
 file_in_path (const string& name, const string& suffix)
 {
   string nm = name;
 
   if (! suffix.empty ())
     nm.append (suffix);
 
-  return search_path_for_file (Vload_path, nm, false);
+  return octave_env::make_absolute (Vload_path_dir_path.find (nm),
+				    octave_env::getcwd ());
 }
 
 // See if there is an function file in the path.  If so, return the
 // full path to the file.
 
 string
 fcn_file_in_path (const string& name)
 {
diff --git a/src/utils.h b/src/utils.h
--- a/src/utils.h
+++ b/src/utils.h
@@ -28,17 +28,17 @@ class ostrstream;
 
 #include <string>
 
 #include "lo-utils.h"
 
 class octave_value_list;
 class string_vector;
 
-extern string search_path_for_file (const string&, const string&, bool = true);
+extern string search_path_for_file (const string&, const string&);
 extern string file_in_path (const string&, const string&);
 extern string fcn_file_in_path (const string&);
 extern string oct_file_in_path (const string&);
 
 extern "C" void jump_to_top_level (void) GCC_ATTR_NORETURN;
 
 extern int almost_match (const string& std, const string& s,
 			 int min_match_len = 1, int case_sens = 1);
diff --git a/src/version.h b/src/version.h
--- a/src/version.h
+++ b/src/version.h
@@ -18,17 +18,17 @@ You should have received a copy of the G
 along with Octave; see the file COPYING.  If not, write to the Free
 Software Foundation, 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 
 */
 
 #if !defined (octave_version_h)
 #define octave_version_h 1
 
-#define OCTAVE_VERSION "2.1.5"
+#define OCTAVE_VERSION "2.1.6"
 
 #define OCTAVE_COPYRIGHT \
   "Copyright (C) 1996, 1997, 1998 John W. Eaton."
 
 #define OCTAVE_NAME_AND_VERSION \
   "Octave, version " OCTAVE_VERSION " (" TARGET_HOST_TYPE ")"
 
 #define OCTAVE_NAME_VERSION_AND_COPYRIGHT \
diff --git a/test/ChangeLog b/test/ChangeLog
--- a/test/ChangeLog
+++ b/test/ChangeLog
@@ -1,8 +1,13 @@
+Thu Apr 23 01:45:16 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* Makefile.in: If $(SHARED_LIBS), set LD_LIBRARY_PATH for running
+	Octave before installation is complete.
+
 Wed Apr 15 15:23:43 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* octave.test/index/dfi-f/m-2.m, octave.test/index/dfi-f/index.exp:
 	Expect this test to succed now.
 
 Thu Mar  5 20:35:26 1998  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* octave.test/system/gmtime-1.m, octave.test/system/localtime-1.m:
diff --git a/test/Makefile.in b/test/Makefile.in
--- a/test/Makefile.in
+++ b/test/Makefile.in
@@ -19,25 +19,35 @@ SOURCES =
 DISTFILES = Makefile.in $(SOURCES) ChangeLog
 
 SUBDIRS =
 
 OCTAVE_BINARY = ../src/octave
 
 OCTAVE_SCRIPT_PATH = .:$(TOPDIR)/src//:$(srcdir)/../scripts//
 
+ifeq ($(SHARED_LIBS), true)
+  OCTAVE_LD_LIBRARY_PATH = `pwd`/../src:`pwd`/../liboctave:`pwd`/../libcruft
+  ifneq ($(LD_LIBRARY_PATH),)
+    XLD_LIBRARY_PATH = $(OCTAVE_LD_LIBRARY_PATH)
+  else
+    XLD_LIBRARY_PATH = $(OCTAVE_LD_LIBRARY_PATH):$(LD_LIBRARY_PATH)
+  endif
+  SET_LD_LIBRARY_PATH = LD_LIBRARY_PATH="$(XLD_LIBRARY_PATH)"
+endif
+
 # Complete directory trees to distribute.
 DISTDIRS = config octave.test
 
 all: check
 .PHONY: all
 
 check:
 	@if test -n "$(RUNTEST)"; then \
-	  $(RUNTEST) \
+	  $(SET_LD_LIBRARY_PATH) $(RUNTEST) \
 	    OCTAVE="$(OCTAVE_BINARY)" \
 	    OCTAVE_SCRIPT_PATH="$(OCTAVE_SCRIPT_PATH)" \
 	    --tool octave --srcdir $(srcdir) $(RUNTEST_FLAGS); \
 	else \
 	  echo "***"; \
 	  echo "*** Sorry, I can't run tests without DejaGnu"; \
 	  echo "***"; \
 	fi
