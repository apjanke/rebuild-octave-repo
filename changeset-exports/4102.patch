# HG changeset patch
# User jwe
# Date 1034626605 0
#      Mon Oct 14 20:16:45 2002 +0000
# Node ID cbac6756967e8a1557b0448fc58158fcf84b29c0
# Parent  ea537559ab070bf4d0f473878cc8faae80256efe
[project @ 2002-10-14 20:16:44 by jwe]

diff --git a/ChangeLog b/ChangeLog
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,8 +1,44 @@
+2002-10-14  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* Makeconf.in (TERMLIBS): Substitute here.
+
+	* configure.in: Define OCTAVE_USE_WINDOWS_API if 
+	defined (__WIN32__) && ! defined (__CYGWIN__), not if
+	defined (__WIN32__) || ! defined (__CYGWIN__).
+	Also call AC_SUBST for TERMLIBS.
+
+2002-10-14  Paul Kienzle <pkienzle@users.sf.net>
+
+	* configure.in: Use correct SHLEXT and PICFLAG for Cygwin.
+	* configure.in: Cygwin must link against -loctave.dll, etc.
+
+	* configure.in: Define INCLUDE_LINK_DEPS because Cygwin needs DLLs
+	to be linked against their dependencies.
+	* Makeconf.in: Ditto.
+
+	* configure.in: Define SHLLIB and SHLBIN because Cygwin doesn't
+	link against shared libs but instead against -lxxx.dll.  LIB and
+	BIN are the link and load forms respectively of the library.
+	* Makeconf.in: Ditto, and define the corresponding XXX_VER.
+
+	* configure.in: Remove LIBOCT_READLINE and LIBOCT_PATHSEARCH
+	because they are merged into LIBOCTAVE to avoid circular
+	dependencies.
+	* Makeconf.in: Ditto.
+	* mkoctfile.in: Ditto.
+
+	* aclocal.m4 (OCTAVE_ENABLE_READLINE): Define LIBREADLINE because
+	Cygwin requires liboctave to be linked against -lreadline so
+	including it in LIBS isn't sufficient.
+	* mkoctfile.in: Substitute and use LIBREADLINE here.
+
+	* aclocal.m4 (OCTAVE_CXX_PREPENDS_UNDERSCORE): Force no for cygwin.
+
 2002-10-11  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* configure.in (AH_BOTTOM): Maybe define OCTAVE_USE_WINDOWS_API
 	and OCTAVE_HAVE_WINDOWS_FILESYSTEM.
 
 2002-10-09  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* aclocal.m4 (OCTAVE_PROG_GNUPLOT): AC_DEFINE GNUPLOT_BINARY
diff --git a/Makeconf.in b/Makeconf.in
--- a/Makeconf.in
+++ b/Makeconf.in
@@ -57,16 +57,22 @@ WITH_DYNAMIC_LINKING = @WITH_DYNAMIC_LIN
 
 OCTAVE_LITE = @OCTAVE_LITE@
 
 STATIC_LIBS = @STATIC_LIBS@
 
 SHARED_LIBS = @SHARED_LIBS@
 SHLEXT = @SHLEXT@
 SHLEXT_VER = $(SHLEXT).$(version)
+SHLLIB = @SHLLIB@
+SHLLIB_VER = $(SHLLIB).$(version)
+SHLBIN = @SHLBIN@
+SHLBIN_VER = $(SHLBIN).$(version)
+
+INCLUDE_LINK_DEPS = @INCLUDE_LINK_DEPS@
 
 LIBEXT = a
 
 # Fortran to C translator and associated flags.
 
 F2C = @F2C@
 F2CFLAGS = @F2CFLAGS@
 
@@ -153,19 +159,19 @@ RLD_FLAG = @RLD_FLAG@
 FLIBS = @FLIBS@
 
 LIBDLFCN = @LIBDLFCN@
 LIBGLOB = @LIBGLOB@
 LIBPLPLOT = @LIBPLPLOT@
 LIBKPATHSEA = @LIBKPATHSEA@
 LIBOCTINTERP = @LIBOCTINTERP@
 LIBOCTAVE = @LIBOCTAVE@
-LIBOCT_READLINE = @LIBOCT_READLINE@
-LIBOCT_PATHSEARCH = @LIBOCT_PATHSEARCH@
 LIBCRUFT = @LIBCRUFT@
+LIBREADLINE = @LIBREADLINE@
+TERMLIBS = @TERMLIBS@
 
 BLAS_LIBS = @BLAS_LIBS@
 FFTW_LIBS = @FFTW_LIBS@
 LIBS = @LIBS@
 
 # The arguments passed to configure.
 config_opts = @config_opts@
 
@@ -380,45 +386,46 @@ echo "making $@ from $<"
   -e "s;%OCTAVE_CONF_F77%;\"${F77}\";" \
   -e "s;%OCTAVE_CONF_FC%;\"${FC}\";" \
   -e "s;%OCTAVE_CONF_FFLAGS%;\"${FFLAGS}\";" \
   -e "s;%OCTAVE_CONF_FFTW_LIBS%;\"${FFTW_LIBS}\";" \
   -e "s;%OCTAVE_CONF_FLIBS%;\"${FLIBS}\";" \
   -e "s;%OCTAVE_CONF_FPICFLAG%;\"${FPICFLAG}\";" \
   -e "s;%OCTAVE_CONF_GLOB_INCFLAGS%;\"${GLOB_INCFLAGS}\";" \
   -e "s;%OCTAVE_CONF_INCFLAGS%;\"${INCFLAGS}\";" \
+  -e "s;%OCTAVE_CONF_INCLUDE_LINK_DEPS%;\"${INCLUDE_LINK_DEPS}\";"\
   -e "s;%OCTAVE_CONF_LD_CXX%;\"${LD_CXX}\";" \
   -e "s;%OCTAVE_CONF_LDFLAGS%;\"${LDFLAGS}\";" \
   -e "s;%OCTAVE_CONF_LD_STATIC_FLAG%;\"${LD_STATIC_FLAG}\";" \
   -e "s;%OCTAVE_CONF_LEX%;\"${LEX}\";" \
   -e "s;%OCTAVE_CONF_LEXLIB%;\"${LEXLIB}\";" \
   -e "s;%OCTAVE_CONF_LFLAGS%;\"${LFLAGS}\";" \
   -e "s;%OCTAVE_CONF_LIBCRUFT%;\"${LIBCRUFT}\";" \
   -e "s;%OCTAVE_CONF_LIBDLFCN%;\"${LIBDLFCN}\";" \
   -e "s;%OCTAVE_CONF_LIBEXT%;\"${LIBEXT}\";" \
   -e "s;%OCTAVE_CONF_LIBFLAGS%;\"${LIBFLAGS}\";" \
   -e "s;%OCTAVE_CONF_LIBGLOB%;\"${LIBGLOB}\";" \
   -e "s;%OCTAVE_CONF_LIBKPATHSEA%;\"${LIBKPATHSEA}\";" \
   -e "s;%OCTAVE_CONF_LIBOCTAVE%;\"${LIBOCTAVE}\";" \
   -e "s;%OCTAVE_CONF_LIBOCTINTERP%;\"${LIBOCTINTERP}\";" \
-  -e "s;%OCTAVE_CONF_LIBOCT_PATHSEARCH%;\"${LIBOCT_PATHSEARCH}\";" \
-  -e "s;%OCTAVE_CONF_LIBOCT_READLINE%;\"${LIBOCT_READLINE}\";" \
   -e "s;%OCTAVE_CONF_LIBPLPLOT%;\"${LIBPLPLOT}\";" \
+  -e "s;%OCTAVE_CONF_LIBREADLINE%;\"${LIBREADLINE}\";" \
   -e "s;%OCTAVE_CONF_LIBS%;\"${LIBS}\";" \
   -e "s;%OCTAVE_CONF_LN_S%;\"${LN_S}\";" \
   -e "s;%OCTAVE_CONF_MKOCTFILE_INCFLAGS%;\"${MKOCTFILE_INCFLAGS}\";" \
   -e "s;%OCTAVE_CONF_MKOCTFILE_LFLAGS%;\"${MKOCTFILE_LFLAGS}\";" \
   -e "s;%OCTAVE_CONF_OCTAVE_LITE%;\"${OCTAVE_LITE}\";" \
   -e "s;%OCTAVE_CONF_RANLIB%;\"${RANLIB}\";" \
   -e "s;%OCTAVE_CONF_RDYNAMIC_FLAG%;\"${RDYNAMIC_FLAG}\";" \
   -e "s;%OCTAVE_CONF_RLD_FLAG%;\"${RLD_FLAG}\";" \
   -e "s;%OCTAVE_CONF_RUNTEST%;\"${RUNTEST}\";" \
   -e "s;%OCTAVE_CONF_SED%;\"${SED}\";" \
   -e "s;%OCTAVE_CONF_SHARED_LIBS%;\"${SHARED_LIBS}\";" \
   -e "s;%OCTAVE_CONF_SHLEXT%;\"${SHLEXT}\";" \
+  -e "s;%OCTAVE_CONF_SHLLINKEXT%;\"${SHLLINKEXT}\";" \
   -e "s;%OCTAVE_CONF_SHLEXT_VER%;\"${SHLEXT_VER}\";" \
   -e "s;%OCTAVE_CONF_SH_LD%;\"${SH_LD}\";" \
   -e "s;%OCTAVE_CONF_SH_LDFLAGS%;\"${SH_LDFLAGS}\";" \
   -e "s;%OCTAVE_CONF_SONAME_FLAGS%;\"${SONAME_FLAGS}\";" \
   -e "s;%OCTAVE_CONF_STATIC_LIBS%;\"${STATIC_LIBS}\";" \
   -e "s;%OCTAVE_CONF_UGLY_DEFS%;\"${UGLY_DEFS}\";" \
   -e "s;%OCTAVE_CONF_VERSION%;\"${version}\";" \
   -e "s;%OCTAVE_CONF_WITH_DL%;\"${WITH_DL}\";" \
diff --git a/aclocal.m4 b/aclocal.m4
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -596,16 +596,25 @@ EOF
       if test "`${NM-nm} conftest.o | grep _FSmy_dld_fcn`" != ""; then
         octave_cv_cxx_prepends_underscore=yes
       fi
     else
       echo "configure: failed program was:" >&AS_MESSAGE_LOG_FD
       cat conftest.$ac_ext >&AS_MESSAGE_LOG_FD
     fi
     AC_LANG_POP(C++)
+### XXX FIXME XXX -- Ignore test result for cygwin.  Yes it prepends
+### underscore, but dlsym dnl seems to add it automatically.  The
+### correct test is to build the shared library then try to grab the
+### symbol from it with and without underscore.
+    case "$canonical_host_type" in
+      *-*-cygwin*)
+        octave_cv_cxx_prepends_underscore=no
+      ;;
+    esac
   ])
   AC_MSG_RESULT($octave_cv_cxx_prepends_underscore)
   if test $octave_cv_cxx_prepends_underscore = yes; then
     AC_DEFINE(CXX_PREPENDS_UNDERSCORE, 1, [Define if your compiler prepends underscores to external names.])
   fi
 ])
 dnl
 dnl See if the C++ library is ISO compliant.
@@ -647,31 +656,34 @@ AC_DEFUN(OCTAVE_CXX_ISO_COMPLIANT_LIBRAR
 ])
 dnl
 dnl Allow the user disable support for command line editing using GNU
 dnl readline.
 dnl
 dnl OCTAVE_ENABLE_READLINE
 AC_DEFUN(OCTAVE_ENABLE_READLINE, [
   USE_READLINE=true
+  LIBREADLINE=
   AC_ARG_ENABLE(readline,
     [  --enable-readline       use readline library (default is yes)],
     [if test "$enableval" = no; then
        USE_READLINE=false
        warn_readline="command editing and history features require GNU Readline"
      fi])
   if $USE_READLINE; then
     AC_CHECK_LIB(readline, rl_set_keyboard_input_timeout, [
-      LIBS="-lreadline $LIBS"
+      LIBREADLINE="-lreadline"
+      LIBS="$LIBREADLINE $LIBS"
       AC_DEFINE(USE_READLINE, 1, [Define to use the readline library.])
     ], [
       AC_MSG_WARN([I need GNU Readline 4.2 or later])
       AC_MSG_ERROR([this is fatal unless you specify --disable-readline])
     ])
   fi
+  AC_SUBST(LIBREADLINE)
 ])
 dnl
 dnl Determine the C++ compiler ABI. It sets the macro CXX_ABI to the
 dnl name of the ABI, and is used to mangle the C linkage loadable
 dnl functions to avoid ABI mismatch.  GNU C++ currently uses gnu_v2 
 dnl (GCC versions <= 2.95.x) dnl or gnu_v3 (GCC versions >= 3.0).
 dnl Set to "unknown" is when we don't know enough about the ABI, which 
 dnl will happen when using an unsupported C++ compiler. 
diff --git a/configure.in b/configure.in
--- a/configure.in
+++ b/configure.in
@@ -17,17 +17,17 @@ dnl Copyright (C) 1996, 1997 John W. Eat
 ### for more details.
 ### 
 ### You should have received a copy of the GNU General Public License
 ### along with Octave; see the file COPYING.  If not, write to the Free
 ### Software Foundation, 59 Temple Place - Suite 330, Boston, MA
 ### 02111-1307, USA. 
 
 AC_INIT
-AC_REVISION($Revision: 1.375 $)
+AC_REVISION($Revision: 1.376 $)
 AC_PREREQ(2.52)
 AC_CONFIG_SRCDIR([src/octave.cc])
 AC_CONFIG_HEADER(config.h)
 
 AC_DEFINE(OCTAVE_SOURCE, 1, [Define if this is Octave.])
   
 OCTAVE_HOST_TYPE
 
@@ -616,49 +616,34 @@ AC_ARG_ENABLE(shared,
 AC_SUBST(SHARED_LIBS)
 
 if $STATIC_LIBS || $SHARED_LIBS; then
   true
 else
   AC_MSG_ERROR([You can't disable building static AND shared libraries!])
 fi
 
-if $SHARED_LIBS; then
-  LIBOCTINTERP=-loctinterp
-  LIBOCTAVE=-loctave
-  LIBOCT_READLINE=-loct-readline
-  LIBOCT_PATHSEARCH=-loct-pathsearch
-  LIBCRUFT=-lcruft
-else
-  LIBOCTINTERP='$(TOPDIR)/src/liboctinterp.$(LIBEXT)'
-  LIBOCTAVE='$(TOPDIR)/liboctave/liboctave.$(LIBEXT)'
-  LIBOCT_READLINE='$(TOPDIR)/liboctave/liboct-readline.$(LIBEXT)'
-  LIBOCT_PATHSEARCH='$(TOPDIR)/liboctave/liboct-pathsearch.$(LIBEXT)'
-  LIBCRUFT='$(TOPDIR)/libcruft/libcruft.$(LIBEXT)'
-fi
-AC_SUBST(LIBOCTINTERP)
-AC_SUBST(LIBOCTAVE)
-AC_SUBST(LIBOCT_READLINE)
-AC_SUBST(LIBOCT_PATHSEARCH)
-AC_SUBST(LIBCRUFT)
-
 use_rpath=true
 AC_ARG_ENABLE(rpath,
   [  --enable-rpath          add -rpath to link command for shared libraries],
   [if test "$enableval" = no; then use_rpath=false; fi], [])
 
 DLFCN_DIR=
 CPICFLAG=-fPIC
 CXXPICFLAG=-fPIC
 FPICFLAG=-fPIC
 SHLEXT=so
+SHLLINKEXT=
+SHLBIN=
+SHLLIB=$SHLEXT
 SH_LD="$CXX"
 SH_LDFLAGS=-shared
 SONAME_FLAGS=
 RLD_FLAG=
+INCLUDE_LINK_DEPS=false
 TEMPLATE_AR="$AR"
 TEMPLATE_ARFLAGS="$ARFLAGS"
 case "$canonical_host_type" in
   *-*-386bsd* | *-*-openbsd* | *-*-netbsd* | *-*-freebsd*)
     SH_LD=ld
     SH_LDFLAGS=-Bshareable
   ;;
   alpha*-dec-osf*)
@@ -667,16 +652,28 @@ case "$canonical_host_type" in
     FPICFLAG=
     SH_LDFLAGS="-shared -Xlinker -expect_unresolved -Xlinker '*'"
     SONAME_FLAGS='-Xlinker -soname -Xlinker $@'
     RLD_FLAG='-Xlinker -rpath -Xlinker $(octlibdir)'
   ;;
   *-*-darwin*)
     SH_LDFLAGS='-bundle -bundle_loader $(bindir)/octave'
   ;;
+  *-*-cygwin*)
+    CXXPICFLAG=
+    CPICFLAG=
+    FPICFLAG=
+    SHLEXT=dll
+    SHLLIB=dll.a
+    SHLBIN=dll
+    SH_LDFLAGS="-shared -Wl,--export-all-symbols -Wl,--enable-auto-import"
+    SHLLINKEXT=.dll
+    SONAME_FLAGS='-Wl,--out-implib=$@.a'
+    INCLUDE_LINK_DEPS=true
+  ;;
   *-*-linux* | *-*-gnu*)
     SONAME_FLAGS='-Xlinker -soname -Xlinker $@'
     RLD_FLAG='-Xlinker -rpath -Xlinker $(octlibdir)'
   ;;
   i[[3456]]86-*-sco3.2v5*)
     SONAME_FLAGS='-Xlinker -h -Xlinker $@'
     RLD_FLAG=
     SH_LDFLAGS=-G
@@ -754,27 +751,44 @@ AC_MSG_RESULT([defining CXXPICFLAG to be
 AC_MSG_RESULT([defining SHLEXT to be $SHLEXT])
 AC_MSG_RESULT([defining DLFCN_DIR to be $DLFCN_DIR])
 AC_MSG_RESULT([defining SH_LD to be $SH_LD])
 AC_MSG_RESULT([defining SH_LDFLAGS to be $SH_LDFLAGS])
 AC_MSG_RESULT([defining SONAME_FLAGS to be $SONAME_FLAGS])
 AC_MSG_RESULT([defining RLD_FLAG to be $RLD_FLAG])
 AC_MSG_RESULT([defining TEMPLATE_AR to be $TEMPLATE_AR])
 AC_MSG_RESULT([defining TEMPLATE_ARFLAGS to be $TEMPLATE_ARFLAGS])
+AC_MSG_RESULT([defining INCLUDE_LINK_DEPS to be $INCLUDE_LINK_DEPS])
 AC_SUBST(FPICFLAG)
 AC_SUBST(CPICFLAG)
 AC_SUBST(CXXPICFLAG)
 AC_SUBST(SHLEXT)
+AC_SUBST(SHLLIB)
+AC_SUBST(SHLBIN)
 AC_SUBST(DLFCN_DIR)
 AC_SUBST(SH_LD)
 AC_SUBST(SH_LDFLAGS)
 AC_SUBST(SONAME_FLAGS)
 AC_SUBST(RLD_FLAG)
 AC_SUBST(TEMPLATE_AR)
 AC_SUBST(TEMPLATE_ARFLAGS)
+AC_SUBST(INCLUDE_LINK_DEPS)
+
+if $SHARED_LIBS; then
+  LIBOCTINTERP=-loctinterp$SHLLINKEXT
+  LIBOCTAVE=-loctave$SHLLINKEXT
+  LIBCRUFT=-lcruft$SHLLINKEXT
+else
+  LIBOCTINTERP='$(TOPDIR)/src/liboctinterp.$(LIBEXT)'
+  LIBOCTAVE='$(TOPDIR)/liboctave/liboctave.$(LIBEXT)'
+  LIBCRUFT='$(TOPDIR)/libcruft/libcruft.$(LIBEXT)'
+fi
+AC_SUBST(LIBOCTINTERP)
+AC_SUBST(LIBOCTAVE)
+AC_SUBST(LIBCRUFT)
 
 ### Allow compilation of smaller kernel.  This only works if some form
 ### of dynamic linking is also supported and used.
 
 AC_ARG_ENABLE(lite-kernel,
   [  --enable-lite-kernel    compile smaller kernel (requires dynamic linking)],
   [if test "$enableval" = no; then OCTAVE_LITE=false;
    else OCTAVE_LITE=true; fi],
@@ -1062,16 +1076,17 @@ AC_CHECK_MEMBERS(struct group.gr_passwd)
 OCTAVE_MKDIR_TAKES_ONE_ARG
 
 octave_found_termlib=no
 for termlib in ncurses curses termcap terminfo termlib; do
   AC_CHECK_LIB(${termlib}, tputs, [TERMLIBS="${TERMLIBS} -l${termlib}"])
   case "${TERMLIBS}" in
     *-l${termlib}*)
       LIBS="$TERMLIBS $LIBS"
+      AC_SUBST(TERMLIBS)
       octave_found_termlib=yes
       break
     ;;
   esac
 done
 
 if test "$octave_found_termlib" = no; then
   warn_termlibs="I couldn't find -ltermcap, -lterminfo, -lncurses, -lcurses, o\
@@ -1294,17 +1309,17 @@ typedef int sigset_t;
 #if defined (__WIN32__)
 #define OCTAVE_HAVE_WINDOWS_FILESYSTEM 1
 #if ! defined (__CYGWIN__)
 #undef OCTAVE_HAVE_POSIX_FILESYSTEM
 #endif
 #endif
 
 /* Define if we expect to have <windows.h>, Sleep, etc. */
-#if defined (__WIN32__) || ! defined (__CYGWIN__)
+#if defined (__WIN32__) && ! defined (__CYGWIN__)
 #define OCTAVE_USE_WINDOWS_API 1
 #endif
 ])
 
 ### Do the substitutions in all the Makefiles.
 
 AC_CONFIG_FILES([Makefile octMakefile Makeconf install-octave \
   test/Makefile dlfcn/Makefile \
diff --git a/libcruft/ChangeLog b/libcruft/ChangeLog
--- a/libcruft/ChangeLog
+++ b/libcruft/ChangeLog
@@ -1,8 +1,22 @@
+2002-10-14  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* Makefile.in (install): No need to use cd to create links.
+
+2002-10-14  Paul Kienzle <pkienzle@users.sf.net>
+
+	* Makefile.in: Use link dependencies for shared libs if
+	INCLUDE_LINK_DEPS.
+	(LIBRARIES): If doing shared libs, include versioned library in	list.
+	(libcruft.$(SHLEXT), libcruft.$(SHLEXT_VER)): Reverse actions --
+	build unversioned library, symbolic link adds version info.
+	(install, uninstall): Handle link and load forms of the library
+	separately.
+
 2002-09-30  Paul Kienzle <pkienzle@users.sf.net>
 
 	* slatec-fn/xdacosh.f: Mark external functions as external.
 	* slatec-fn/xdasinh.f: Ditto.
 	* slatec-fn/xdatanh.f: Ditto.
 	* slatec-fn/xdbetai.f: Ditto.
 	* slatec-fn/xderf.f: Ditto.
 	* slatec-fn/xderfc.f: Ditto.
diff --git a/libcruft/Makefile.in b/libcruft/Makefile.in
--- a/libcruft/Makefile.in
+++ b/libcruft/Makefile.in
@@ -39,16 +39,21 @@ DISTSUBDIRS = $(sort $(CRUFT_DIRS) blas 
 
 DISTFILES = Makefile.in ChangeLog Makerules.in $(SOURCES) STOP.patch
 
 ifeq ($(SHARED_LIBS), true)
   BINDISTLIBS = libcruft/libcruft
   BINDISTFILES = libcruft.$(SHLEXT_VER)
 endif
 
+# include BLAS and FFTW just in case some of libcruft depends on them
+ifeq ($(INCLUDE_LINK_DEPS),true)
+  LINK_DEPS = $(BLAS_LIBS) $(FFTW_LIBS) $(FLIBS)
+endif
+
 all: libraries
 .PHONY: all
 
 $(SUBDIRS):
 	$(MAKE) -C $@ all
 .PHONY: $(SUBDIRS)
 
 # XXX FIXME XXX -- this should build the shared library directly from
@@ -70,19 +75,19 @@ ifeq ($(SHARED_LIBS), true)
     CRUFT_PICOBJ := $(join $(CRUFT_OBJ_PICDIR), $(CRUFT_OBJ_NOTDIR))
   else
     CRUFT_PICOBJ := $(CRUFT_OBJ)
   endif
 endif
 
 ifeq ($(SHARED_LIBS), true)
   ifeq ($(STATIC_LIBS), true)
-    LIBRARIES = libcruft.$(LIBEXT) libcruft.$(SHLEXT)
+    LIBRARIES = libcruft.$(LIBEXT) libcruft.$(SHLEXT_VER)
   else
-    LIBRARIES = libcruft.$(SHLEXT)
+    LIBRARIES = libcruft.$(SHLEXT_VER)
   endif
 else
   ifeq ($(STATIC_LIBS), true)
     LIBRARIES = libcruft.$(LIBEXT)
   else
     LIBRARIES =
   endif
 endif
@@ -91,23 +96,23 @@ libraries: $(SUBDIRS)
 	$(MAKE) $(LIBRARIES)
 .PHONY: libraries
 
 libcruft.$(LIBEXT): $(CRUFT_OBJ)
 	rm -f $@
 	$(AR) $(ARFLAGS) $@ $^
 	$(RANLIB) $@
 
-libcruft.$(SHLEXT): libcruft.$(SHLEXT_VER)
+libcruft.$(SHLEXT_VER): libcruft.$(SHLEXT)
 	rm -f $@
 	$(LN_S) $< $@
 
-libcruft.$(SHLEXT_VER): $(CRUFT_PICOBJ)
+libcruft.$(SHLEXT): $(CRUFT_PICOBJ)
 	rm -f $@
-	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^
+	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^ $(LINK_DEPS)
 
 $(CRUFT_OBJ):
 
 check: all
 .PHONY: check
 
 install install-strip uninstall clean mostlyclean distclean maintainer-clean::
 	@$(subdir-for-command)
@@ -116,31 +121,41 @@ install::
 	$(top_srcdir)/mkinstalldirs $(octlibdir)
 	if $(STATIC_LIBS); then \
 	  rm -f $(octlibdir)/libcruft.$(LIBEXT) ; \
 	  $(INSTALL_DATA) libcruft.$(LIBEXT) \
 	    $(octlibdir)/libcruft.$(LIBEXT) ; \
 	  $(RANLIB) $(octlibdir)/libcruft.$(LIBEXT) ; \
 	fi
 	if $(SHARED_LIBS); then \
-	  rm -f $(octlibdir)/libcruft.$(SHLEXT_VER); \
+	  rm -f $(octlibdir)/libcruft.$(SHLLIB_VER); \
 	  $(INSTALL_PROGRAM) \
-	    libcruft.$(SHLEXT_VER) $(octlibdir)/libcruft.$(SHLEXT_VER); \
-	  cd $(octlibdir); \
-	  rm -f libcruft.$(SHLEXT); \
-	  $(LN_S) libcruft.$(SHLEXT_VER) libcruft.$(SHLEXT); \
+	    libcruft.$(SHLLIB) $(octlibdir)/libcruft.$(SHLLIB_VER); \
+	  rm -f $(octlibdir)/libcruft.$(SHLLIB); \
+	  $(LN_S) libcruft.$(SHLLIB_VER) $(octlibdir)/libcruft.$(SHLLIB); \
+	  if  test x$(SHLBIN) != x ; then \
+	    rm -f $(bindir)/libcruft.$(SHLBIN_VER); \
+	    $(INSTALL_PROGRAM) \
+	      libcruft.$(SHLBIN) $(bindir)/libcruft.$(SHLBIN_VER); \
+	    rm -f $(bindir)/libcruft.$(SHLBIN); \
+	    $(LN_S) libcruft.$(SHLBIN_VER) $(bindir)/libcruft.$(SHLBIN); \
+	  fi; \
 	fi
 
 install-strip::
 	$(MAKE) INSTALL_PROGRAM="$(INSTALL_PROGRAM) -s" install
 
 uninstall::
 	rm -f $(octlibdir)/libcruft.$(LIBEXT)
-	rm -f $(octlibdir)/libcruft.$(SHLEXT)
-	rm -f $(octlibdir)/libcruft.$(SHLEXT_VER)
+	rm -f $(octlibdir)/libcruft.$(SHLLIB)
+	rm -f $(octlibdir)/libcruft.$(SHLLIB_VER)
+	if test x$(SHLBIN) != x; then \
+	  rm -f $(bindir)/libcruft.$(SHLBIN); \
+	  rm -f $(bindir)/libcruft.$(SHLBIN_VER); \
+	fi
 
 tags TAGS:: $(SOURCES)
 	$(SUBDIR_FOR_COMMAND)
 
 tags::
 	ctags $(SOURCES)
 
 TAGS:: $(SOURCES)
diff --git a/liboctave/ChangeLog b/liboctave/ChangeLog
--- a/liboctave/ChangeLog
+++ b/liboctave/ChangeLog
@@ -1,8 +1,29 @@
+2002-10-14  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	* lo-cieee.c: Move everything but lo_ieee_init here.
+	(lo_ieee_Inf_value, lo_ieee_NA_value, lo_ieee_NaN_value):
+	New functions.
+
+	* Makefile.in (install): No need to use cd to create links.
+	(LINK_DEPS): Include $(LIBOCTAVE_LFLAGS) before list of libraries.
+	Include $(TERMLIBS) in list.
+
+2002-10-14  Paul Kienzle <pkienzle@users.sf.net>
+
+	* Makefile.in: Merge liboctave with liboct-readline and
+	liboct-pathsearch.
+	Use link dependencies for shared libs if INCLUDE_LINK_DEPS.
+	(libraries): Depend on versioned library.
+	(liboctave.$(SHLEXT), liboctave.$(SHLEXT_VER)): Reverse actions --
+	build unversioned library, symbolic link adds version info.
+	(install, uninstall): Handle link and load forms of the library
+	separately.
+
 2002-10-11  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* oct-time.cc: Use OCTAVE_USE_WINDOWS_API instead of __WIN32__ and
 	__CYGWIN__.
 
 	* file-ops.cc (file_ops::dir_sep_char, file_ops::dir_sep_str,
 	file_ops::dir_sep_chars): New static functions to replace
 	OCTAVE_DIR_SEP_CHAR, OCTAVE_DIR_SEP_STR, OCTAVE_DIR_SEP_CHARS.
diff --git a/liboctave/Makefile.in b/liboctave/Makefile.in
--- a/liboctave/Makefile.in
+++ b/liboctave/Makefile.in
@@ -13,20 +13,23 @@ top_srcdir = @top_srcdir@
 VPATH = @srcdir@
 
 include $(TOPDIR)/Makeconf
 
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
 
-LIBOCTAVE_LFLAGS = -L../libcruft -L../readline -L../kpathsea \
-	-L../glob -L. $(RLD_FLAG)
+LIBOCTAVE_LFLAGS = -L../libcruft -L../kpathsea -L../glob -L. $(RLD_FLAG)
 
-LIBOCTAVE_LIBS = -lcruft -lreadline -lkpathsea -lglob
+ifeq ($(INCLUDE_LINK_DEPS), true)
+  LINK_DEPS = \
+    $(LIBOCTAVE_LFLAGS) \
+    $(LIBCRUFT) $(BLAS_LIBS) $(FFTW_LIBS) $(LIBREADLINE) $(TERMLIBS) -lglob
+endif
 
 MATRIX_INC := Array.h Array2.h Array3.h ArrayN.h DiagArray2.h Array-flags.h \
 	Array-idx.h Array2-idx.h Array3-idx.h ArrayN-idx.h MArray-defs.h \
 	MArray.h MArray2.h MDiagArray2.h Matrix.h \
 	base-lu.h mx-base.h mx-op-defs.h mx-defs.h mx-ext.h \
 	CColVector.h CDiagMatrix.h CMatrix.h CRowVector.h CmplxAEPBAL.h \
 	CmplxCHOL.h CmplxDET.h CmplxHESS.h CmplxLU.h CmplxQR.h \
 	CmplxQRP.h CmplxSCHUR.h CmplxSVD.h EIG.h boolMatrix.h chMatrix.h \
@@ -144,35 +147,27 @@ ifeq ($(SHARED_LIBS), true)
   BINDISTFILES = liboctave.$(SHLEXT_VER)
 endif
 
 MAKEDEPS_1 := $(patsubst %.cc, %.d, $(SOURCES))
 MAKEDEPS := $(patsubst %.c, %.d, $(MAKEDEPS_1))
 
 LIBOCTAVE_OBJECTS := \
 	$(LIBOCTAVE_CXX_SOURCES:.cc=.o) \
-	$(LIBOCTAVE_C_SOURCES:.c=.o)
-
-LIBOCT_READLINE_OBJECTS := \
+	$(LIBOCTAVE_C_SOURCES:.c=.o) \
 	$(LIBOCT_READLINE_CXX_SOURCES:.cc=.o) \
-	$(LIBOCT_READLINE_C_SOURCES:.c=.o)
-
-LIBOCT_PATHSEARCH_OBJECTS := \
+	$(LIBOCT_READLINE_C_SOURCES:.c=.o) \
 	$(LIBOCT_PATHSEARCH_CXX_SOURCES:.cc=.o) \
 	$(LIBOCT_PATHSEARCH_C_SOURCES:.c=.o)
 
 ifeq ($(SHARED_LIBS), true)
   ifdef CXXPICFLAG
     LIBOCTAVE_PICOBJ := $(addprefix pic/, $(LIBOCTAVE_OBJECTS))
-    LIBOCT_READLINE_PICOBJ := $(addprefix pic/, $(LIBOCT_READLINE_OBJECTS))
-    LIBOCT_PATHSEARCH_PICOBJ := $(addprefix pic/, $(LIBOCT_PATHSEARCH_OBJECTS))
   else
     LIBOCTAVE_PICOBJ := $(LIBOCTAVE_OBJECTS)
-    LIBOCT_READLINE_PICOBJ := $(LIBOCT_READLINE_OBJECTS)
-    LIBOCT_PATHSEARCH_PICOBJ := $(LIBOCT_PATHSEARCH_OBJECTS)
   endif
 endif
 
 all: libraries
 .PHONY: all
 
 objects: $(OBJECTS)
 
@@ -194,83 +189,47 @@ pic:
 
 stamp-prereq: $(OPTS_INC)
 	touch stamp-prereq
 
 ifeq ($(SHARED_LIBS), true)
   ifeq ($(STATIC_LIBS), true)
     libraries: \
 	stamp-prereq \
-	liboctave.$(LIBEXT) liboctave.$(SHLEXT) \
-	liboct-readline.$(LIBEXT) liboct-readline.$(SHLEXT) \
-	liboct-pathsearch.$(LIBEXT) liboct-pathsearch.$(SHLEXT)
+	liboctave.$(LIBEXT) liboctave.$(SHLEXT_VER)
   else
     libraries: \
 	stamp-prereq \
-	liboctave.$(SHLEXT) \
-	liboct-readline.$(SHLEXT) \
-	liboct-pathsearch.$(SHLEXT)
+	liboctave.$(SHLEXT_VER)
   endif
 else
   ifeq ($(STATIC_LIBS), true)
     libraries: \
 	stamp-prereq \
-	liboctave.$(LIBEXT) \
-	liboct-readline.$(LIBEXT) \
-	liboct-pathsearch.$(LIBEXT)
+	liboctave.$(LIBEXT)
   else
     libraries: stamp-prereq
   endif
 endif
 .PHONY: libraries
 
 liboctave.$(LIBEXT): $(LIBOCTAVE_OBJECTS)
 	rm -f $@
 	$(TEMPLATE_AR) $(TEMPLATE_ARFLAGS) $@ $^
 	$(RANLIB) $@
 
-liboctave.$(SHLEXT): liboctave.$(SHLEXT_VER)
-	rm -f $@
-	$(LN_S) $< $@
-
-liboctave.$(SHLEXT_VER): $(LIBOCTAVE_PICOBJ)
-	rm -f $@
-	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^
-
-$(LIBOCTAVE_PICOBJ): stmp-pic
-
-liboct-readline.$(LIBEXT): $(LIBOCT_READLINE_OBJECTS)
-	rm -f $@
-	$(TEMPLATE_AR) $(TEMPLATE_ARFLAGS) $@ $^
-	$(RANLIB) $@
-
-liboct-readline.$(SHLEXT): liboct-readline.$(SHLEXT_VER)
+liboctave.$(SHLEXT_VER): liboctave.$(SHLEXT)
 	rm -f $@
 	$(LN_S) $< $@
 
-liboct-readline.$(SHLEXT_VER): $(LIBOCT_READLINE_PICOBJ)
-	rm -f $@
-	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^
-
-$(LIBOCT_READLINE_PICOBJ): stmp-pic
-
-liboct-pathsearch.$(LIBEXT): $(LIBOCT_PATHSEARCH_OBJECTS)
+liboctave.$(SHLEXT): $(LIBOCTAVE_PICOBJ)
 	rm -f $@
-	$(TEMPLATE_AR) $(TEMPLATE_ARFLAGS) $@ $^
-	$(RANLIB) $@
+	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^ $(LINK_DEPS) $(LIBKPATHSEA)
 
-liboct-pathsearch.$(SHLEXT): liboct-pathsearch.$(SHLEXT_VER)
-	rm -f $@
-	$(LN_S) $< $@
-
-liboct-pathsearch.$(SHLEXT_VER): $(LIBOCT_PATHSEARCH_PICOBJ)
-	rm -f $@
-	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^ $(LIBKPATHSEA)
-
-$(LIBOCT_PATHSEARCH_PICOBJ): stmp-pic
+$(LIBOCTAVE_PICOBJ): stmp-pic
 
 check: all
 .PHONY: check
 
 install: install-lib install-inc
 .PHONY: install
 
 install-strip:
@@ -279,71 +238,49 @@ install-strip:
 
 install-lib:
 	$(top_srcdir)/mkinstalldirs $(octlibdir)
 	if $(STATIC_LIBS); then \
 	  rm -f $(octlibdir)/liboctave.$(LIBEXT); \
 	  $(INSTALL_DATA) liboctave.$(LIBEXT) \
 	    $(octlibdir)/liboctave.$(LIBEXT); \
 	  $(RANLIB) $(octlibdir)/liboctave.$(LIBEXT); \
-	    \
-	  rm -f $(octlibdir)/liboct-readline.$(LIBEXT); \
-	  $(INSTALL_DATA) liboct-readline.$(LIBEXT) \
-	    $(octlibdir)/liboct-readline.$(LIBEXT); \
-	  $(RANLIB) $(octlibdir)/liboct-readline.$(LIBEXT); \
-	    \
-	  rm -f $(octlibdir)/liboct-pathsearch.$(LIBEXT); \
-	  $(INSTALL_DATA) liboct-pathsearch.$(LIBEXT) \
-	    $(octlibdir)/liboct-pathsearch.$(LIBEXT); \
-	  $(RANLIB) $(octlibdir)/liboct-pathsearch.$(LIBEXT); \
 	fi
 	if $(SHARED_LIBS); then \
-	  rm -f $(octlibdir)/liboctave.$(SHLEXT_VER); \
-	  $(INSTALL_PROGRAM) \
-	    liboctave.$(SHLEXT_VER) $(octlibdir)/liboctave.$(SHLEXT_VER); \
-	  ( cd $(octlibdir); \
-	    rm -f liboctave.$(SHLEXT); \
-	    $(LN_S) liboctave.$(SHLEXT_VER) liboctave.$(SHLEXT); ); \
-	  rm -f $(octlibdir)/liboct-readline.$(SHLEXT_VER); \
+	  rm -f $(octlibdir)/liboctave.$(SHLLIB_VER); \
 	  $(INSTALL_PROGRAM) \
-	    liboct-readline.$(SHLEXT_VER) \
-	    $(octlibdir)/liboct-readline.$(SHLEXT_VER); \
-	  ( cd $(octlibdir); \
-	    rm -f liboct-readline.$(SHLEXT); \
-	    $(LN_S) \
-	      liboct-readline.$(SHLEXT_VER) liboct-readline.$(SHLEXT); ); \
-	  rm -f $(octlibdir)/liboct-pathsearch.$(SHLEXT_VER); \
-	  $(INSTALL_PROGRAM) \
-	    liboct-pathsearch.$(SHLEXT_VER) \
-	    $(octlibdir)/liboct-pathsearch.$(SHLEXT_VER); \
-	  ( cd $(octlibdir); \
-	    rm -f liboct-pathsearch.$(SHLEXT); \
-	    $(LN_S) \
-	      liboct-pathsearch.$(SHLEXT_VER) liboct-pathsearch.$(SHLEXT); ); \
+	    liboctave.$(SHLLIB) $(octlibdir)/liboctave.$(SHLLIB_VER); \
+	  rm -f $(octlibdir)/liboctave.$(SHLLIB); \
+	  $(LN_S) liboctave.$(SHLLIB_VER) $(octlibdir)/liboctave.$(SHLLIB); \
+	  if  test x$(SHLBIN) != x ; then \
+	    rm -f $(bindir)/liboctave.$(SHLBIN_VER); \
+	    $(INSTALL_PROGRAM) \
+	      liboctave.$(SHLBIN) $(bindir)/liboctave.$(SHLBIN_VER); \
+	    rm -f $(bindir)/liboctave.$(SHLBIN); \
+	    $(LN_S) liboctave.$(SHLBIN_VER) $(bindir)/liboctave.$(SHLBIN); \
+	  fi; \
 	fi
 .PHONY: install-lib
 
 install-inc:
 	$(top_srcdir)/mkinstalldirs $(octincludedir)/octave
 	for f in $(INCLUDES_FOR_INSTALL); do \
 	  rm -f $(octincludedir)/octave/$$f; \
 	  $(INSTALL_DATA) $(srcdir)/$$f $(octincludedir)/octave/$$f; \
 	done
 .PHONY: install-inc
 
 uninstall:
 	rm -f $(octlibdir)/liboctave.$(LIBEXT)
-	rm -f $(octlibdir)/liboctave.$(SHLEXT)
-	rm -f $(octlibdir)/liboctave.$(SHLEXT_VER)
-	rm -f $(octlibdir)/liboct-readline.$(LIBEXT)
-	rm -f $(octlibdir)/liboct-readline.$(SHLEXT)
-	rm -f $(octlibdir)/liboct-readline.$(SHLEXT_VER)
-	rm -f $(octlibdir)/liboct-pathsearch.$(LIBEXT)
-	rm -f $(octlibdir)/liboct-pathsearch.$(SHLEXT)
-	rm -f $(octlibdir)/liboct-pathsearch.$(SHLEXT_VER)
+	rm -f $(octlibdir)/liboctave.$(SHLLIB)
+	rm -f $(octlibdir)/liboctave.$(SHLLIB_VER)
+	if test x$(SHLBIN) != x; then \
+	  rm -f $(bindir)/liboctave.$(SHLBIN); \
+	  rm -f $(bindir)/liboctave.$(SHLBIN_VER); \
+	fi
 	for f in $(INCLUDES); do rm -f $(octincludedir)/octave/$$f; done
 .PHONY: uninstall
 
 tags: $(SOURCES)
 	ctags $(SOURCES)
 
 TAGS: $(SOURCES)
 	etags $(SOURCES)
diff --git a/liboctave/lo-cieee.c b/liboctave/lo-cieee.c
--- a/liboctave/lo-cieee.c
+++ b/liboctave/lo-cieee.c
@@ -47,16 +47,28 @@ Software Foundation, 59 Temple Place - S
 
 #include "lo-ieee.h"
 
 #if defined (_AIX) && defined (__GNUG__)
 #undef finite
 #define finite(x) ((x) < DBL_MAX && (x) > -DBL_MAX)
 #endif
 
+/* Octave's idea of infinity.  */
+double octave_Inf;
+
+/* Octave's idea of a missing value.  */
+double octave_NA;
+
+/* Octave's idea of not a number.  */
+double octave_NaN;
+
+int lo_ieee_hw;
+int lo_ieee_lw;
+
 #if defined (SCO)
 
 int
 isnan (double x)
 {
   return (IsNANorINF (x) && NaN (x) && ! IsINF (x)) ? 1 : 0;
 }
 
@@ -111,13 +123,31 @@ lo_ieee_is_NA (double x)
 }
 
 int
 lo_ieee_is_NaN_or_NA (double x)
 {
   return lo_ieee_isnan (x);
 }
 
+double
+lo_ieee_inf_value (void)
+{
+  return octave_Inf;
+}
+
+double
+lo_ieee_na_value (void)
+{
+  return octave_NA;
+}
+
+double
+lo_ieee_nan_value (void)
+{
+  return octave_NaN;
+}
+
 /*
 ;;; Local Variables: ***
 ;;; mode: C++ ***
 ;;; End: ***
 */
diff --git a/liboctave/lo-ieee.cc b/liboctave/lo-ieee.cc
--- a/liboctave/lo-ieee.cc
+++ b/liboctave/lo-ieee.cc
@@ -43,28 +43,16 @@ Software Foundation, 59 Temple Place - S
 #if defined (SCO)
 #undef _IEEE
 #endif
 #endif
 
 #include "lo-ieee.h"
 #include "mach-info.h"
 
-// Octave's idea of infinity.
-double octave_Inf;
-
-// Octave's idea of not a number.
-double octave_NaN;
-
-// Octave's idea of a missing value.
-double octave_NA;
-
-int lo_ieee_hw;
-int lo_ieee_lw;
-
 void
 octave_ieee_init (void)
 {
 #if defined (HAVE_ISINF) || defined (HAVE_FINITE)
 
 // Some version of gcc on some old version of Linux used to crash when
 // trying to make Inf and NaN.
 
diff --git a/liboctave/lo-ieee.h b/liboctave/lo-ieee.h
--- a/liboctave/lo-ieee.h
+++ b/liboctave/lo-ieee.h
@@ -22,51 +22,55 @@ Software Foundation, 59 Temple Place - S
 
 #if !defined (octave_liboctave_ieee_h)
 #define octave_liboctave_ieee_h 1
 
 #ifdef	__cplusplus
 extern "C" {
 #endif
 
+/*  Octave's idea of infinity.  */
+extern double octave_Inf;
+
+/* Octave's idea of a missing value.  */
+extern double octave_NA;
+
+/* Octave's idea of not a number.  */
+extern double octave_NaN;
+
 extern int lo_ieee_hw;
 extern int lo_ieee_lw;
 
 typedef union
 {
   double value;
   unsigned int word[2];
 } lo_ieee_double;
 
 #define LO_IEEE_NA_HW 0x7ff00000
 #define LO_IEEE_NA_LW 1954
 
-// Octave's idea of infinity.
-extern double octave_Inf;
-
-// Octave's idea of not a number.
-extern double octave_NaN;
-
-// Octave's idea of a missing value.
-extern double octave_NA;
-
 extern void octave_ieee_init (void);
 
 #if defined (SCO)
 extern int isnan (double);
 extern int isinf (double);
 #endif
 
 extern int lo_ieee_isnan (double x);
 extern int lo_ieee_finite (double x);
 extern int lo_ieee_isinf (double x);
 
 extern int lo_ieee_is_NA (double);
 extern int lo_ieee_is_NaN_or_NA (double);
 
+extern double lo_ieee_inf_value (void);
+extern double lo_ieee_na_value (void);
+extern double lo_ieee_nan_value (void);
+
 #ifdef	__cplusplus
 }
 #endif
 
 #endif
 
 /*
 ;;; Local Variables: ***
diff --git a/mkoctfile.in b/mkoctfile.in
--- a/mkoctfile.in
+++ b/mkoctfile.in
@@ -32,36 +32,38 @@ set -e
 : ${DEPEND_EXTRA_SED_PATTERN=%OCTAVE_CONF_DEPEND_EXTRA_SED_PATTERN%}
 
 : ${SH_LD=%OCTAVE_CONF_SH_LD%}
 : ${SH_LDFLAGS=%OCTAVE_CONF_SH_LDFLAGS%}
 
 : ${RLD_FLAG=%OCTAVE_CONF_RLD_FLAG%}
 : ${RDYNAMIC_FLAG=%OCTAVE_CONF_RDYNAMIC_FLAG%}
 : ${LIBOCTAVE=%OCTAVE_CONF_LIBOCTAVE%}
-: ${LIBOCT_READLINE=%OCTAVE_CONF_LIBOCT_READLINE%}
+: ${LIBOCTINTERP=%OCTAVE_CONF_LIBOCTINTERP%}
+: ${LIBREADLINE=%OCTAVE_CONF_LIBREADLINE%}
 : ${LIBCRUFT=%OCTAVE_CONF_LIBCRUFT%}
 : ${BLAS_LIBS=%OCTAVE_CONF_BLAS_LIBS%}
 : ${FFTW_LIBS=%OCTAVE_CONF_FFTW_LIBS%}
 : ${LIBS=%OCTAVE_CONF_LIBS%}
 : ${FLIBS=%OCTAVE_CONF_FLIBS%}
 : ${LD_CXX=%OCTAVE_CONF_LD_CXX%}
 : ${LDFLAGS=%OCTAVE_CONF_LDFLAGS%}
 : ${LD_STATIC_FLAG=%OCTAVE_CONF_LD_STATIC_FLAG%}
 : ${LFLAGS=%OCTAVE_CONF_MKOCTFILE_LFLAGS%}
+: ${INCLUDE_LINK_DEPS=%OCTAVE_CONF_INCLUDE_LINK_DEPS%}
 
 : ${ALL_FFLAGS="$FFLAGS"}
 
 : ${ALL_CFLAGS="$INCFLAGS $XTRA_CFLAGS $CFLAGS"}
 
 : ${ALL_CXXFLAGS="$INCFLAGS $XTRA_CXXFLAGS $CXXFLAGS"}
 
 : ${ALL_LDFLAGS="$LD_STATIC_FLAG $CPICFLAG $LDFLAGS"}
 
-: ${OCTAVE_LIBS="$LIBOCTAVE $LIBOCT_READLINE $SPECIAL_MATH_LIB $LIBCRUFT"}
+: ${OCTAVE_LIBS="$LIBOCTAVE $SPECIAL_MATH_LIB $LIBCRUFT"}
 
 # Local variables.
 
 usage_msg="usage: mkoctfile [options] file ..."
 
 cfiles=
 ccfiles=
 f77files=
@@ -128,34 +130,36 @@ Options:
   -c, --compile           Compile, but do not link.
 
   -o FILE, --output FILE  Output file name.  Default extension is .oct
                           unless linking a stand-alone executable.
 
   -p VAR, --print VAR     Print configuration variable VAR.  Recognized
                           variables are:
 
-                            CPPFLAGS    CPICFLAG
-                            INCFLAGS    CXX
-                            F2C         CXXFLAGS
-                            F2CFLAGS    CXXPICFLAG
-                            F77         XTRA_CFLAGS
-                            FFLAGS      XTRA_CXXFLAGS
-                            FPICFLAG    SHLEXT
-                            CC          SH_LD
-                            CFLAGS      SH_LDFLAGS
+                            CPPFLAGS      CPICFLAG
+                            INCFLAGS      CXX
+                            F2C           CXXFLAGS
+                            F2CFLAGS      CXXPICFLAG
+                            F77           XTRA_CFLAGS
+                            FFLAGS        XTRA_CXXFLAGS
+                            FPICFLAG      SHLEXT
+                            CC            SH_LD
+                            CFLAGS        SH_LDFLAGS
 
-                            LD_CXX      LFLAGS
-                            LDFLAGS     LD_STATIC_FLAG
-                            RLD_FLAG    RDYNAMIC_FLAG
+                            INCLUDE_LINK_DEPS
 
-                            LIBOCTAVE   LIBOCT_READLINE
-                            LIBCRUFT    BLAS_LIBS
-                            FFTW_LIBS   LIBS
-                            FLIBS       OCTAVE_LIBS
+                            LD_CXX        LFLAGS
+                            LDFLAGS       LD_STATIC_FLAG
+                            RLD_FLAG      RDYNAMIC_FLAG
+
+                            LIBOCTAVE     LIBCRUFT
+                            LIBOCTINTERP  OCTAVE_LIBS
+                            BLAS_LIBS     FFTW_LIBS
+                            LIBS          FLIBS
 
   --link-stand-alone      Link a stand-alone executable file.
 
   -s, --strip             Strip output file.
 
   -v, --verbose           Echo commands as they are executed.
 
   FILE                    Compile or link FILE.  Recognized file types are:
@@ -364,25 +368,29 @@ fi
 ##   eval $cmd
 ## fi
 
 # Link all the object files.
 
 if $link; then
   if $link_stand_alone; then
     if [ -n "$LD_CXX" ]; then
-      cmd="$LD_CXX $CPPFLAGS $ALL_CXXFLAGS $RDYNAMIC_FLAG $ALL_LDFLAGS $output_option $objfiles $ldflags $LFLAGS $RLD_FLAG $OCTAVE_LIBS $BLAS_LIBS $FFTW_LIBS $LIBS $FLIBS"
+      cmd="$LD_CXX $CPPFLAGS $ALL_CXXFLAGS $RDYNAMIC_FLAG $ALL_LDFLAGS $output_option $objfiles $ldflags $LFLAGS $RLD_FLAG $OCTAVE_LIBS $BLAS_LIBS $FFTW_LIBS $LIBREADLINE $LIBS $FLIBS"
       $dbg $cmd
       eval $cmd
     else
       echo "mkoctfile: no way to link stand-alone executable file" 1>&2
       exit 1
     fi
   else
-    cmd="$SH_LD $SH_LDFLAGS -o $octfile $objfiles $ldflags"
+    LINK_DEPS=
+    if $INCLUDE_LINK_DEPS ; then
+	LINK_DEPS="$LFLAGS $LIBOCTAVE $LIBCRUFT $LIBOCTINTERP $BLAS_LIBS $FFTW_LIBS"
+    fi
+    cmd="$SH_LD $SH_LDFLAGS -o $octfile $objfiles $ldflags $LINK_DEPS"
     $dbg $cmd
     eval $cmd
   fi
 
 # Maybe strip it.
 
   if $strip; then
     cmd="strip $octfile"
diff --git a/src/ChangeLog b/src/ChangeLog
--- a/src/ChangeLog
+++ b/src/ChangeLog
@@ -1,8 +1,36 @@
+2002-10-14  John W. Eaton  <jwe@bevo.che.wisc.edu>
+
+	*  DLD-FUNCTIONS/minmax.cc, DLD-FUNCTIONS/getrusage.cc, data.cc,
+	file-io.cc, ov-base.cc, ov-bool-mat.cc, ov-ch-mat.cc,
+	ov-complex.cc, ov-cx-mat.cc, ov-range.cc, ov-re-mat.cc,
+	ov-re-nd-array.cc: Change all uses of octave_Inf, octave_NA, and
+	octave_NaN to be calls to lo_ieee_Inf_value, lo_ieee_NA_value, and
+	lo_ieee_NaN_value instead of using the constants directly to avoid
+	linking problem with Cygwin.
+
+	* Makefile.in (install): No need to use cd to create links.
+
+2002-10-14  Paul Kienzle <pkienzle@users.sf.net>
+
+	* Makefile.in: Merge liboctave with liboct-readline and
+	liboct-pathsearch.
+	Use link dependencies for shared libs if INCLUDE_LINK_DEPS.
+	(LIBRARIES): If doing shared libs, include versioned library in	list.
+	(liboctinterp.$(SHLEXT), liboctinterp.$(SHLEXT_VER)): Reverse
+	actions -- build unversioned library, symbolic link adds version
+	info.
+	(install, uninstall): Handle link and load forms of the library
+	separately.
+
+	* toplev.cc (octave_config_info): Remove LIBOCT_READLINE and
+	LIBOCT_PATHSEARCH, add LIBREADLINE.
+	* oct-conf.h.in: Likewise.
+
 2002-10-11  John W. Eaton  <jwe@bevo.che.wisc.edu>
 
 	* lex.l (handle_identifier): Don't enter token in local symbol
 	table if the following token is a dot and it looks like a binary
 	operator.
 	(force_local_variable): If name is not a variable, clear it before
 	defining.
 
diff --git a/src/DLD-FUNCTIONS/getrusage.cc b/src/DLD-FUNCTIONS/getrusage.cc
--- a/src/DLD-FUNCTIONS/getrusage.cc
+++ b/src/DLD-FUNCTIONS/getrusage.cc
@@ -197,30 +197,32 @@ elements @code{sec} (seconds) @code{usec
   m ["utime"] = octave_value (tv_tmp);
 
   tv_tmp ["sec"] = 0.0;
   tv_tmp ["usec"] = 0.0;
   m ["stime"] = octave_value (tv_tmp);
 
 #endif
 
-  m ["maxrss"] = octave_NaN;
-  m ["ixrss"] = octave_NaN;
-  m ["idrss"] = octave_NaN;
-  m ["isrss"] = octave_NaN;
-  m ["minflt"] = octave_NaN;
-  m ["majflt"] = octave_NaN;
-  m ["nswap"] = octave_NaN;
-  m ["inblock"] = octave_NaN;
-  m ["oublock"] = octave_NaN;
-  m ["msgsnd"] = octave_NaN;
-  m ["msgrcv"] = octave_NaN;
-  m ["nsignals"] = octave_NaN;
-  m ["nvcsw"] = octave_NaN;
-  m ["nivcsw"] = octave_NaN;
+  double tmp = lo_ieee_nan_value ();
+
+  m ["maxrss"] = tmp;
+  m ["ixrss"] = tmp;
+  m ["idrss"] = tmp;
+  m ["isrss"] = tmp;
+  m ["minflt"] = tmp;
+  m ["majflt"] = tmp;
+  m ["nswap"] = tmp;
+  m ["inblock"] = tmp;
+  m ["oublock"] = tmp;
+  m ["msgsnd"] = tmp;
+  m ["msgrcv"] = tmp;
+  m ["nsignals"] = tmp;
+  m ["nvcsw"] = tmp;
+  m ["nivcsw"] = tmp;
 
 #endif
 
   return octave_value (m);
 }
 
 /*
 ;;; Local Variables: ***
diff --git a/src/DLD-FUNCTIONS/minmax.cc b/src/DLD-FUNCTIONS/minmax.cc
--- a/src/DLD-FUNCTIONS/minmax.cc
+++ b/src/DLD-FUNCTIONS/minmax.cc
@@ -417,23 +417,25 @@ max (const ComplexMatrix& a, const Compl
 	} \
       else \
 	gripe_wrong_type_arg (#FCN, arg1); \
  \
       int len = index.length (); \
  \
       if (len > 0) \
 	{ \
+	  double nan_val = lo_ieee_nan_value (); \
+ \
 	  RowVector idx (len); \
  \
 	  for (int i = 0; i < len; i++) \
 	    { \
 	      int tmp = index.elem (i) + 1; \
 	      idx.elem (i) = (tmp <= 0) \
-		? octave_NaN : static_cast<double> (tmp); \
+		? nan_val : static_cast<double> (tmp); \
 	    } \
  \
 	  retval(1) = idx; \
 	} \
       else \
 	retval(1) = Matrix (); \
     } \
   else if (nargin == 2) \
diff --git a/src/Makefile.in b/src/Makefile.in
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -27,23 +27,24 @@ CXXFLAGS_NO_PT_FLAGS = $(filter-out $(PT
 	  | $(srcdir)/mkdefs > $@-t
 	@mv $@-t $@
 
 # How to make a .oct file from a .o file:
 
 ifeq ($(OCTAVE_LITE), true)
   ifdef CXXPICFLAG
     %.oct : pic/%.o
-	  $(SH_LD) $(SH_LDFLAGS) -o $@ $<
+	  $(SH_LD) $(SH_LDFLAGS) -o $@ $< $(OCT_LINK_DEPS)
   else
     %.oct : %.o
-	  $(SH_LD) $(SH_LDFLAGS) -o $@ $<
+	  $(SH_LD) $(SH_LDFLAGS) -o $@ $< $(OCT_LINK_DEPS)
   endif
 endif
 
+
 OPT_HANDLERS := DASPK-opts.cc DASRT-opts.cc DASSL-opts.cc \
 	LSODE-opts.cc NLEqn-opts.cc ODESSA-opts.cc Quad-opts.cc
 
 DLD_XSRC := balance.cc besselj.cc betainc.cc chol.cc colloc.cc \
 	daspk.cc dasrt.cc dassl.cc det.cc eig.cc expm.cc fft.cc fft2.cc \
 	filter.cc find.cc fsolve.cc gammainc.cc getgrent.cc \
 	getpwent.cc getrusage.cc givens.cc hess.cc ifft.cc ifft2.cc \
 	inv.cc kron.cc log.cc lpsolve.cc lsode.cc lu.cc minmax.cc \
@@ -189,24 +190,30 @@ VAR_2 := $(patsubst %.y, %, $(VAR_3))
 VAR_1 := $(patsubst %.l, %, $(VAR_2))
 VAR_FILES := $(patsubst %.cc, %, $(VAR_1))
 
 DOC_FILES := $(sort $(DEF_FILES) $(patsubst %, %.df, $(VAR_FILES)))
 
 OCTAVE_LFLAGS = -L$(TOPDIR)/liboctave -L$(TOPDIR)/libcruft \
   -L$(TOPDIR)/src $(RLD_FLAG)
 
-OCTAVE_LIBS = $(LIBOCTINTERP) $(LIBOCTAVE) $(LIBOCT_READLINE) \
-  $(LIBOCT_PATHSEARCH) $(SPECIAL_MATH_LIB) $(LIBCRUFT) \
+OCTAVE_LIBS = $(LIBOCTINTERP) $(LIBOCTAVE) \
+  $(SPECIAL_MATH_LIB) $(LIBCRUFT) \
   $(LIBPLPLOT) $(LIBGLOB) $(LIBDLFCN)
 
 ifneq ($SHARED_LIBS), true)
 OCTAVE_LIBS += $(LIBKPATHSEA)
 endif
 
+ifeq ($(INCLUDE_LINK_DEPS),true)
+  OCTINTERP_LINK_DEPS = -L../liboctave $(LIBOCTAVE) -L../libcruft $(LIBCRUFT)
+  OCT_LINK_DEPS = \
+    -L../libcruft $(LIBCRUFT) -L../liboctave $(LIBOCTAVE) -L. $(LIBOCTINTERP)
+endif
+
 DISTFILES = Makefile.in ChangeLog mkdefs mkops mkgendoc \
 	DOCSTRINGS mkbuiltins mk-oct-links \
 	defaults.h.in oct-conf.h.in octave.gperf oct-gperf.h \
 	octave.cc parse.cc lex.cc y.tab.h \
 	$(INCLUDES) $(DIST_SRC) $(OPT_HANDLERS)
 
 ifeq ($(SHARED_LIBS), true)
   BINDISTLIBS = src/liboctinterp
@@ -219,19 +226,19 @@ all: octave$(EXEEXT) DOCSTRINGS
 .PHONY: all
 
 objects: $(OBJECTS)
 
 XERBLA = ../libcruft/blas-xtra/xerbla.o
 
 ifeq ($(SHARED_LIBS), true)
   ifeq ($(STATIC_LIBS), true)
-    LIBRARIES = liboctinterp.$(LIBEXT) liboctinterp.$(SHLEXT)
+    LIBRARIES = liboctinterp.$(LIBEXT) liboctinterp.$(SHLEXT_VER)
   else
-    LIBRARIES = liboctinterp.$(SHLEXT)
+    LIBRARIES = liboctinterp.$(SHLEXT_VER)
     XERBLA = ../libcruft/blas-xtra/pic/xerbla.o
   endif
 else
   ifeq ($(STATIC_LIBS), true)
     LIBRARIES = liboctinterp.$(LIBEXT)
   else
     ## This is not going to work, but hey, you asked for it...
     LIBRARIES =
@@ -242,23 +249,23 @@ endif
 libraries: $(LIBRARIES)
 .PHONY: libraries
 
 liboctinterp.$(LIBEXT): $(OBJECTS)
 	rm -f $@
 	$(TEMPLATE_AR) $(TEMPLATE_ARFLAGS) $@ $^
 	$(RANLIB) $@
 
-liboctinterp.$(SHLEXT): liboctinterp.$(SHLEXT_VER)
+liboctinterp.$(SHLEXT_VER): liboctinterp.$(SHLEXT)
 	rm -f $@
 	$(LN_S) $< $@
 
-liboctinterp.$(SHLEXT_VER): $(PICOBJ)
+liboctinterp.$(SHLEXT): $(PICOBJ)
 	rm -f $@
-	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^
+	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^ $(OCTINTERP_LINK_DEPS)
 
 stamp-oct-links: $(OCT_FILES)
 	if [ -n "$(OCT_FILES)" ]; then \
 	  $(srcdir)/mk-oct-links . $(DLD_DEF_FILES); \
 	fi
 	touch stamp-oct-links
 
 stamp-prereq: defaults.h oct-conf.h $(OPT_HANDLERS)
@@ -363,21 +370,27 @@ install-lib:
 	if $(STATIC_LIBS); then \
 	  rm -f $(octlibdir)/liboctinterp.$(LIBEXT); \
 	  $(INSTALL_DATA) liboctinterp.$(LIBEXT) \
 	    $(octlibdir)/liboctinterp.$(LIBEXT); \
 	  $(RANLIB) $(octlibdir)/liboctinterp.$(LIBEXT); \
 	fi
 	if $(SHARED_LIBS); then \
 	  rm -f $(octlibdir)/liboctinterp.$(SHLEXT_VER); \
-	  $(INSTALL_PROGRAM) liboctinterp.$(SHLEXT_VER) \
-	    $(octlibdir)/liboctinterp.$(SHLEXT_VER); \
-	  cd $(octlibdir); \
-	  rm -f liboctinterp.$(SHLEXT); \
-	  $(LN_S) liboctinterp.$(SHLEXT_VER) liboctinterp.$(SHLEXT); \
+	  $(INSTALL_PROGRAM) liboctinterp.$(SHLLIB) \
+	    $(octlibdir)/liboctinterp.$(SHLLIB_VER); \
+	  rm -f $(octlibdir)/liboctinterp.$(SHLLIB); \
+	  $(LN_S) liboctinterp.$(SHLLIB_VER) $(octlibdir)/liboctinterp.$(SHLLIB); \
+	  if  test x$(SHLBIN) != x ; then \
+	      rm -f $(bindir)/liboctinterp.$(SHLBIN_VER); \
+	      $(INSTALL_PROGRAM) \
+	        liboctinterp.$(SHLBIN) $(bindir)/octinterp.$(SHLBIN_VER); \
+	      rm -f $(bindir)/liboctinterp.$(SHLBIN); \
+	      $(LN_S) liboctinterp.$(SHLBIN_VER) $(bindir)/liboctinterp.$(SHLBIN); \
+	  fi; \
 	fi
 .PHONY: install-lib
 
 install-inc:
 	$(top_srcdir)/mkinstalldirs $(octincludedir)/octave
 	for f in $(INCLUDES); do \
 	  rm -f $(octincludedir)/octave/$$f; \
 	  $(INSTALL_DATA) $(srcdir)/$$f $(octincludedir)/octave/$$f; \
@@ -390,18 +403,22 @@ install-inc:
 	    $(INSTALL_DATA) $(srcdir)/$$f $(octincludedir)/octave/$$f ; \
 	  fi ; \
 	done
 .PHONY: install-inc
 
 uninstall:
 	rm -f $(bindir)/octave$(EXEEXT)
 	rm -f $(octlibdir)/liboctinterp.$(LIBEXT)
-	rm -f $(octlibdir)/liboctinterp.$(SHLEXT)
-	rm -f $(octlibdir)/liboctinterp.$(SHLEXT_VER)
+	rm -f $(octlibdir)/liboctinterp.$(SHLLIB)
+	rm -f $(octlibdir)/liboctinterp.$(SHLLIB_VER)
+	if test x$(SHLBIN) != x ; then \
+	  rm -f $(bindir)/liboctinterp.$(SHLBIN); \
+	  rm -f $(bindir)/liboctinterp.$(SHLBIN_VER); \
+	fi
 	for f in $(INCLUDES) defaults.h oct-conf.h; do \
 	  rm -f $(octincludedir)/octave/$$f; \
 	done
 .PHONY: uninstall
 
 tags: $(SOURCES) $(DLD_SRC)
 	ctags $(SOURCES) $(DLD_SRC)
 
diff --git a/src/data.cc b/src/data.cc
--- a/src/data.cc
+++ b/src/data.cc
@@ -1182,29 +1182,29 @@ or any operation with a NaN.\n\
 Note that NaN always compares not equal to NaN.  This behavior is\n\
 specified by the IEEE standard for floating point arithmetic.  To\n\
 find NaN values, you must use the @code{isnan} function.\n\
 @end defvr"
 
   DEFCONST (I, Complex (0.0, 1.0),
     IMAGINARY_DOC_STRING);
 
-  DEFCONST (Inf, octave_Inf,
+  DEFCONST (Inf, lo_ieee_inf_value (),
     INFINITY_DOC_STRING);
 
   DEFCONST (J, Complex (0.0, 1.0),
     IMAGINARY_DOC_STRING);
 
-  DEFCONST (NA, octave_NA,
+  DEFCONST (NA, lo_ieee_na_value (),
     "-*- texinfo -*-\n\
 @defvr {Built-in Variable} NA\n\
 Missing value.\n\
 @end defvr");
 
-  DEFCONST (NaN, octave_NaN,
+  DEFCONST (NaN, lo_ieee_nan_value (),
     NAN_DOC_STRING);
 
 #if defined (M_E)
   double e_val = M_E;
 #else
   double e_val = exp (1.0);
 #endif
 
@@ -1253,23 +1253,23 @@ is approximately\n\
     "-*- texinfo -*-\n\
 @defvr {Built-in Variable} false\n\
 Logical false value.\n\
 @end defvr");
 
   DEFCONST (i, Complex (0.0, 1.0),
     IMAGINARY_DOC_STRING);
 
-  DEFCONST (inf, octave_Inf,
+  DEFCONST (inf, lo_ieee_inf_value (),
     INFINITY_DOC_STRING);
 
   DEFCONST (j, Complex (0.0, 1.0),
     IMAGINARY_DOC_STRING);
 
-  DEFCONST (nan, octave_NaN,
+  DEFCONST (nan, lo_ieee_nan_value (),
     NAN_DOC_STRING);
 
 #if defined (M_PI)
   double pi_val = M_PI;
 #else
   double pi_val = 4.0 * atan (1.0);
 #endif
 
diff --git a/src/file-io.cc b/src/file-io.cc
--- a/src/file-io.cc
+++ b/src/file-io.cc
@@ -851,17 +851,18 @@ conversions is returned in @var{count}\n
 	    {
 	      if (args(1).is_string ())
 		{
 		  std::string fmt = args(1).string_value ();
 
 		  int count = 0;
 
 		  Array<double> size = (nargin == 3)
-		    ? args(2).vector_value () : Array<double> (1, octave_Inf);
+		    ? args(2).vector_value ()
+		    : Array<double> (1, lo_ieee_inf_value ());
 
 		  if (! error_state)
 		    {
 		      octave_value tmp = os.scanf (fmt, size, count);
 
 		      retval(1) = static_cast<double> (count);
 		      retval(0) = tmp;
 		    }
@@ -935,17 +936,17 @@ string is treated as an end-of-file cond
 		  if (args(1).is_string ())
 		    {
 		      std::string fmt = args(1).string_value ();
 
 		      int count = 0;
 
 		      Array<double> size = (nargin == 3)
 			? args(2).vector_value ()
-			: Array<double> (1, octave_Inf);
+			: Array<double> (1, lo_ieee_inf_value ());
 
 		      octave_value tmp = os.scanf (fmt, size, count);
 
 		      // XXX FIXME XXX -- is this the right thing to do?
 		      // Extract error message first, because getting
 		      // position will clear it.
 		      std::string errmsg = os.error ();
 
@@ -1180,17 +1181,17 @@ values read is returned in @code{count}\
       retval(1) = -1.0;
       retval(0) = Matrix ();
 
       octave_stream os = octave_stream_list::lookup (args(0), "fread");
 
       if (! error_state)
 	{
 	  octave_value size = (nargin > 1)
-	    ? args(1) : octave_value (octave_Inf);
+	    ? args(1) : octave_value (lo_ieee_inf_value ());
 
 	  octave_value prec = (nargin > 2)
 	    ? args(2) : octave_value ("uchar");
 
 	  octave_value skip = (nargin > 3)
 	    ? args(3) : octave_value (0.0);
 
 	  octave_value arch = (nargin > 4)
diff --git a/src/oct-conf.h.in b/src/oct-conf.h.in
--- a/src/oct-conf.h.in
+++ b/src/oct-conf.h.in
@@ -191,36 +191,32 @@ Software Foundation, 59 Temple Place - S
 #ifndef OCTAVE_CONF_LIBGLOB
 #define OCTAVE_CONF_LIBGLOB %OCTAVE_CONF_LIBGLOB%
 #endif
 
 #ifndef OCTAVE_CONF_LIBKPATHSEA
 #define OCTAVE_CONF_LIBKPATHSEA %OCTAVE_CONF_LIBKPATHSEA%
 #endif
 
-#ifndef OCTAVE_CONF_LIBOCT_PATHSEARCH
-#define OCTAVE_CONF_LIBOCT_PATHSEARCH %OCTAVE_CONF_LIBOCT_PATHSEARCH%
-#endif
-
-#ifndef OCTAVE_CONF_LIBOCT_READLINE
-#define OCTAVE_CONF_LIBOCT_READLINE %OCTAVE_CONF_LIBOCT_READLINE%
-#endif
-
 #ifndef OCTAVE_CONF_LIBOCTAVE
 #define OCTAVE_CONF_LIBOCTAVE %OCTAVE_CONF_LIBOCTAVE%
 #endif
 
 #ifndef OCTAVE_CONF_LIBOCTINTERP
 #define OCTAVE_CONF_LIBOCTINTERP %OCTAVE_CONF_LIBOCTINTERP%
 #endif
 
 #ifndef OCTAVE_CONF_LIBPLPLOT
 #define OCTAVE_CONF_LIBPLPLOT %OCTAVE_CONF_LIBPLPLOT%
 #endif
 
+#ifndef OCTAVE_CONF_LIBREADLINE
+#define OCTAVE_CONF_LIBREADLINE %OCTAVE_CONF_LIBREADLINE%
+#endif
+
 #ifndef OCTAVE_CONF_LIBS
 #define OCTAVE_CONF_LIBS %OCTAVE_CONF_LIBS%
 #endif
 
 #ifndef OCTAVE_CONF_LN_S
 #define OCTAVE_CONF_LN_S %OCTAVE_CONF_LN_S%
 #endif
 
diff --git a/src/ov-base.cc b/src/ov-base.cc
--- a/src/ov-base.cc
+++ b/src/ov-base.cc
@@ -208,17 +208,17 @@ octave_base_value::nint_value (bool frc_
     gripe_wrong_type_arg ("octave_base_value::nint_value ()", type_name ());
 
   return retval;
 }
 
 double
 octave_base_value::double_value (bool) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
   gripe_wrong_type_arg ("octave_base_value::double_value ()", type_name ());
   return retval;
 }
 
 Cell
 octave_base_value::cell_value () const
 {
   Cell retval;
@@ -232,17 +232,18 @@ octave_base_value::matrix_value (bool) c
   Matrix retval;
   gripe_wrong_type_arg ("octave_base_value::matrix_value()", type_name ());
   return retval;
 }
 
 Complex
 octave_base_value::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+  Complex retval (tmp, tmp);
   gripe_wrong_type_arg ("octave_base_value::complex_value()", type_name ());
   return retval;
 }
 
 ComplexMatrix
 octave_base_value::complex_matrix_value (bool) const
 {
   ComplexMatrix retval;
diff --git a/src/ov-bool-mat.cc b/src/ov-bool-mat.cc
--- a/src/ov-bool-mat.cc
+++ b/src/ov-bool-mat.cc
@@ -83,31 +83,33 @@ octave_bool_matrix::valid_as_scalar_inde
 {
   // XXX FIXME XXX
   return false;
 }
 
 double
 octave_bool_matrix::double_value (bool) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("bool matrix", "real scalar");
 
   return retval;
 }
 
 Complex
 octave_bool_matrix::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+
+  Complex retval (tmp, tmp);
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("bool matrix", "complex scalar");
 
   return retval;
diff --git a/src/ov-ch-mat.cc b/src/ov-ch-mat.cc
--- a/src/ov-ch-mat.cc
+++ b/src/ov-ch-mat.cc
@@ -52,31 +52,33 @@ octave_char_matrix::valid_as_scalar_inde
   bool retval = false;
   error ("octave_char_matrix::valid_as_scalar_index(): not implemented");
   return retval;
 }
 
 double
 octave_char_matrix::double_value (bool) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("character matrix", "real scalar");
 
   return retval;
 }
 
 Complex
 octave_char_matrix::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+
+  Complex retval (tmp, tmp);
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("character matrix", "complex scalar");
 
   return retval;
diff --git a/src/ov-complex.cc b/src/ov-complex.cc
--- a/src/ov-complex.cc
+++ b/src/ov-complex.cc
@@ -85,17 +85,17 @@ octave_complex::do_index_op (const octav
     }
 
   return retval;
 }
 
 double
 octave_complex::double_value (bool force_conversion) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   int flag = force_conversion;
 
   if (! flag)
     flag = Vok_to_lose_imaginary_part;
 
   if (flag < 0)
     gripe_implicit_conversion ("complex scalar", "real scalar");
diff --git a/src/ov-cx-mat.cc b/src/ov-cx-mat.cc
--- a/src/ov-cx-mat.cc
+++ b/src/ov-cx-mat.cc
@@ -118,17 +118,17 @@ octave_complex_matrix::valid_as_scalar_i
 {
   // XXX FIXME XXX
   return false;
 }
 
 double
 octave_complex_matrix::double_value (bool force_conversion) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   int flag = force_conversion;
 
   if (! flag)
     flag = Vok_to_lose_imaginary_part;
 
   if (flag < 0)
     gripe_implicit_conversion ("complex matrix", "real scalar");
@@ -166,17 +166,19 @@ octave_complex_matrix::matrix_value (boo
     gripe_invalid_conversion ("complex matrix", "real matrix");
 
   return retval;
 }
 
 Complex
 octave_complex_matrix::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+
+  Complex retval (tmp, tmp);
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("complex matrix", "complex scalar");
 
   return retval;
diff --git a/src/ov-range.cc b/src/ov-range.cc
--- a/src/ov-range.cc
+++ b/src/ov-range.cc
@@ -124,17 +124,17 @@ octave_range::do_index_op (const octave_
   octave_value tmp (new octave_matrix (range.matrix_value ()));
 
   return tmp.do_index_op (idx, resize_ok);
 }
 
 double
 octave_range::double_value (bool) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   int nel = range.nelem ();
 
   if (nel == 1 || (nel > 1 && Vdo_fortran_indexing))
     retval = range.base ();
   else
     gripe_invalid_conversion ("range", "real scalar");
 
@@ -185,17 +185,19 @@ octave_range::is_true (void) const
     }
 
   return retval;
 }
 
 Complex
 octave_range::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+
+  Complex retval (tmp, tmp);
 
   int nel = range.nelem ();
 
   if (nel == 1 || (nel > 1 && Vdo_fortran_indexing))
     retval = range.base ();
   else
     gripe_invalid_conversion ("range", "complex scalar");
 
diff --git a/src/ov-re-mat.cc b/src/ov-re-mat.cc
--- a/src/ov-re-mat.cc
+++ b/src/ov-re-mat.cc
@@ -77,32 +77,34 @@ octave_matrix::valid_as_scalar_index (vo
 {
   // XXX FIXME XXX
   return false;
 }
 
 double
 octave_matrix::double_value (bool) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   // XXX FIXME XXX -- maybe this should be a function, valid_as_scalar()
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("real matrix", "real scalar");
 
   return retval;
 }
 
 Complex
 octave_matrix::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+
+  Complex retval (tmp, tmp);
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("real matrix", "complex scalar");
 
   return retval;
diff --git a/src/ov-re-nd-array.cc b/src/ov-re-nd-array.cc
--- a/src/ov-re-nd-array.cc
+++ b/src/ov-re-nd-array.cc
@@ -108,32 +108,34 @@ octave_matrix::valid_as_scalar_index (vo
 {
   // XXX FIXME XXX
   return false;
 }
 
 double
 octave_matrix::double_value (bool) const
 {
-  double retval = octave_NaN;
+  double retval = lo_ieee_nan_value ();
 
   // XXX FIXME XXX -- maybe this should be a function, valid_as_scalar()
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("real matrix", "real scalar");
 
   return retval;
 }
 
 Complex
 octave_matrix::complex_value (bool) const
 {
-  Complex retval (octave_NaN, octave_NaN);
+  double tmp = lo_ieee_nan_value ();
+
+  Complex retval (tmp, tmp);
 
   if ((rows () == 1 && columns () == 1)
       || (Vdo_fortran_indexing && rows () > 0 && columns () > 0))
     retval = matrix (0, 0);
   else
     gripe_invalid_conversion ("real matrix", "complex scalar");
 
   return retval;
diff --git a/src/toplev.cc b/src/toplev.cc
--- a/src/toplev.cc
+++ b/src/toplev.cc
@@ -687,21 +687,20 @@ specified option.\n\
   m ["LEXLIB"] = OCTAVE_CONF_LEXLIB;
   m ["LFLAGS"] = OCTAVE_CONF_LFLAGS;
   m ["LIBCRUFT"] = OCTAVE_CONF_LIBCRUFT;
   m ["LIBDLFCN"] = OCTAVE_CONF_LIBDLFCN;
   m ["LIBEXT"] = OCTAVE_CONF_LIBEXT;
   m ["LIBFLAGS"] = OCTAVE_CONF_LIBFLAGS;
   m ["LIBGLOB"] = OCTAVE_CONF_LIBGLOB;
   m ["LIBKPATHSEA"] = OCTAVE_CONF_LIBKPATHSEA;
-  m ["LIBOCT_PATHSEARCH"] = OCTAVE_CONF_LIBOCT_PATHSEARCH;
-  m ["LIBOCT_READLINE"] = OCTAVE_CONF_LIBOCT_READLINE;
   m ["LIBOCTAVE"] = OCTAVE_CONF_LIBOCTAVE;
   m ["LIBOCTINTERP"] = OCTAVE_CONF_LIBOCTINTERP;
   m ["LIBPLPLOT"] = OCTAVE_CONF_LIBPLPLOT;
+  m ["LIBREADLINE"] = OCTAVE_CONF_LIBREADLINE;
   m ["LIBS"] = OCTAVE_CONF_LIBS;
   m ["LN_S"] = OCTAVE_CONF_LN_S;
   m ["MKOCTFILE_INCFLAGS"] = OCTAVE_CONF_MKOCTFILE_INCFLAGS;
   m ["MKOCTFILE_LFLAGS"] = OCTAVE_CONF_MKOCTFILE_LFLAGS;
   m ["OCTAVE_LITE"] = OCTAVE_CONF_OCTAVE_LITE;
   m ["RANLIB"] = OCTAVE_CONF_RANLIB;
   m ["RDYNAMIC_FLAG"] = OCTAVE_CONF_RDYNAMIC_FLAG;
   m ["RLD_FLAG"] = OCTAVE_CONF_RLD_FLAG;
